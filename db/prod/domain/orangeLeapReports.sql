-- UTILITY QUERIES
-- 
-- -- Get the fields for a table in the format used in the select statement
-- SELECT CONCAT(CHAR(9), UCASE(TABLE_NAME), '.', COLUMN_NAME, ' AS ', UCASE(TABLE_NAME), '_', COLUMN_NAME, ',')
-- FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'PHONE';
-- 
-- -- Get the insert report field procedure calls (display name and is default may need to be updated)
-- SELECT CONCAT('CALL INSERTREPORTFIELD(''', COLUMN_NAME, ''', ''', COLUMN_NAME, ''', b''0'', ',
-- CASE
-- 	WHEN DATA_TYPE = 'int' THEN 2
-- 	WHEN DATA_TYPE = 'smallint' THEN 2
-- 	WHEN DATA_TYPE = 'bigint' THEN 3
-- 	WHEN DATA_TYPE = 'datetime' THEN 4
-- 	WHEN DATA_TYPE = 'decimal' THEN 5
-- 	WHEN DATA_TYPE = 'bit' THEN 6
-- 	ELSE 1
-- 	END,
-- ', @REPORTFIELDGROUP_ID);') FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'VW_GIFTS';

CALL NUMBERBUILDER();

-- Create Report Data Sources
INSERT INTO REPORTDATASOURCE
	(REPORT_NAME)
VALUES
	('Administrative');

INSERT INTO REPORTDATASOURCE
	(REPORT_NAME)
VALUES
	('Audit History');

INSERT INTO REPORTDATASOURCE
	(REPORT_NAME)
VALUES
	('Constituents');

INSERT INTO REPORTDATASOURCE
	(REPORT_NAME)
VALUES
	('Constituents & Relationship Details');

INSERT INTO REPORTDATASOURCE
	(REPORT_NAME)
VALUES
	('Constituents & Transactions');

INSERT INTO REPORTDATASOURCE
	(REPORT_NAME)
VALUES
	('Journals');

INSERT INTO REPORTDATASOURCE
	(REPORT_NAME)
VALUES
	('Transactions');


-- *********************************************************************************************************************
--
-- Code Types & Codes View Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_CODETYPES_CODES;
CREATE VIEW VW_CODETYPES_CODES
AS
	SELECT
		CODE_TYPE.ID AS CODE_TYPE_ID,
		CODE_TYPE.LABEL AS CODE_TYPE_LABEL,
		CODE_TYPE.NAME AS CODE_TYPE_NAME,
		CODE_TYPE.SITE_NAME AS CODE_TYPE_SITE_NAME,

		CODE.CODE_ID AS CODE_CODE_ID,
		CODE.CODE_DESCRIPTION AS CODE_CODE_DESCRIPTION,
		CODE.INACTIVE AS CODE_INACTIVE,
		CODE.CODE_VALUE AS CODE_CODE_VALUE,
		CODE.CODE_TYPE_ID AS CODE_CODE_TYPE_ID
	FROM CODE_TYPE
	LEFT JOIN CODE ON CODE_TYPE.ID = CODE.CODE_TYPE_ID
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Administrative');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Code Types & Codes', 0, 'VW_CODETYPES_CODES', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();


-- ***********************************************************************
-- Code Type Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Code Type Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Code Type ID
CALL INSERTREPORTFIELD('CODE_TYPE_ID', 'Code Type ID', b'0', 3, @REPORTFIELDGROUP_ID);

-- Code Type
CALL INSERTREPORTFIELD('CODE_TYPE_LABEL', 'Code Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('CODE_TYPE_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Code Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Code Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Code ID
CALL INSERTREPORTFIELD('CODE_CODE_ID', 'Code ID', b'0', 3, @REPORTFIELDGROUP_ID);

-- Code Value
CALL INSERTREPORTFIELD('CODE_CODE_VALUE', 'Code Value', b'1', 1, @REPORTFIELDGROUP_ID);

-- Description
CALL INSERTREPORTFIELD('CODE_CODE_DESCRIPTION', 'Description', b'1', 1, @REPORTFIELDGROUP_ID);

-- Inactive
CALL INSERTREPORTFIELD('CODE_INACTIVE', 'Inactive', b'0', 6, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Picklists View & Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_PICKLISTS;
CREATE VIEW VW_PICKLISTS
AS
	SELECT
		SPLITCAMELCASEDSTRING(PICKLIST_NAME) AS PICKLIST_PICKLIST_NAME,
		PICKLIST.ENTITY_TYPE AS PICKLIST_ENTITY_TYPE,
		PICKLIST.MULTISELECT AS PICKLIST_MULTISELECT,
		PICKLIST.SITE_NAME AS PICKLIST_SITE_NAME,

		PICKLIST_ITEM.ITEM_NAME AS PICKLIST_ITEM_ITEM_NAME,
		PICKLIST_ITEM.DEFAULT_DISPLAY_VALUE AS PICKLIST_ITEM_DEFAULT_DISPLAY_VALUE,
		PICKLIST_ITEM.ITEM_ORDER AS PICKLIST_ITEM_ITEM_ORDER,
		PICKLIST_ITEM.INACTIVE AS PICKLIST_ITEM_INACTIVE
	FROM PICKLIST
	LEFT JOIN PICKLIST_ITEM ON PICKLIST.PICKLIST_ID = PICKLIST_ITEM.PICKLIST_ID
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Administrative');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Picklists', 0, 'VW_PICKLISTS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();


-- ***********************************************************************
-- Picklist Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Picklist Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Picklist Name
CALL INSERTREPORTFIELD('PICKLIST_PICKLIST_NAME', 'Picklist Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('PICKLIST_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Picklist Item Name
CALL INSERTREPORTFIELD('PICKLIST_ITEM_ITEM_NAME', 'Picklist Item Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Picklist Item Description
CALL INSERTREPORTFIELD('PICKLIST_ITEM_DEFAULT_DISPLAY_VALUE', 'Picklist Item Description', b'1', 1, @REPORTFIELDGROUP_ID);

-- Picklist Item Inactive
CALL INSERTREPORTFIELD('PICKLIST_ITEM_INACTIVE', 'Picklist Item Inactive', b'1', 6, @REPORTFIELDGROUP_ID);

-- Picklist Item Order
CALL INSERTREPORTFIELD('PICKLIST_ITEM_ITEM_ORDER', 'Picklist Item Order', b'0', 2, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Constituents View & Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_CONSTITUENTS;
CREATE VIEW VW_CONSTITUENTS
AS
	SELECT
		PERSON.PERSON_ID AS PERSON_PERSON_ID,
		CASE WHEN CONSTITUENT_TYPE = 'individual' THEN CONSTITUENT_INDIVIDUAL_ROLES WHEN CONSTITUENT_TYPE = 'organization' THEN CONSTITUENT_ORGANIZATION_ROLES ELSE NULL END AS PERSON_CONSTITUENT_ROLES,
		CASE WHEN CONSTITUENT_TYPE = 'individual' THEN GETVALUE(CONSTITUENT_INDIVIDUAL_ROLES, ',', CONSTITUENT_ROLES_NUMBERS.NUMBER) WHEN CONSTITUENT_TYPE = 'organization' THEN GETVALUE(CONSTITUENT_ORGANIZATION_ROLES, ',', CONSTITUENT_ROLES_NUMBERS.NUMBER) ELSE NULL END PERSON_CONSTITUENT_ROLE,
		CONSTITUENT_TYPE AS PERSON_CONSTITUENT_TYPE,
		CREATE_DATE AS PERSON_CREATE_DATE,
		FIRST_NAME AS PERSON_FIRST_NAME,
		LAPSED_DONOR AS PERSON_LAPSED_DONOR,
		LAST_NAME AS PERSON_LAST_NAME,
		LEGAL_NAME AS PERSON_LEGAL_NAME,
		LOGIN_ID AS PERSON_LOGIN_ID,
		MAJOR_DONOR AS PERSON_MAJOR_DONOR,
		MARITAL_STATUS AS PERSON_MARITAL_STATUS,
		MIDDLE_NAME AS PERSON_MIDDLE_NAME,
		NCAIS_CODE AS PERSON_NCAIS_CODE,
		ORGANIZATION_NAME AS PERSON_ORGANIZATION_NAME,
		PREFERRED_PHONE_TYPE AS PERSON_PREFERRED_PHONE_TYPE,
		RECOGNITION_NAME AS PERSON_RECOGNITION_NAME,
		SUFFIX AS PERSON_SUFFIX,
		TITLE AS PERSON_TITLE,
		UPDATE_DATE AS PERSON_UPDATE_DATE,
		SITE_NAME AS PERSON_SITE_NAME
	FROM PERSON
	LEFT JOIN NUMBERS AS CONSTITUENT_ROLES_NUMBERS
		ON CONSTITUENT_ROLES_NUMBERS.NUMBER <=
		CASE WHEN CONSTITUENT_TYPE = 'individual' THEN COUNTOFVALUES(CONSTITUENT_INDIVIDUAL_ROLES, ',') WHEN CONSTITUENT_TYPE = 'organization' THEN COUNTOFVALUES(CONSTITUENT_ORGANIZATION_ROLES, ',') ELSE 1 END
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Constituents');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Constituents', 0, 'VW_CONSTITUENTS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();


-- ***********************************************************************
-- Contact Distributions Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Contact Details', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('PERSON_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Manager Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager''))', 'Account Manager Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Account Manager Account Number
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager'')', 'Account Manager Account Number', b'0', 3, @REPORTFIELDGROUP_ID);

-- Constituent Type
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_TYPE', 'Constituent Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLES', 'Profile Types', b'0', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLE', 'Profile Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Title
CALL INSERTREPORTFIELD('PERSON_TITLE', 'Title', b'0', 1, @REPORTFIELDGROUP_ID);

-- First Name
CALL INSERTREPORTFIELD('PERSON_FIRST_NAME', 'First Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Middle Name
CALL INSERTREPORTFIELD('PERSON_MIDDLE_NAME', 'Middle Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Name
CALL INSERTREPORTFIELD('PERSON_LAST_NAME', 'Last Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Suffix
CALL INSERTREPORTFIELD('PERSON_SUFFIX', 'Suffix', b'0', 1, @REPORTFIELDGROUP_ID);

-- Recognition Name
CALL INSERTREPORTFIELD('PERSON_RECOGNITION_NAME', 'Recognition Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Organization Name
CALL INSERTREPORTFIELD('PERSON_ORGANIZATION_NAME', 'Organization Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Legal Name
CALL INSERTREPORTFIELD('PERSON_LEGAL_NAME', 'Legal Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.matching'')', 'Matching', b'0', 1, @REPORTFIELDGROUP_ID);

-- Percent Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.percentMatch'')', 'Percent Matching', b'0', 3, @REPORTFIELDGROUP_ID);

-- Maximum Match
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.maximumMatch'')', 'Maximum Match', b'0', 5, @REPORTFIELDGROUP_ID);

-- Website
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.website'')', 'Website', b'0', 1, @REPORTFIELDGROUP_ID);

-- Tax ID
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.taxid'')', 'Tax ID', b'0', 1, @REPORTFIELDGROUP_ID);

-- NCAIS Code
CALL INSERTREPORTFIELD('PERSON_NCAIS_CODE', 'NCAIS Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Communication Preferences
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''communicationPreferences'')', 'Communication Preferences', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Format
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''emailFormat'')', 'Email Format', b'0', 1, @REPORTFIELDGROUP_ID);

-- Create Date
CALL INSERTREPORTFIELD('PERSON_CREATE_DATE', 'Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Update Date
CALL INSERTREPORTFIELD('PERSON_UPDATE_DATE', 'Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Demographic Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Demographic Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Marital Status
CALL INSERTREPORTFIELD('PERSON_MARITAL_STATUS', 'Marital Status', b'0', 3, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.birthDate'')', 'Birth Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Deceased
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.deceased'')', 'Deceased', b'0', 6, @REPORTFIELDGROUP_ID);

-- Gender
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.gender'')', 'Gender', b'0', 1, @REPORTFIELDGROUP_ID);

-- Race
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.race'')', 'Race', b'0', 1, @REPORTFIELDGROUP_ID);

-- Military
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.military'')', 'Military', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Miscellaneous Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Miscellaneous Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Major Donor
CALL INSERTREPORTFIELD('PERSON_MAJOR_DONOR', 'Major Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Lapsed Donor
CALL INSERTREPORTFIELD('PERSON_LAPSED_DONOR', 'Lapsed Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('PERSON_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Constituents & Addresses View & Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_CONSTITUENTS_ADDRESSES;
CREATE VIEW VW_CONSTITUENTS_ADDRESSES
AS
	SELECT
		PERSON.PERSON_ID AS PERSON_PERSON_ID,
		CASE WHEN PERSON.CONSTITUENT_TYPE = 'individual' THEN CONSTITUENT_INDIVIDUAL_ROLES WHEN CONSTITUENT_TYPE = 'organization' THEN CONSTITUENT_ORGANIZATION_ROLES ELSE NULL END AS PERSON_CONSTITUENT_ROLES,
		CASE WHEN PERSON.CONSTITUENT_TYPE = 'individual' THEN GETVALUE(CONSTITUENT_INDIVIDUAL_ROLES, ',', CONSTITUENT_ROLES_NUMBERS.NUMBER) WHEN CONSTITUENT_TYPE = 'organization' THEN GETVALUE(CONSTITUENT_ORGANIZATION_ROLES, ',', CONSTITUENT_ROLES_NUMBERS.NUMBER) ELSE NULL END PERSON_CONSTITUENT_ROLE,
		PERSON.CONSTITUENT_TYPE AS PERSON_CONSTITUENT_TYPE,
		PERSON.CREATE_DATE AS PERSON_CREATE_DATE,
		PERSON.FIRST_NAME AS PERSON_FIRST_NAME,
		PERSON.LAPSED_DONOR AS PERSON_LAPSED_DONOR,
		PERSON.LAST_NAME AS PERSON_LAST_NAME,
		PERSON.LEGAL_NAME AS PERSON_LEGAL_NAME,
		PERSON.LOGIN_ID AS PERSON_LOGIN_ID,
		PERSON.MAJOR_DONOR AS PERSON_MAJOR_DONOR,
		PERSON.MARITAL_STATUS AS PERSON_MARITAL_STATUS,
		PERSON.MIDDLE_NAME AS PERSON_MIDDLE_NAME,
		PERSON.NCAIS_CODE AS PERSON_NCAIS_CODE,
		PERSON.ORGANIZATION_NAME AS PERSON_ORGANIZATION_NAME,
		PERSON.PREFERRED_PHONE_TYPE AS PERSON_PREFERRED_PHONE_TYPE,
		PERSON.RECOGNITION_NAME AS PERSON_RECOGNITION_NAME,
		PERSON.SUFFIX AS PERSON_SUFFIX,
		PERSON.TITLE AS PERSON_TITLE,
		PERSON.UPDATE_DATE AS PERSON_UPDATE_DATE,
		PERSON.SITE_NAME AS PERSON_SITE_NAME,

		-- Address Information
		ADDRESS.ADDRESS_ID AS ADDRESS_ADDRESS_ID,
		ADDRESS.ADDRESS_TYPE AS ADDRESS_ADDRESS_TYPE,
		ADDRESS.ACTIVATION_STATUS AS ADDRESS_ACTIVATION_STATUS,
		ADDRESS.EFFECTIVE_DATE AS ADDRESS_EFFECTIVE_DATE,
		ADDRESS.ADDRESS_LINE_1 AS ADDRESS_ADDRESS_LINE_1,
		ADDRESS.ADDRESS_LINE_2 AS ADDRESS_ADDRESS_LINE_2,
		ADDRESS.ADDRESS_LINE_3 AS ADDRESS_ADDRESS_LINE_3,
		ADDRESS.CITY AS ADDRESS_CITY,
		ADDRESS.STATE_PROVINCE AS ADDRESS_STATE_PROVINCE,
		ADDRESS.COUNTRY AS ADDRESS_COUNTRY,
		ADDRESS.POSTAL_CODE AS ADDRESS_POSTAL_CODE,
		ADDRESS.RECEIVE_CORRESPONDENCE AS ADDRESS_RECEIVE_CORRESPONDENCE,
		ADDRESS.COMMENT AS ADDRESS_COMMENT,
		ADDRESS.SEASONAL_END_DATE AS ADDRESS_SEASONAL_END_DATE,
		ADDRESS.SEASONAL_START_DATE AS ADDRESS_SEASONAL_START_DATE,
		ADDRESS.TEMPORARY_END_DATE AS ADDRESS_TEMPORARY_END_DATE,
		ADDRESS.TEMPORARY_START_DATE AS ADDRESS_TEMPORARY_START_DATE,
		ADDRESS.CREATE_DATE AS ADDRESS_CREATE_DATE,
		ADDRESS.UPDATE_DATE AS ADDRESS_UPDATE_DATE,
		ADDRESS.INACTIVE AS ADDRESS_INACTIVE
	FROM PERSON
	LEFT JOIN NUMBERS AS CONSTITUENT_ROLES_NUMBERS
		ON CONSTITUENT_ROLES_NUMBERS.NUMBER <=
		CASE WHEN CONSTITUENT_TYPE = 'individual' THEN COUNTOFVALUES(CONSTITUENT_INDIVIDUAL_ROLES, ',') WHEN CONSTITUENT_TYPE = 'organization' THEN COUNTOFVALUES(CONSTITUENT_ORGANIZATION_ROLES, ',') ELSE 1 END
	LEFT JOIN ADDRESS ON PERSON.PERSON_ID = ADDRESS.PERSON_ID
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Constituents');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Constituents & Addresses', 0, 'VW_CONSTITUENTS_ADDRESSES', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();


-- ***********************************************************************
-- Contact Details Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Contact Details', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('PERSON_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Manager Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager''))', 'Account Manager Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Account Manager Account Number
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager'')', 'Account Manager Account Number', b'0', 3, @REPORTFIELDGROUP_ID);

-- Constituent Type
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_TYPE', 'Constituent Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLES', 'Profile Types', b'0', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLE', 'Profile Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Title
CALL INSERTREPORTFIELD('PERSON_TITLE', 'Title', b'0', 1, @REPORTFIELDGROUP_ID);

-- First Name
CALL INSERTREPORTFIELD('PERSON_FIRST_NAME', 'First Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Middle Name
CALL INSERTREPORTFIELD('PERSON_MIDDLE_NAME', 'Middle Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Name
CALL INSERTREPORTFIELD('PERSON_LAST_NAME', 'Last Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Suffix
CALL INSERTREPORTFIELD('PERSON_SUFFIX', 'Suffix', b'0', 1, @REPORTFIELDGROUP_ID);

-- Recognition Name
CALL INSERTREPORTFIELD('PERSON_RECOGNITION_NAME', 'Recognition Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Organization Name
CALL INSERTREPORTFIELD('PERSON_ORGANIZATION_NAME', 'Organization Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Legal Name
CALL INSERTREPORTFIELD('PERSON_LEGAL_NAME', 'Legal Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.matching'')', 'Matching', b'0', 1, @REPORTFIELDGROUP_ID);

-- Percent Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.percentMatch'')', 'Percent Matching', b'0', 3, @REPORTFIELDGROUP_ID);

-- Maximum Match
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.maximumMatch'')', 'Maximum Match', b'0', 5, @REPORTFIELDGROUP_ID);

-- Website
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.website'')', 'Website', b'0', 1, @REPORTFIELDGROUP_ID);

-- Tax ID
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.taxid'')', 'Tax ID', b'0', 1, @REPORTFIELDGROUP_ID);

-- NCAIS Code
CALL INSERTREPORTFIELD('PERSON_NCAIS_CODE', 'NCAIS Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Communication Preferences
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''communicationPreferences'')', 'Communication Preferences', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Format
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''emailFormat'')', 'Email Format', b'0', 1, @REPORTFIELDGROUP_ID);

-- Create Date
CALL INSERTREPORTFIELD('PERSON_CREATE_DATE', 'Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Update Date
CALL INSERTREPORTFIELD('PERSON_UPDATE_DATE', 'Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Demographic Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Demographic Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Marital Status
CALL INSERTREPORTFIELD('PERSON_MARITAL_STATUS', 'Marital Status', b'0', 3, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.birthDate'')', 'Birth Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Deceased
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.deceased'')', 'Deceased', b'0', 6, @REPORTFIELDGROUP_ID);

-- Gender
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.gender'')', 'Gender', b'0', 1, @REPORTFIELDGROUP_ID);

-- Race
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.race'')', 'Race', b'0', 1, @REPORTFIELDGROUP_ID);

-- Military
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.military'')', 'Military', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Miscellaneous Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Miscellaneous Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Major Donor
CALL INSERTREPORTFIELD('PERSON_MAJOR_DONOR', 'Major Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Lapsed Donor
CALL INSERTREPORTFIELD('PERSON_LAPSED_DONOR', 'Lapsed Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('PERSON_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Address Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Address Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Address ID
CALL INSERTREPORTFIELD('ADDRESS_ADDRESS_ID', 'Address ID', b'0', 3, @REPORTFIELDGROUP_ID);

-- Address Type
CALL INSERTREPORTFIELD('ADDRESS_ADDRESS_TYPE', 'Address Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Status
CALL INSERTREPORTFIELD('ADDRESS_ACTIVATION_STATUS', 'Address Status', b'0', 1, @REPORTFIELDGROUP_ID);

-- Effective Date
CALL INSERTREPORTFIELD('ADDRESS_EFFECTIVE_DATE', 'Address Effective Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Seasonal Start Date
CALL INSERTREPORTFIELD('ADDRESS_SEASONAL_START_DATE', 'Seasonal Start Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Seasonal End Date
CALL INSERTREPORTFIELD('ADDRESS_SEASONAL_END_DATE', 'Seasonal End Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Temporary Start Date
CALL INSERTREPORTFIELD('ADDRESS_TEMPORARY_START_DATE', 'Temporary Start Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Temporary End Date
CALL INSERTREPORTFIELD('ADDRESS_TEMPORARY_END_DATE', 'Temporary End Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Address Line 1
CALL INSERTREPORTFIELD('ADDRESS_ADDRESS_LINE_1', 'Address Line 1', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 2
CALL INSERTREPORTFIELD('ADDRESS_ADDRESS_LINE_2', 'Address Line 2', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 3
CALL INSERTREPORTFIELD('ADDRESS_ADDRESS_LINE_3', 'Address Line 2', b'0', 1, @REPORTFIELDGROUP_ID);

-- City
CALL INSERTREPORTFIELD('ADDRESS_CITY', 'City', b'0', 1, @REPORTFIELDGROUP_ID);

-- State/Province
CALL INSERTREPORTFIELD('ADDRESS_STATE_PROVINCE', 'State/Province', b'0', 1, @REPORTFIELDGROUP_ID);

-- Country
CALL INSERTREPORTFIELD('ADDRESS_COUNTRY', 'Country', b'0', 1, @REPORTFIELDGROUP_ID);

-- Zip/Postal Code
CALL INSERTREPORTFIELD('ADDRESS_POSTAL_CODE', 'Zip/Postal Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Receive Correspondence
CALL INSERTREPORTFIELD('ADDRESS_RECEIVE_CORRESPONDENCE', 'Receive Correspondence', b'0', 6, @REPORTFIELDGROUP_ID);

-- Comments
CALL INSERTREPORTFIELD('ADDRESS_COMMENT', 'Comments', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Create Date
CALL INSERTREPORTFIELD('ADDRESS_CREATE_DATE', 'Address Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Address Update Date
CALL INSERTREPORTFIELD('ADDRESS_UPDATE_DATE', 'Address Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Address Inactive
CALL INSERTREPORTFIELD('ADDRESS_INACTIVE', 'Address Inactive', b'0', 6, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Constituents & Email Addresses View & Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_CONSTITUENTS_EMAILS;
CREATE VIEW VW_CONSTITUENTS_EMAILS
AS
	SELECT
		PERSON.PERSON_ID AS PERSON_PERSON_ID,
		CASE WHEN PERSON.CONSTITUENT_TYPE = 'individual' THEN CONSTITUENT_INDIVIDUAL_ROLES WHEN CONSTITUENT_TYPE = 'organization' THEN CONSTITUENT_ORGANIZATION_ROLES ELSE NULL END AS PERSON_CONSTITUENT_ROLES,
		CASE WHEN PERSON.CONSTITUENT_TYPE = 'individual' THEN GETVALUE(CONSTITUENT_INDIVIDUAL_ROLES, ',', CONSTITUENT_ROLES_NUMBERS.NUMBER) WHEN CONSTITUENT_TYPE = 'organization' THEN GETVALUE(CONSTITUENT_ORGANIZATION_ROLES, ',', CONSTITUENT_ROLES_NUMBERS.NUMBER) ELSE NULL END PERSON_CONSTITUENT_ROLE,
		PERSON.CONSTITUENT_TYPE AS PERSON_CONSTITUENT_TYPE,
		PERSON.CREATE_DATE AS PERSON_CREATE_DATE,
		PERSON.FIRST_NAME AS PERSON_FIRST_NAME,
		PERSON.LAPSED_DONOR AS PERSON_LAPSED_DONOR,
		PERSON.LAST_NAME AS PERSON_LAST_NAME,
		PERSON.LEGAL_NAME AS PERSON_LEGAL_NAME,
		PERSON.LOGIN_ID AS PERSON_LOGIN_ID,
		PERSON.MAJOR_DONOR AS PERSON_MAJOR_DONOR,
		PERSON.MARITAL_STATUS AS PERSON_MARITAL_STATUS,
		PERSON.MIDDLE_NAME AS PERSON_MIDDLE_NAME,
		PERSON.NCAIS_CODE AS PERSON_NCAIS_CODE,
		PERSON.ORGANIZATION_NAME AS PERSON_ORGANIZATION_NAME,
		PERSON.PREFERRED_PHONE_TYPE AS PERSON_PREFERRED_PHONE_TYPE,
		PERSON.RECOGNITION_NAME AS PERSON_RECOGNITION_NAME,
		PERSON.SUFFIX AS PERSON_SUFFIX,
		PERSON.TITLE AS PERSON_TITLE,
		PERSON.UPDATE_DATE AS PERSON_UPDATE_DATE,
		PERSON.SITE_NAME AS PERSON_SITE_NAME,

		-- Email Information
		EMAIL.EMAIL_ID AS EMAIL_EMAIL_ID,
		EMAIL.EMAIL_TYPE AS EMAIL_EMAIL_TYPE,
		EMAIL.ACTIVATION_STATUS AS EMAIL_ACTIVATION_STATUS,
		EMAIL.EFFECTIVE_DATE AS EMAIL_EFFECTIVE_DATE,
		EMAIL.SEASONAL_START_DATE AS EMAIL_SEASONAL_START_DATE,
		EMAIL.SEASONAL_END_DATE AS EMAIL_SEASONAL_END_DATE,
		EMAIL.TEMPORARY_START_DATE AS EMAIL_TEMPORARY_START_DATE,
		EMAIL.TEMPORARY_END_DATE AS EMAIL_TEMPORARY_END_DATE,
		EMAIL.EMAIL_ADDRESS AS EMAIL_EMAIL_ADDRESS,
		EMAIL.EMAIL_DISPLAY AS EMAIL_EMAIL_DISPLAY,
		EMAIL.RECEIVE_CORRESPONDENCE AS EMAIL_RECEIVE_CORRESPONDENCE,
		EMAIL.COMMENT AS EMAIL_COMMENT,
		EMAIL.CREATE_DATE AS EMAIL_CREATE_DATE,
		EMAIL.UPDATE_DATE AS EMAIL_UPDATE_DATE,
		EMAIL.INACTIVE AS EMAIL_INACTIVE
	FROM PERSON
	LEFT JOIN NUMBERS AS CONSTITUENT_ROLES_NUMBERS
		ON CONSTITUENT_ROLES_NUMBERS.NUMBER <=
		CASE WHEN CONSTITUENT_TYPE = 'individual' THEN COUNTOFVALUES(CONSTITUENT_INDIVIDUAL_ROLES, ',') WHEN CONSTITUENT_TYPE = 'organization' THEN COUNTOFVALUES(CONSTITUENT_ORGANIZATION_ROLES, ',') ELSE 1 END
	LEFT JOIN EMAIL ON PERSON.PERSON_ID = EMAIL.PERSON_ID
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Constituents');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Constituents & Email Addresses', 0, 'VW_CONSTITUENTS_EMAILS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();


-- ***********************************************************************
-- Contact Details Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Contact Details', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('PERSON_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Manager Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager''))', 'Account Manager Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Account Manager Account Number
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager'')', 'Account Manager Account Number', b'0', 3, @REPORTFIELDGROUP_ID);

-- Constituent Type
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_TYPE', 'Constituent Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLES', 'Profile Types', b'0', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLE', 'Profile Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Title
CALL INSERTREPORTFIELD('PERSON_TITLE', 'Title', b'0', 1, @REPORTFIELDGROUP_ID);

-- First Name
CALL INSERTREPORTFIELD('PERSON_FIRST_NAME', 'First Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Middle Name
CALL INSERTREPORTFIELD('PERSON_MIDDLE_NAME', 'Middle Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Name
CALL INSERTREPORTFIELD('PERSON_LAST_NAME', 'Last Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Suffix
CALL INSERTREPORTFIELD('PERSON_SUFFIX', 'Suffix', b'0', 1, @REPORTFIELDGROUP_ID);

-- Recognition Name
CALL INSERTREPORTFIELD('PERSON_RECOGNITION_NAME', 'Recognition Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Organization Name
CALL INSERTREPORTFIELD('PERSON_ORGANIZATION_NAME', 'Organization Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Legal Name
CALL INSERTREPORTFIELD('PERSON_LEGAL_NAME', 'Legal Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.matching'')', 'Matching', b'0', 1, @REPORTFIELDGROUP_ID);

-- Percent Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.percentMatch'')', 'Percent Matching', b'0', 3, @REPORTFIELDGROUP_ID);

-- Maximum Match
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.maximumMatch'')', 'Maximum Match', b'0', 5, @REPORTFIELDGROUP_ID);

-- Website
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.website'')', 'Website', b'0', 1, @REPORTFIELDGROUP_ID);

-- Tax ID
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.taxid'')', 'Tax ID', b'0', 1, @REPORTFIELDGROUP_ID);

-- NCAIS Code
CALL INSERTREPORTFIELD('PERSON_NCAIS_CODE', 'NCAIS Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Communication Preferences
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''communicationPreferences'')', 'Communication Preferences', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Format
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''emailFormat'')', 'Email Format', b'0', 1, @REPORTFIELDGROUP_ID);

-- Create Date
CALL INSERTREPORTFIELD('PERSON_CREATE_DATE', 'Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Update Date
CALL INSERTREPORTFIELD('PERSON_UPDATE_DATE', 'Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Demographic Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Demographic Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Marital Status
CALL INSERTREPORTFIELD('PERSON_MARITAL_STATUS', 'Marital Status', b'0', 3, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.birthDate'')', 'Birth Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Deceased
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.deceased'')', 'Deceased', b'0', 6, @REPORTFIELDGROUP_ID);

-- Gender
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.gender'')', 'Gender', b'0', 1, @REPORTFIELDGROUP_ID);

-- Race
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.race'')', 'Race', b'0', 1, @REPORTFIELDGROUP_ID);

-- Military
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.military'')', 'Military', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Miscellaneous Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Miscellaneous Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Major Donor
CALL INSERTREPORTFIELD('PERSON_MAJOR_DONOR', 'Major Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Lapsed Donor
CALL INSERTREPORTFIELD('PERSON_LAPSED_DONOR', 'Lapsed Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('PERSON_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Email Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Email Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Email Address ID
CALL INSERTREPORTFIELD('EMAIL_EMAIL_ID', 'Email Address ID', b'0', 3, @REPORTFIELDGROUP_ID);

-- Email Type
CALL INSERTREPORTFIELD('EMAIL_EMAIL_TYPE', 'Email Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Status
CALL INSERTREPORTFIELD('EMAIL_ACTIVATION_STATUS', 'Email Status', b'0', 1, @REPORTFIELDGROUP_ID);

-- Effective Date
CALL INSERTREPORTFIELD('EMAIL_EFFECTIVE_DATE', 'Effective Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Seasonal Start Date
CALL INSERTREPORTFIELD('EMAIL_SEASONAL_START_DATE', 'Seasonal Start Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Seasonal End Date
CALL INSERTREPORTFIELD('EMAIL_SEASONAL_END_DATE', 'Seasonal End Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Temporary Start Date
CALL INSERTREPORTFIELD('EMAIL_TEMPORARY_START_DATE', 'Temporary Start Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Temporary End Date
CALL INSERTREPORTFIELD('EMAIL_TEMPORARY_END_DATE', 'Temporary End Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Email Address
CALL INSERTREPORTFIELD('EMAIL_EMAIL_ADDRESS', 'Email Address', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Display
CALL INSERTREPORTFIELD('EMAIL_EMAIL_DISPLAY', 'Email Display', b'0', 1, @REPORTFIELDGROUP_ID);

-- Receive Correspondence
CALL INSERTREPORTFIELD('EMAIL_RECEIVE_CORRESPONDENCE', 'Receive Correspondence', b'0', 6, @REPORTFIELDGROUP_ID);

-- Comments
CALL INSERTREPORTFIELD('EMAIL_COMMENT', 'Comments', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Address Create Date
CALL INSERTREPORTFIELD('EMAIL_CREATE_DATE', 'Email Address Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Email Address Update Date
CALL INSERTREPORTFIELD('EMAIL_UPDATE_DATE', 'Email Address Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Email Address Inactive
CALL INSERTREPORTFIELD('EMAIL_INACTIVE', 'Email Address Inactive', b'0', 6, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Constituents & Phone Numbers View & Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_CONSTITUENTS_PHONENUMBERS;
CREATE VIEW VW_CONSTITUENTS_PHONENUMBERS
AS
	SELECT
		PERSON.PERSON_ID AS PERSON_PERSON_ID,
		CASE WHEN PERSON.CONSTITUENT_TYPE = 'individual' THEN CONSTITUENT_INDIVIDUAL_ROLES WHEN CONSTITUENT_TYPE = 'organization' THEN CONSTITUENT_ORGANIZATION_ROLES ELSE NULL END AS PERSON_CONSTITUENT_ROLES,
		CASE WHEN PERSON.CONSTITUENT_TYPE = 'individual' THEN GETVALUE(CONSTITUENT_INDIVIDUAL_ROLES, ',', CONSTITUENT_ROLES_NUMBERS.NUMBER) WHEN CONSTITUENT_TYPE = 'organization' THEN GETVALUE(CONSTITUENT_ORGANIZATION_ROLES, ',', CONSTITUENT_ROLES_NUMBERS.NUMBER) ELSE NULL END PERSON_CONSTITUENT_ROLE,
		PERSON.CONSTITUENT_TYPE AS PERSON_CONSTITUENT_TYPE,
		PERSON.CREATE_DATE AS PERSON_CREATE_DATE,
		PERSON.FIRST_NAME AS PERSON_FIRST_NAME,
		PERSON.LAPSED_DONOR AS PERSON_LAPSED_DONOR,
		PERSON.LAST_NAME AS PERSON_LAST_NAME,
		PERSON.LEGAL_NAME AS PERSON_LEGAL_NAME,
		PERSON.LOGIN_ID AS PERSON_LOGIN_ID,
		PERSON.MAJOR_DONOR AS PERSON_MAJOR_DONOR,
		PERSON.MARITAL_STATUS AS PERSON_MARITAL_STATUS,
		PERSON.MIDDLE_NAME AS PERSON_MIDDLE_NAME,
		PERSON.NCAIS_CODE AS PERSON_NCAIS_CODE,
		PERSON.ORGANIZATION_NAME AS PERSON_ORGANIZATION_NAME,
		PERSON.PREFERRED_PHONE_TYPE AS PERSON_PREFERRED_PHONE_TYPE,
		PERSON.RECOGNITION_NAME AS PERSON_RECOGNITION_NAME,
		PERSON.SUFFIX AS PERSON_SUFFIX,
		PERSON.TITLE AS PERSON_TITLE,
		PERSON.UPDATE_DATE AS PERSON_UPDATE_DATE,
		PERSON.SITE_NAME AS PERSON_SITE_NAME,

		-- Phone Number Information
		PHONE.PHONE_ID AS PHONE_PHONE_ID,
		PHONE.PHONE_TYPE AS PHONE_PHONE_TYPE,
		PHONE.ACTIVATION_STATUS AS PHONE_ACTIVATION_STATUS,
		PHONE.EFFECTIVE_DATE AS PHONE_EFFECTIVE_DATE,
		PHONE.SEASONAL_START_DATE AS PHONE_SEASONAL_START_DATE,
		PHONE.SEASONAL_END_DATE AS PHONE_SEASONAL_END_DATE,
		PHONE.TEMPORARY_START_DATE AS PHONE_TEMPORARY_START_DATE,
		PHONE.TEMPORARY_END_DATE AS PHONE_TEMPORARY_END_DATE,
		PHONE.NUMBER AS PHONE_NUMBER,
		PHONE.PROVIDER AS PHONE_PROVIDER,
		PHONE.SMS AS PHONE_SMS,
		PHONE.RECEIVE_CORRESPONDENCE AS PHONE_RECEIVE_CORRESPONDENCE,
		PHONE.COMMENT AS PHONE_COMMENT,
		PHONE.CREATE_DATE AS PHONE_CREATE_DATE,
		PHONE.UPDATE_DATE AS PHONE_UPDATE_DATE,
		PHONE.INACTIVE AS PHONE_INACTIVE
	FROM PERSON
	LEFT JOIN NUMBERS AS CONSTITUENT_ROLES_NUMBERS
		ON CONSTITUENT_ROLES_NUMBERS.NUMBER <=
		CASE WHEN CONSTITUENT_TYPE = 'individual' THEN COUNTOFVALUES(CONSTITUENT_INDIVIDUAL_ROLES, ',') WHEN CONSTITUENT_TYPE = 'organization' THEN COUNTOFVALUES(CONSTITUENT_ORGANIZATION_ROLES, ',') ELSE 1 END
	LEFT JOIN PHONE ON PERSON.PERSON_ID = PHONE.PERSON_ID
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Constituents');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Constituents & Phone Numbers', 0, 'VW_CONSTITUENTS_PHONENUMBERS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();


-- ***********************************************************************
-- Contact Details Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Contact Details', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('PERSON_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Manager Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager''))', 'Account Manager Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Account Manager Account Number
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager'')', 'Account Manager Account Number', b'0', 3, @REPORTFIELDGROUP_ID);

-- Constituent Type
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_TYPE', 'Constituent Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLES', 'Profile Types', b'0', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLE', 'Profile Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Title
CALL INSERTREPORTFIELD('PERSON_TITLE', 'Title', b'0', 1, @REPORTFIELDGROUP_ID);

-- First Name
CALL INSERTREPORTFIELD('PERSON_FIRST_NAME', 'First Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Middle Name
CALL INSERTREPORTFIELD('PERSON_MIDDLE_NAME', 'Middle Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Name
CALL INSERTREPORTFIELD('PERSON_LAST_NAME', 'Last Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Suffix
CALL INSERTREPORTFIELD('PERSON_SUFFIX', 'Suffix', b'0', 1, @REPORTFIELDGROUP_ID);

-- Recognition Name
CALL INSERTREPORTFIELD('PERSON_RECOGNITION_NAME', 'Recognition Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Organization Name
CALL INSERTREPORTFIELD('PERSON_ORGANIZATION_NAME', 'Organization Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Legal Name
CALL INSERTREPORTFIELD('PERSON_LEGAL_NAME', 'Legal Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.matching'')', 'Matching', b'0', 1, @REPORTFIELDGROUP_ID);

-- Percent Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.percentMatch'')', 'Percent Matching', b'0', 3, @REPORTFIELDGROUP_ID);

-- Maximum Match
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.maximumMatch'')', 'Maximum Match', b'0', 5, @REPORTFIELDGROUP_ID);

-- Website
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.website'')', 'Website', b'0', 1, @REPORTFIELDGROUP_ID);

-- Tax ID
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.taxid'')', 'Tax ID', b'0', 1, @REPORTFIELDGROUP_ID);

-- NCAIS Code
CALL INSERTREPORTFIELD('PERSON_NCAIS_CODE', 'NCAIS Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Communication Preferences
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''communicationPreferences'')', 'Communication Preferences', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Format
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''emailFormat'')', 'Email Format', b'0', 1, @REPORTFIELDGROUP_ID);

-- Create Date
CALL INSERTREPORTFIELD('PERSON_CREATE_DATE', 'Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Update Date
CALL INSERTREPORTFIELD('PERSON_UPDATE_DATE', 'Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Demographic Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Demographic Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Marital Status
CALL INSERTREPORTFIELD('PERSON_MARITAL_STATUS', 'Marital Status', b'0', 3, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.birthDate'')', 'Birth Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Deceased
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.deceased'')', 'Deceased', b'0', 6, @REPORTFIELDGROUP_ID);

-- Gender
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.gender'')', 'Gender', b'0', 1, @REPORTFIELDGROUP_ID);

-- Race
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.race'')', 'Race', b'0', 1, @REPORTFIELDGROUP_ID);

-- Military
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.military'')', 'Military', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Miscellaneous Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Miscellaneous Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Major Donor
CALL INSERTREPORTFIELD('PERSON_MAJOR_DONOR', 'Major Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Lapsed Donor
CALL INSERTREPORTFIELD('PERSON_LAPSED_DONOR', 'Lapsed Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('PERSON_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Phone Number Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Phone Number Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Phone Number ID
CALL INSERTREPORTFIELD('PHONE_PHONE_ID', 'Phone Number ID', b'0', 3, @REPORTFIELDGROUP_ID);

-- Phone Type
CALL INSERTREPORTFIELD('PHONE_PHONE_TYPE', 'Phone Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Phone Status
CALL INSERTREPORTFIELD('PHONE_ACTIVATION_STATUS', 'Phone Status', b'0', 1, @REPORTFIELDGROUP_ID);

-- Effective Date
CALL INSERTREPORTFIELD('PHONE_EFFECTIVE_DATE', 'Effective Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Seasonal Start Date
CALL INSERTREPORTFIELD('PHONE_SEASONAL_START_DATE', 'Seasonal Start Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Seasonal End Date
CALL INSERTREPORTFIELD('PHONE_SEASONAL_END_DATE', 'Seasonal End Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Temporary Start Date
CALL INSERTREPORTFIELD('PHONE_TEMPORARY_START_DATE', 'Temporary Start Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Temporary End Date
CALL INSERTREPORTFIELD('PHONE_TEMPORARY_END_DATE', 'Temporary End Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Phone Number
CALL INSERTREPORTFIELD('PHONE_NUMBER', 'Phone Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Provider
CALL INSERTREPORTFIELD('PHONE_PROVIDER', 'Provider', b'0', 1, @REPORTFIELDGROUP_ID);

-- SMS
CALL INSERTREPORTFIELD('PHONE_SMS', 'SMS', b'0', 1, @REPORTFIELDGROUP_ID);

-- Receive Correspondence
CALL INSERTREPORTFIELD('PHONE_RECEIVE_CORRESPONDENCE', 'Receive Correspondence', b'0', 6, @REPORTFIELDGROUP_ID);

-- Phone Comments
CALL INSERTREPORTFIELD('PHONE_COMMENT', 'Phone Comments', b'0', 1, @REPORTFIELDGROUP_ID);

-- Phone Create Date
CALL INSERTREPORTFIELD('PHONE_CREATE_DATE', 'Phone Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Phone Update Date
CALL INSERTREPORTFIELD('PHONE_UPDATE_DATE', 'Phone Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Phone Inactive Status
CALL INSERTREPORTFIELD('PHONE_INACTIVE', 'Phone Inactive Status', b'0', 6, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Constituent & Relationships View & Field Definitions
--
-- *********************************************************************************************************************


DROP VIEW IF EXISTS VW_CONSTITUENTS_RELATIONSHIPS;
CREATE VIEW VW_CONSTITUENTS_RELATIONSHIPS
AS
	SELECT
		PERSON_PERSON_ID,
		PERSON_CONSTITUENT_ROLES,
		PERSON_CONSTITUENT_ROLE,
		PERSON_CONSTITUENT_TYPE,
		PERSON_CREATE_DATE,
		PERSON_FIRST_NAME,
		PERSON_LAPSED_DONOR,
		PERSON_LAST_NAME,
		PERSON_LEGAL_NAME,
		PERSON_LOGIN_ID,
		PERSON_MAJOR_DONOR,
		PERSON_MARITAL_STATUS,
		PERSON_MIDDLE_NAME,
		PERSON_NCAIS_CODE,
		PERSON_ORGANIZATION_NAME,
		PERSON_PREFERRED_PHONE_TYPE,
		PERSON_RECOGNITION_NAME,
		PERSON_SUFFIX,
		PERSON_TITLE,
		PERSON_UPDATE_DATE,
		PERSON_SITE_NAME,
		GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, 'individual.organizations') AS PERSON_EMPLOYERS,
		GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, 'headOfHousehold.householdMembers') AS PERSON_HOUSEHOLDMEMBERS,
		GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, 'individual.parents') AS PERSON_PARENTS,
		GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, 'individual.children') AS PERSON_CHILDREN,
		GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, 'individual.siblings') AS PERSON_SIBLINGS,
		GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, 'individual.friends') AS PERSON_FRIENDS,
		GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, 'organization.employees') AS PERSON_EMPLOYEES,
		GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, 'organization.subsidiaryList') AS PERSON_SUBSIDIARYLIST,
		GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, 'organization.primaryContacts') AS PERSON_PRIMARYCONTACTS,
		GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, 'organization.billingContacts') AS PERSON_BILLINGCONTACTS,
		GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, 'organization.salesContacts') AS PERSON_SALESCONTACTS,
		GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, 'organization.publicRelationsContacts') AS PERSON_PUBLICRELATIONSCONTACTS
	FROM VW_CONSTITUENTS
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Constituents');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Constituents & Relationships', 0, 'VW_CONSTITUENTS_RELATIONSHIPS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();


-- ***********************************************************************
-- Contact Details Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Contact Details', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('PERSON_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Manager Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager''))', 'Account Manager Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Account Manager Account Number
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager'')', 'Account Manager Account Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Constituent Type
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_TYPE', 'Constituent Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLES', 'Profile Types', b'0', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLE', 'Profile Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Title
CALL INSERTREPORTFIELD('PERSON_TITLE', 'Title', b'0', 1, @REPORTFIELDGROUP_ID);

-- First Name
CALL INSERTREPORTFIELD('PERSON_FIRST_NAME', 'First Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Middle Name
CALL INSERTREPORTFIELD('PERSON_MIDDLE_NAME', 'Middle Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Name
CALL INSERTREPORTFIELD('PERSON_LAST_NAME', 'Last Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Suffix
CALL INSERTREPORTFIELD('PERSON_SUFFIX', 'Suffix', b'0', 1, @REPORTFIELDGROUP_ID);

-- Recognition Name
CALL INSERTREPORTFIELD('PERSON_RECOGNITION_NAME', 'Recognition Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Organization Name
CALL INSERTREPORTFIELD('PERSON_ORGANIZATION_NAME', 'Organization Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Legal Name
CALL INSERTREPORTFIELD('PERSON_LEGAL_NAME', 'Legal Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.matching'')', 'Matching', b'0', 1, @REPORTFIELDGROUP_ID);

-- Percent Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.percentMatch'')', 'Percent Matching', b'0', 3, @REPORTFIELDGROUP_ID);

-- Maximum Match
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.maximumMatch'')', 'Maximum Match', b'0', 5, @REPORTFIELDGROUP_ID);

-- Website
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.website'')', 'Website', b'0', 1, @REPORTFIELDGROUP_ID);

-- Tax ID
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.taxid'')', 'Tax ID', b'0', 1, @REPORTFIELDGROUP_ID);

-- NCAIS Code
CALL INSERTREPORTFIELD('PERSON_NCAIS_CODE', 'NCAIS Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Communication Preferences
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''communicationPreferences'')', 'Communication Preferences', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Format
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''emailFormat'')', 'Email Format', b'0', 1, @REPORTFIELDGROUP_ID);

-- Create Date
CALL INSERTREPORTFIELD('PERSON_CREATE_DATE', 'Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Update Date
CALL INSERTREPORTFIELD('PERSON_UPDATE_DATE', 'Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Demographic Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Demographic Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Marital Status
CALL INSERTREPORTFIELD('PERSON_MARITAL_STATUS', 'Marital Status', b'0', 3, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.birthDate'')', 'Birth Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Deceased
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.deceased'')', 'Deceased', b'0', 6, @REPORTFIELDGROUP_ID);

-- Gender
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.gender'')', 'Gender', b'0', 1, @REPORTFIELDGROUP_ID);

-- Race
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.race'')', 'Race', b'0', 1, @REPORTFIELDGROUP_ID);

-- Military
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.military'')', 'Military', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Miscellaneous Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Miscellaneous Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Major Donor
CALL INSERTREPORTFIELD('PERSON_MAJOR_DONOR', 'Major Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Lapsed Donor
CALL INSERTREPORTFIELD('PERSON_LAPSED_DONOR', 'Lapsed Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('PERSON_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Relationship Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Relationship Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Employers' Account Numbers
CALL INSERTREPORTFIELD('PERSON_EMPLOYERS', 'Employers'' Account Numbers', b'0', 1, @REPORTFIELDGROUP_ID);
-- Employers' Names
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAMES(PERSON_EMPLOYERS, '','')', 'Employers'' Names', b'0', 1, @REPORTFIELDGROUP_ID);

-- Employment Title
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.employmentTitle'')', 'Employment Title', b'0', 1, @REPORTFIELDGROUP_ID);

-- Head of Household Account Number
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.headOfHousehold'')', 'Head of Household Account Number', b'0', 3, @REPORTFIELDGROUP_ID);
-- Head of Household Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.headOfHousehold''))', 'Head of Household Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Household Members' Account Numbers
CALL INSERTREPORTFIELD('PERSON_HOUSEHOLDMEMBERS', 'Household Members'' Account Numbers', b'0', 1, @REPORTFIELDGROUP_ID);
-- Household Members' Names
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAMES(PERSON_HOUSEHOLDMEMBERS, '','')', 'Household Members'' Names', b'0', 1, @REPORTFIELDGROUP_ID);

-- Parents' Account Numbers
CALL INSERTREPORTFIELD('PERSON_PARENTS', 'Parents'' Account Numbers', b'0', 1, @REPORTFIELDGROUP_ID);
-- Parents'' Names
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAMES(PERSON_PARENTS, '','')', 'Parents'' Names', b'0', 1, @REPORTFIELDGROUP_ID);

-- Children's Account Numbers
CALL INSERTREPORTFIELD('PERSON_CHILDREN', 'Children''s Account Numbers', b'0', 1, @REPORTFIELDGROUP_ID);
-- Children's Names
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAMES(PERSON_CHILDREN, '','')', 'Children''s Names', b'0', 1, @REPORTFIELDGROUP_ID);

-- Siblings' Account Numbers
CALL INSERTREPORTFIELD('PERSON_SIBLINGS', 'Siblings'' Account Numbers', b'0', 1, @REPORTFIELDGROUP_ID);
-- Siblings' Names
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAMES(PERSON_SIBLINGS, '','')', 'Siblings'' Names', b'0', 1, @REPORTFIELDGROUP_ID);

-- Friends' Account Numbers
CALL INSERTREPORTFIELD('PERSON_FRIENDS', 'Friends'' Account Numbers', b'0', 1, @REPORTFIELDGROUP_ID);
-- Friends' Names
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAMES(PERSON_FRIENDS, '','')', 'Friends'' Names', b'0', 1, @REPORTFIELDGROUP_ID);

-- Employees' Account Numbers
CALL INSERTREPORTFIELD('PERSON_EMPLOYEES', 'Employees'' Account Numbers', b'0', 1, @REPORTFIELDGROUP_ID);
-- Employees Names
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAMES(PERSON_EMPLOYEES, '','')', 'Employees'' Names', b'0', 1, @REPORTFIELDGROUP_ID);

-- Parent Organization
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.parent''))', 'Parent Organization', b'0', 1, @REPORTFIELDGROUP_ID);

-- Subsidiary List Account Numbers
CALL INSERTREPORTFIELD('PERSON_SUBSIDIARYLIST', 'Subsidiary List Account Numbers', b'0', 1, @REPORTFIELDGROUP_ID);
-- Subsidiary List Names
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAMES(PERSON_SUBSIDIARYLIST, '','')', 'Subsidiary List Names', b'0', 1, @REPORTFIELDGROUP_ID);

-- Primary Contacts' Account Numbers
CALL INSERTREPORTFIELD('PERSON_PRIMARYCONTACTS', 'Primary Contacts'' Account Numbers', b'0', 1, @REPORTFIELDGROUP_ID);
-- Primary Contacts' Names
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAMES(PERSON_PRIMARYCONTACTS, '','')', 'Primary Contacts'' Names', b'0', 1, @REPORTFIELDGROUP_ID);

-- Billing Contacts' Account Numbers
CALL INSERTREPORTFIELD('PERSON_BILLINGCONTACTS', 'Billing Contacts'' Account Numbers', b'0', 1, @REPORTFIELDGROUP_ID);
-- Billing Contacts' Names
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAMES(PERSON_BILLINGCONTACTS, '','')', 'Billing Contacts'' Names', b'0', 1, @REPORTFIELDGROUP_ID);

-- Sales Contacts' Account Numbers
CALL INSERTREPORTFIELD('PERSON_SALESCONTACTS', 'Sales Contacts'' Account Numbers', b'0', 1, @REPORTFIELDGROUP_ID);
-- Sales Contacts' Names
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAMES(PERSON_SALESCONTACTS, '','')', 'Sales Contacts'' Names', b'0', 1, @REPORTFIELDGROUP_ID);

-- Public Relations Contacts' Account Numbers
CALL INSERTREPORTFIELD('PERSON_PUBLICRELATIONSCONTACTS', 'Public Relations Contacts'' Account Numbers', b'0', 1, @REPORTFIELDGROUP_ID);
-- Public Relations Contacts
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAMES(PERSON_PUBLICRELATIONSCONTACTS, '','')', 'Public Relations Contacts'' Names', b'0', 1, @REPORTFIELDGROUP_ID);


-- *********************************************************************************************************************
--
-- Constituent & Employers View & Field Definitions
--
-- *********************************************************************************************************************

DROP VIEW IF EXISTS VW_CONSTITUENTS_EMPLOYERS;
CREATE VIEW VW_CONSTITUENTS_EMPLOYERS
AS
	SELECT
		PERSON_PERSON_ID,
		PERSON_CONSTITUENT_ROLES,
		PERSON_CONSTITUENT_ROLE,
		PERSON_CONSTITUENT_TYPE,
		PERSON_CREATE_DATE,
		PERSON_FIRST_NAME,
		PERSON_LAPSED_DONOR,
		PERSON_LAST_NAME,
		PERSON_LEGAL_NAME,
		PERSON_LOGIN_ID,
		PERSON_MAJOR_DONOR,
		PERSON_MARITAL_STATUS,
		PERSON_MIDDLE_NAME,
		PERSON_NCAIS_CODE,
		PERSON_ORGANIZATION_NAME,
		PERSON_PREFERRED_PHONE_TYPE,
		PERSON_RECOGNITION_NAME,
		PERSON_SUFFIX,
		PERSON_TITLE,
		PERSON_UPDATE_DATE,
		PERSON_SITE_NAME,
		PERSON_EMPLOYERS,
		PERSON_EMPLOYERS_NUMBERS.NUMBER AS PERSON_EMPLOYERS_NUMBERS_NUMBER
	FROM VW_CONSTITUENTS_RELATIONSHIPS
	LEFT JOIN NUMBERS AS PERSON_EMPLOYERS_NUMBERS
		ON PERSON_EMPLOYERS_NUMBERS.NUMBER <= COUNTOFVALUES(PERSON_EMPLOYERS, ',')
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Constituents & Relationship Details');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Constituents & Employers', 0, 'VW_CONSTITUENTS_EMPLOYERS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();


-- ***********************************************************************
-- Contact Details Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Contact Details', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('PERSON_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Manager Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager''))', 'Account Manager Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Account Manager Account Number
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager'')', 'Account Manager Account Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Constituent Type
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_TYPE', 'Constituent Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLES', 'Profile Types', b'0', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLE', 'Profile Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Title
CALL INSERTREPORTFIELD('PERSON_TITLE', 'Title', b'0', 1, @REPORTFIELDGROUP_ID);

-- First Name
CALL INSERTREPORTFIELD('PERSON_FIRST_NAME', 'First Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Middle Name
CALL INSERTREPORTFIELD('PERSON_MIDDLE_NAME', 'Middle Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Name
CALL INSERTREPORTFIELD('PERSON_LAST_NAME', 'Last Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Suffix
CALL INSERTREPORTFIELD('PERSON_SUFFIX', 'Suffix', b'0', 1, @REPORTFIELDGROUP_ID);

-- Recognition Name
CALL INSERTREPORTFIELD('PERSON_RECOGNITION_NAME', 'Recognition Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Organization Name
CALL INSERTREPORTFIELD('PERSON_ORGANIZATION_NAME', 'Organization Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Legal Name
CALL INSERTREPORTFIELD('PERSON_LEGAL_NAME', 'Legal Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.matching'')', 'Matching', b'0', 1, @REPORTFIELDGROUP_ID);

-- Percent Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.percentMatch'')', 'Percent Matching', b'0', 3, @REPORTFIELDGROUP_ID);

-- Maximum Match
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.maximumMatch'')', 'Maximum Match', b'0', 5, @REPORTFIELDGROUP_ID);

-- Website
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.website'')', 'Website', b'0', 1, @REPORTFIELDGROUP_ID);

-- Tax ID
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.taxid'')', 'Tax ID', b'0', 1, @REPORTFIELDGROUP_ID);

-- NCAIS Code
CALL INSERTREPORTFIELD('PERSON_NCAIS_CODE', 'NCAIS Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Communication Preferences
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''communicationPreferences'')', 'Communication Preferences', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Format
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''emailFormat'')', 'Email Format', b'0', 1, @REPORTFIELDGROUP_ID);

-- Create Date
CALL INSERTREPORTFIELD('PERSON_CREATE_DATE', 'Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Update Date
CALL INSERTREPORTFIELD('PERSON_UPDATE_DATE', 'Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Demographic Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Demographic Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Marital Status
CALL INSERTREPORTFIELD('PERSON_MARITAL_STATUS', 'Marital Status', b'0', 3, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.birthDate'')', 'Birth Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Deceased
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.deceased'')', 'Deceased', b'0', 6, @REPORTFIELDGROUP_ID);

-- Gender
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.gender'')', 'Gender', b'0', 1, @REPORTFIELDGROUP_ID);

-- Race
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.race'')', 'Race', b'0', 1, @REPORTFIELDGROUP_ID);

-- Military
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.military'')', 'Military', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Miscellaneous Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Miscellaneous Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Major Donor
CALL INSERTREPORTFIELD('PERSON_MAJOR_DONOR', 'Major Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Lapsed Donor
CALL INSERTREPORTFIELD('PERSON_LAPSED_DONOR', 'Lapsed Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('PERSON_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Employer Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Employer Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Employers' Account Numbers
CALL INSERTREPORTFIELD('PERSON_EMPLOYERS', 'Employers'' Account Numbers', b'0', 1, @REPORTFIELDGROUP_ID);
-- Employers' Names
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAMES(PERSON_EMPLOYERS, '','')', 'Employers'' Names', b'0', 1, @REPORTFIELDGROUP_ID);

-- Employer's Account Number
CALL INSERTREPORTFIELD('GETVALUE(PERSON_EMPLOYERS, '','', PERSON_EMPLOYERS_NUMBERS_NUMBER)', 'Employer''s Account Number', b'0', 3, @REPORTFIELDGROUP_ID);
-- Employer's Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETVALUE(PERSON_EMPLOYERS, '','', PERSON_EMPLOYERS_NUMBERS_NUMBER))', 'Employer''s Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Employment Title
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.employmentTitle'')', 'Employment Title', b'0', 1, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Constituent & Household Members View & Field Definitions
--
-- *********************************************************************************************************************

DROP VIEW IF EXISTS VW_CONSTITUENTS_HOUSEHOLDMEMBERS;
CREATE VIEW VW_CONSTITUENTS_HOUSEHOLDMEMBERS
AS
	SELECT
		PERSON_PERSON_ID,
		PERSON_CONSTITUENT_ROLES,
		PERSON_CONSTITUENT_ROLE,
		PERSON_CONSTITUENT_TYPE,
		PERSON_CREATE_DATE,
		PERSON_FIRST_NAME,
		PERSON_LAPSED_DONOR,
		PERSON_LAST_NAME,
		PERSON_LEGAL_NAME,
		PERSON_LOGIN_ID,
		PERSON_MAJOR_DONOR,
		PERSON_MARITAL_STATUS,
		PERSON_MIDDLE_NAME,
		PERSON_NCAIS_CODE,
		PERSON_ORGANIZATION_NAME,
		PERSON_PREFERRED_PHONE_TYPE,
		PERSON_RECOGNITION_NAME,
		PERSON_SUFFIX,
		PERSON_TITLE,
		PERSON_UPDATE_DATE,
		PERSON_SITE_NAME,
		PERSON_HOUSEHOLDMEMBERS,
		PERSON_HOUSEHOLDMEMBERS_NUMBERS.NUMBER AS PERSON_HOUSEHOLDMEMBERS_NUMBERS_NUMBER
	FROM VW_CONSTITUENTS_RELATIONSHIPS
	LEFT JOIN NUMBERS AS PERSON_HOUSEHOLDMEMBERS_NUMBERS
		ON PERSON_HOUSEHOLDMEMBERS_NUMBERS.NUMBER <= COUNTOFVALUES(PERSON_HOUSEHOLDMEMBERS, ',')
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Constituents & Relationship Details');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Constituents & Household Members', 0, 'VW_CONSTITUENTS_HOUSEHOLDMEMBERS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();


-- ***********************************************************************
-- Contact Details Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Contact Details', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('PERSON_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Manager Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager''))', 'Account Manager Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Account Manager Account Number
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager'')', 'Account Manager Account Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Constituent Type
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_TYPE', 'Constituent Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLES', 'Profile Types', b'0', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLE', 'Profile Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Title
CALL INSERTREPORTFIELD('PERSON_TITLE', 'Title', b'0', 1, @REPORTFIELDGROUP_ID);

-- First Name
CALL INSERTREPORTFIELD('PERSON_FIRST_NAME', 'First Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Middle Name
CALL INSERTREPORTFIELD('PERSON_MIDDLE_NAME', 'Middle Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Name
CALL INSERTREPORTFIELD('PERSON_LAST_NAME', 'Last Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Suffix
CALL INSERTREPORTFIELD('PERSON_SUFFIX', 'Suffix', b'0', 1, @REPORTFIELDGROUP_ID);

-- Recognition Name
CALL INSERTREPORTFIELD('PERSON_RECOGNITION_NAME', 'Recognition Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Organization Name
CALL INSERTREPORTFIELD('PERSON_ORGANIZATION_NAME', 'Organization Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Legal Name
CALL INSERTREPORTFIELD('PERSON_LEGAL_NAME', 'Legal Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.matching'')', 'Matching', b'0', 1, @REPORTFIELDGROUP_ID);

-- Percent Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.percentMatch'')', 'Percent Matching', b'0', 3, @REPORTFIELDGROUP_ID);

-- Maximum Match
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.maximumMatch'')', 'Maximum Match', b'0', 5, @REPORTFIELDGROUP_ID);

-- Website
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.website'')', 'Website', b'0', 1, @REPORTFIELDGROUP_ID);

-- Tax ID
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.taxid'')', 'Tax ID', b'0', 1, @REPORTFIELDGROUP_ID);

-- NCAIS Code
CALL INSERTREPORTFIELD('PERSON_NCAIS_CODE', 'NCAIS Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Communication Preferences
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''communicationPreferences'')', 'Communication Preferences', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Format
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''emailFormat'')', 'Email Format', b'0', 1, @REPORTFIELDGROUP_ID);

-- Create Date
CALL INSERTREPORTFIELD('PERSON_CREATE_DATE', 'Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Update Date
CALL INSERTREPORTFIELD('PERSON_UPDATE_DATE', 'Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Demographic Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Demographic Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Marital Status
CALL INSERTREPORTFIELD('PERSON_MARITAL_STATUS', 'Marital Status', b'0', 3, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.birthDate'')', 'Birth Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Deceased
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.deceased'')', 'Deceased', b'0', 6, @REPORTFIELDGROUP_ID);

-- Gender
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.gender'')', 'Gender', b'0', 1, @REPORTFIELDGROUP_ID);

-- Race
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.race'')', 'Race', b'0', 1, @REPORTFIELDGROUP_ID);

-- Military
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.military'')', 'Military', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Miscellaneous Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Miscellaneous Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Major Donor
CALL INSERTREPORTFIELD('PERSON_MAJOR_DONOR', 'Major Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Lapsed Donor
CALL INSERTREPORTFIELD('PERSON_LAPSED_DONOR', 'Lapsed Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('PERSON_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Household Members Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Household Members Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Head of Household Account Number
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.headOfHousehold'')', 'Head of Household Account Number', b'0', 3, @REPORTFIELDGROUP_ID);
-- Head of Household Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.headOfHousehold''))', 'Head of Household Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Household Members' Account Numbers
CALL INSERTREPORTFIELD('PERSON_HOUSEHOLDMEMBERS', 'Household Members'' Account Numbers', b'0', 1, @REPORTFIELDGROUP_ID);
-- Household Members' Names
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAMES(PERSON_HOUSEHOLDMEMBERS, '','')', 'Household Members'' Names', b'0', 1, @REPORTFIELDGROUP_ID);

-- Household Member's Account Number
CALL INSERTREPORTFIELD('GETVALUE(PERSON_HOUSEHOLDMEMBERS, '','', PERSON_HOUSEHOLDMEMBERS_NUMBERS_NUMBER)', 'Household Member''s Account Number', b'0', 3, @REPORTFIELDGROUP_ID);
-- Household Member's Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETVALUE(PERSON_HOUSEHOLDMEMBERS, '','', PERSON_HOUSEHOLDMEMBERS_NUMBERS_NUMBER))', 'Household Member''s Name', b'0', 1, @REPORTFIELDGROUP_ID);


-- *********************************************************************************************************************
--
-- Constituent & Parents View & Field Definitions
--
-- *********************************************************************************************************************

DROP VIEW IF EXISTS VW_CONSTITUENTS_PARENTS;
CREATE VIEW VW_CONSTITUENTS_PARENTS
AS
	SELECT
		PERSON_PERSON_ID,
		PERSON_CONSTITUENT_ROLES,
		PERSON_CONSTITUENT_ROLE,
		PERSON_CONSTITUENT_TYPE,
		PERSON_CREATE_DATE,
		PERSON_FIRST_NAME,
		PERSON_LAPSED_DONOR,
		PERSON_LAST_NAME,
		PERSON_LEGAL_NAME,
		PERSON_LOGIN_ID,
		PERSON_MAJOR_DONOR,
		PERSON_MARITAL_STATUS,
		PERSON_MIDDLE_NAME,
		PERSON_NCAIS_CODE,
		PERSON_ORGANIZATION_NAME,
		PERSON_PREFERRED_PHONE_TYPE,
		PERSON_RECOGNITION_NAME,
		PERSON_SUFFIX,
		PERSON_TITLE,
		PERSON_UPDATE_DATE,
		PERSON_SITE_NAME,
		PERSON_PARENTS,
		PERSON_PARENTS_NUMBERS.NUMBER AS PERSON_PARENTS_NUMBERS_NUMBER
	FROM VW_CONSTITUENTS_RELATIONSHIPS
	LEFT JOIN NUMBERS AS PERSON_PARENTS_NUMBERS
		ON PERSON_PARENTS_NUMBERS.NUMBER <= COUNTOFVALUES(PERSON_PARENTS, ',')
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Constituents & Relationship Details');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Constituents & Parents', 0, 'VW_CONSTITUENTS_PARENTS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();


-- ***********************************************************************
-- Contact Details Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Contact Details', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('PERSON_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Manager Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager''))', 'Account Manager Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Account Manager Account Number
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager'')', 'Account Manager Account Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Constituent Type
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_TYPE', 'Constituent Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLES', 'Profile Types', b'0', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLE', 'Profile Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Title
CALL INSERTREPORTFIELD('PERSON_TITLE', 'Title', b'0', 1, @REPORTFIELDGROUP_ID);

-- First Name
CALL INSERTREPORTFIELD('PERSON_FIRST_NAME', 'First Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Middle Name
CALL INSERTREPORTFIELD('PERSON_MIDDLE_NAME', 'Middle Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Name
CALL INSERTREPORTFIELD('PERSON_LAST_NAME', 'Last Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Suffix
CALL INSERTREPORTFIELD('PERSON_SUFFIX', 'Suffix', b'0', 1, @REPORTFIELDGROUP_ID);

-- Recognition Name
CALL INSERTREPORTFIELD('PERSON_RECOGNITION_NAME', 'Recognition Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Organization Name
CALL INSERTREPORTFIELD('PERSON_ORGANIZATION_NAME', 'Organization Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Legal Name
CALL INSERTREPORTFIELD('PERSON_LEGAL_NAME', 'Legal Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.matching'')', 'Matching', b'0', 1, @REPORTFIELDGROUP_ID);

-- Percent Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.percentMatch'')', 'Percent Matching', b'0', 3, @REPORTFIELDGROUP_ID);

-- Maximum Match
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.maximumMatch'')', 'Maximum Match', b'0', 5, @REPORTFIELDGROUP_ID);

-- Website
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.website'')', 'Website', b'0', 1, @REPORTFIELDGROUP_ID);

-- Tax ID
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.taxid'')', 'Tax ID', b'0', 1, @REPORTFIELDGROUP_ID);

-- NCAIS Code
CALL INSERTREPORTFIELD('PERSON_NCAIS_CODE', 'NCAIS Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Communication Preferences
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''communicationPreferences'')', 'Communication Preferences', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Format
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''emailFormat'')', 'Email Format', b'0', 1, @REPORTFIELDGROUP_ID);

-- Create Date
CALL INSERTREPORTFIELD('PERSON_CREATE_DATE', 'Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Update Date
CALL INSERTREPORTFIELD('PERSON_UPDATE_DATE', 'Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Demographic Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Demographic Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Marital Status
CALL INSERTREPORTFIELD('PERSON_MARITAL_STATUS', 'Marital Status', b'0', 3, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.birthDate'')', 'Birth Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Deceased
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.deceased'')', 'Deceased', b'0', 6, @REPORTFIELDGROUP_ID);

-- Gender
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.gender'')', 'Gender', b'0', 1, @REPORTFIELDGROUP_ID);

-- Race
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.race'')', 'Race', b'0', 1, @REPORTFIELDGROUP_ID);

-- Military
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.military'')', 'Military', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Miscellaneous Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Miscellaneous Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Major Donor
CALL INSERTREPORTFIELD('PERSON_MAJOR_DONOR', 'Major Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Lapsed Donor
CALL INSERTREPORTFIELD('PERSON_LAPSED_DONOR', 'Lapsed Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('PERSON_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Parents Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Parents Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Parents' Account Numbers
CALL INSERTREPORTFIELD('PERSON_PARENTS', 'Parents'' Account Numbers', b'0', 1, @REPORTFIELDGROUP_ID);
-- Parents' Names
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAMES(PERSON_PARENTS, '','')', 'Parents'' Names', b'0', 1, @REPORTFIELDGROUP_ID);

-- Parent's Account Number
CALL INSERTREPORTFIELD('GETVALUE(PERSON_PARENTS, '','', PERSON_PARENTS_NUMBERS_NUMBER)', 'Parents''s Account Number', b'0', 3, @REPORTFIELDGROUP_ID);
-- Parent's Member's Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETVALUE(PERSON_PARENTS, '','', PERSON_PARENTS_NUMBERS_NUMBER))', 'Parents''s Name', b'0', 1, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Constituent & Children View & Field Definitions
--
-- *********************************************************************************************************************

DROP VIEW IF EXISTS VW_CONSTITUENTS_CHILDREN;
CREATE VIEW VW_CONSTITUENTS_CHILDREN
AS
	SELECT
		PERSON_PERSON_ID,
		PERSON_CONSTITUENT_ROLES,
		PERSON_CONSTITUENT_ROLE,
		PERSON_CONSTITUENT_TYPE,
		PERSON_CREATE_DATE,
		PERSON_FIRST_NAME,
		PERSON_LAPSED_DONOR,
		PERSON_LAST_NAME,
		PERSON_LEGAL_NAME,
		PERSON_LOGIN_ID,
		PERSON_MAJOR_DONOR,
		PERSON_MARITAL_STATUS,
		PERSON_MIDDLE_NAME,
		PERSON_NCAIS_CODE,
		PERSON_ORGANIZATION_NAME,
		PERSON_PREFERRED_PHONE_TYPE,
		PERSON_RECOGNITION_NAME,
		PERSON_SUFFIX,
		PERSON_TITLE,
		PERSON_UPDATE_DATE,
		PERSON_SITE_NAME,
		PERSON_CHILDREN,
		PERSON_CHILDREN_NUMBERS.NUMBER AS PERSON_CHILDREN_NUMBERS_NUMBER
	FROM VW_CONSTITUENTS_RELATIONSHIPS
	LEFT JOIN NUMBERS AS PERSON_CHILDREN_NUMBERS
		ON PERSON_CHILDREN_NUMBERS.NUMBER <= COUNTOFVALUES(PERSON_CHILDREN, ',')
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Constituents & Relationship Details');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Constituents & Children', 0, 'VW_CONSTITUENTS_CHILDREN', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();


-- ***********************************************************************
-- Contact Details Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Contact Details', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('PERSON_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Manager Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager''))', 'Account Manager Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Account Manager Account Number
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager'')', 'Account Manager Account Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Constituent Type
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_TYPE', 'Constituent Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLES', 'Profile Types', b'0', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLE', 'Profile Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Title
CALL INSERTREPORTFIELD('PERSON_TITLE', 'Title', b'0', 1, @REPORTFIELDGROUP_ID);

-- First Name
CALL INSERTREPORTFIELD('PERSON_FIRST_NAME', 'First Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Middle Name
CALL INSERTREPORTFIELD('PERSON_MIDDLE_NAME', 'Middle Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Name
CALL INSERTREPORTFIELD('PERSON_LAST_NAME', 'Last Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Suffix
CALL INSERTREPORTFIELD('PERSON_SUFFIX', 'Suffix', b'0', 1, @REPORTFIELDGROUP_ID);

-- Recognition Name
CALL INSERTREPORTFIELD('PERSON_RECOGNITION_NAME', 'Recognition Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Organization Name
CALL INSERTREPORTFIELD('PERSON_ORGANIZATION_NAME', 'Organization Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Legal Name
CALL INSERTREPORTFIELD('PERSON_LEGAL_NAME', 'Legal Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.matching'')', 'Matching', b'0', 1, @REPORTFIELDGROUP_ID);

-- Percent Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.percentMatch'')', 'Percent Matching', b'0', 3, @REPORTFIELDGROUP_ID);

-- Maximum Match
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.maximumMatch'')', 'Maximum Match', b'0', 5, @REPORTFIELDGROUP_ID);

-- Website
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.website'')', 'Website', b'0', 1, @REPORTFIELDGROUP_ID);

-- Tax ID
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.taxid'')', 'Tax ID', b'0', 1, @REPORTFIELDGROUP_ID);

-- NCAIS Code
CALL INSERTREPORTFIELD('PERSON_NCAIS_CODE', 'NCAIS Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Communication Preferences
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''communicationPreferences'')', 'Communication Preferences', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Format
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''emailFormat'')', 'Email Format', b'0', 1, @REPORTFIELDGROUP_ID);

-- Create Date
CALL INSERTREPORTFIELD('PERSON_CREATE_DATE', 'Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Update Date
CALL INSERTREPORTFIELD('PERSON_UPDATE_DATE', 'Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Demographic Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Demographic Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Marital Status
CALL INSERTREPORTFIELD('PERSON_MARITAL_STATUS', 'Marital Status', b'0', 3, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.birthDate'')', 'Birth Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Deceased
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.deceased'')', 'Deceased', b'0', 6, @REPORTFIELDGROUP_ID);

-- Gender
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.gender'')', 'Gender', b'0', 1, @REPORTFIELDGROUP_ID);

-- Race
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.race'')', 'Race', b'0', 1, @REPORTFIELDGROUP_ID);

-- Military
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.military'')', 'Military', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Miscellaneous Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Miscellaneous Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Major Donor
CALL INSERTREPORTFIELD('PERSON_MAJOR_DONOR', 'Major Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Lapsed Donor
CALL INSERTREPORTFIELD('PERSON_LAPSED_DONOR', 'Lapsed Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('PERSON_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Children Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Children Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Children's Account Numbers
CALL INSERTREPORTFIELD('PERSON_CHILDREN', 'Children''s Account Numbers', b'0', 1, @REPORTFIELDGROUP_ID);
-- Children's Names
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAMES(PERSON_CHILDREN, '','')', 'Children''s Names', b'0', 1, @REPORTFIELDGROUP_ID);

-- Child's Account Number
CALL INSERTREPORTFIELD('GETVALUE(PERSON_CHILDREN, '','', PERSON_CHILDREN_NUMBERS_NUMBER)', 'Child''s Account Number', b'0', 3, @REPORTFIELDGROUP_ID);
-- Child's Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETVALUE(PERSON_CHILDREN, '','', PERSON_CHILDREN_NUMBERS_NUMBER))', 'Child''s Name', b'0', 1, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Constituent & Siblings View & Field Definitions
--
-- *********************************************************************************************************************

DROP VIEW IF EXISTS VW_CONSTITUENTS_SIBLINGS;
CREATE VIEW VW_CONSTITUENTS_SIBLINGS
AS
	SELECT
		PERSON_PERSON_ID,
		PERSON_CONSTITUENT_ROLES,
		PERSON_CONSTITUENT_ROLE,
		PERSON_CONSTITUENT_TYPE,
		PERSON_CREATE_DATE,
		PERSON_FIRST_NAME,
		PERSON_LAPSED_DONOR,
		PERSON_LAST_NAME,
		PERSON_LEGAL_NAME,
		PERSON_LOGIN_ID,
		PERSON_MAJOR_DONOR,
		PERSON_MARITAL_STATUS,
		PERSON_MIDDLE_NAME,
		PERSON_NCAIS_CODE,
		PERSON_ORGANIZATION_NAME,
		PERSON_PREFERRED_PHONE_TYPE,
		PERSON_RECOGNITION_NAME,
		PERSON_SUFFIX,
		PERSON_TITLE,
		PERSON_UPDATE_DATE,
		PERSON_SITE_NAME,
		PERSON_SIBLINGS,
		PERSON_SIBLINGS_NUMBERS.NUMBER AS PERSON_SIBLINGS_NUMBERS_NUMBER
	FROM VW_CONSTITUENTS_RELATIONSHIPS
	LEFT JOIN NUMBERS AS PERSON_SIBLINGS_NUMBERS
		ON PERSON_SIBLINGS_NUMBERS.NUMBER <= COUNTOFVALUES(PERSON_SIBLINGS, ',')
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Constituents & Relationship Details');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Constituents & Siblings', 0, 'VW_CONSTITUENTS_SIBLINGS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();


-- ***********************************************************************
-- Contact Details Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Contact Details', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('PERSON_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Manager Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager''))', 'Account Manager Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Account Manager Account Number
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager'')', 'Account Manager Account Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Constituent Type
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_TYPE', 'Constituent Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLES', 'Profile Types', b'0', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLE', 'Profile Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Title
CALL INSERTREPORTFIELD('PERSON_TITLE', 'Title', b'0', 1, @REPORTFIELDGROUP_ID);

-- First Name
CALL INSERTREPORTFIELD('PERSON_FIRST_NAME', 'First Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Middle Name
CALL INSERTREPORTFIELD('PERSON_MIDDLE_NAME', 'Middle Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Name
CALL INSERTREPORTFIELD('PERSON_LAST_NAME', 'Last Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Suffix
CALL INSERTREPORTFIELD('PERSON_SUFFIX', 'Suffix', b'0', 1, @REPORTFIELDGROUP_ID);

-- Recognition Name
CALL INSERTREPORTFIELD('PERSON_RECOGNITION_NAME', 'Recognition Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Organization Name
CALL INSERTREPORTFIELD('PERSON_ORGANIZATION_NAME', 'Organization Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Legal Name
CALL INSERTREPORTFIELD('PERSON_LEGAL_NAME', 'Legal Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.matching'')', 'Matching', b'0', 1, @REPORTFIELDGROUP_ID);

-- Percent Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.percentMatch'')', 'Percent Matching', b'0', 3, @REPORTFIELDGROUP_ID);

-- Maximum Match
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.maximumMatch'')', 'Maximum Match', b'0', 5, @REPORTFIELDGROUP_ID);

-- Website
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.website'')', 'Website', b'0', 1, @REPORTFIELDGROUP_ID);

-- Tax ID
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.taxid'')', 'Tax ID', b'0', 1, @REPORTFIELDGROUP_ID);

-- NCAIS Code
CALL INSERTREPORTFIELD('PERSON_NCAIS_CODE', 'NCAIS Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Communication Preferences
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''communicationPreferences'')', 'Communication Preferences', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Format
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''emailFormat'')', 'Email Format', b'0', 1, @REPORTFIELDGROUP_ID);

-- Create Date
CALL INSERTREPORTFIELD('PERSON_CREATE_DATE', 'Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Update Date
CALL INSERTREPORTFIELD('PERSON_UPDATE_DATE', 'Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Demographic Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Demographic Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Marital Status
CALL INSERTREPORTFIELD('PERSON_MARITAL_STATUS', 'Marital Status', b'0', 3, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.birthDate'')', 'Birth Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Deceased
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.deceased'')', 'Deceased', b'0', 6, @REPORTFIELDGROUP_ID);

-- Gender
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.gender'')', 'Gender', b'0', 1, @REPORTFIELDGROUP_ID);

-- Race
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.race'')', 'Race', b'0', 1, @REPORTFIELDGROUP_ID);

-- Military
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.military'')', 'Military', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Miscellaneous Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Miscellaneous Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Major Donor
CALL INSERTREPORTFIELD('PERSON_MAJOR_DONOR', 'Major Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Lapsed Donor
CALL INSERTREPORTFIELD('PERSON_LAPSED_DONOR', 'Lapsed Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('PERSON_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Siblings Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Siblings Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Siblings' Account Numbers
CALL INSERTREPORTFIELD('PERSON_SIBLINGS', 'Siblings'' Account Numbers', b'0', 1, @REPORTFIELDGROUP_ID);
-- Siblings' Names
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAMES(PERSON_SIBLINGS, '','')', 'Siblings'' Names', b'0', 1, @REPORTFIELDGROUP_ID);

-- Sibling's Account Number
CALL INSERTREPORTFIELD('GETVALUE(PERSON_SIBLINGS, '','', PERSON_SIBLINGS_NUMBERS_NUMBER)', 'Sibling''s Account Number', b'0', 3, @REPORTFIELDGROUP_ID);
-- Sibling's Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETVALUE(PERSON_SIBLINGS, '','', PERSON_SIBLINGS_NUMBERS_NUMBER))', 'Sibling''s Name', b'0', 1, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Constituent & Friends View & Field Definitions
--
-- *********************************************************************************************************************

DROP VIEW IF EXISTS VW_CONSTITUENTS_FRIENDS;
CREATE VIEW VW_CONSTITUENTS_FRIENDS
AS
	SELECT
		PERSON_PERSON_ID,
		PERSON_CONSTITUENT_ROLES,
		PERSON_CONSTITUENT_ROLE,
		PERSON_CONSTITUENT_TYPE,
		PERSON_CREATE_DATE,
		PERSON_FIRST_NAME,
		PERSON_LAPSED_DONOR,
		PERSON_LAST_NAME,
		PERSON_LEGAL_NAME,
		PERSON_LOGIN_ID,
		PERSON_MAJOR_DONOR,
		PERSON_MARITAL_STATUS,
		PERSON_MIDDLE_NAME,
		PERSON_NCAIS_CODE,
		PERSON_ORGANIZATION_NAME,
		PERSON_PREFERRED_PHONE_TYPE,
		PERSON_RECOGNITION_NAME,
		PERSON_SUFFIX,
		PERSON_TITLE,
		PERSON_UPDATE_DATE,
		PERSON_SITE_NAME,
		PERSON_FRIENDS,
		PERSON_FRIENDS_NUMBERS.NUMBER AS PERSON_FRIENDS_NUMBERS_NUMBER
	FROM VW_CONSTITUENTS_RELATIONSHIPS
	LEFT JOIN NUMBERS AS PERSON_FRIENDS_NUMBERS
		ON PERSON_FRIENDS_NUMBERS.NUMBER <= COUNTOFVALUES(PERSON_FRIENDS, ',')
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Constituents & Relationship Details');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Constituents & Friends', 0, 'VW_CONSTITUENTS_FRIENDS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();


-- ***********************************************************************
-- Contact Details Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Contact Details', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('PERSON_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Manager Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager''))', 'Account Manager Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Account Manager Account Number
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager'')', 'Account Manager Account Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Constituent Type
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_TYPE', 'Constituent Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLES', 'Profile Types', b'0', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLE', 'Profile Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Title
CALL INSERTREPORTFIELD('PERSON_TITLE', 'Title', b'0', 1, @REPORTFIELDGROUP_ID);

-- First Name
CALL INSERTREPORTFIELD('PERSON_FIRST_NAME', 'First Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Middle Name
CALL INSERTREPORTFIELD('PERSON_MIDDLE_NAME', 'Middle Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Name
CALL INSERTREPORTFIELD('PERSON_LAST_NAME', 'Last Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Suffix
CALL INSERTREPORTFIELD('PERSON_SUFFIX', 'Suffix', b'0', 1, @REPORTFIELDGROUP_ID);

-- Recognition Name
CALL INSERTREPORTFIELD('PERSON_RECOGNITION_NAME', 'Recognition Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Organization Name
CALL INSERTREPORTFIELD('PERSON_ORGANIZATION_NAME', 'Organization Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Legal Name
CALL INSERTREPORTFIELD('PERSON_LEGAL_NAME', 'Legal Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.matching'')', 'Matching', b'0', 1, @REPORTFIELDGROUP_ID);

-- Percent Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.percentMatch'')', 'Percent Matching', b'0', 3, @REPORTFIELDGROUP_ID);

-- Maximum Match
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.maximumMatch'')', 'Maximum Match', b'0', 5, @REPORTFIELDGROUP_ID);

-- Website
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.website'')', 'Website', b'0', 1, @REPORTFIELDGROUP_ID);

-- Tax ID
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.taxid'')', 'Tax ID', b'0', 1, @REPORTFIELDGROUP_ID);

-- NCAIS Code
CALL INSERTREPORTFIELD('PERSON_NCAIS_CODE', 'NCAIS Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Communication Preferences
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''communicationPreferences'')', 'Communication Preferences', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Format
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''emailFormat'')', 'Email Format', b'0', 1, @REPORTFIELDGROUP_ID);

-- Create Date
CALL INSERTREPORTFIELD('CREATE_DATE', 'Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Update Date
CALL INSERTREPORTFIELD('UPDATE_DATE', 'Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Demographic Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Demographic Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Marital Status
CALL INSERTREPORTFIELD('PERSON_MARITAL_STATUS', 'Marital Status', b'0', 3, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.birthDate'')', 'Birth Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.deceased'')', 'Birth Date', b'0', 6, @REPORTFIELDGROUP_ID);

-- Gender
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.gender'')', 'Gender', b'0', 1, @REPORTFIELDGROUP_ID);

-- Race
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.race'')', 'Race', b'0', 1, @REPORTFIELDGROUP_ID);

-- Military
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.military'')', 'Military', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Miscellaneous Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Miscellaneous Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Major Donor
CALL INSERTREPORTFIELD('PERSON_MAJOR_DONOR', 'Major Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Lapsed Donor
CALL INSERTREPORTFIELD('PERSON_LAPSED_DONOR', 'Lapsed Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('PERSON_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Friends Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Friends Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Friends' Account Numbers
CALL INSERTREPORTFIELD('PERSON_FRIENDS', 'Friends'' Account Numbers', b'0', 1, @REPORTFIELDGROUP_ID);
-- Friends' Names
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAMES(PERSON_FRIENDS, '','')', 'Friends'' Names', b'0', 1, @REPORTFIELDGROUP_ID);

-- Friend's Account Number
CALL INSERTREPORTFIELD('GETVALUE(PERSON_FRIENDS, '','', PERSON_FRIENDS_NUMBERS_NUMBER)', 'Friend''s Account Number', b'0', 3, @REPORTFIELDGROUP_ID);
-- Friend's Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETVALUE(PERSON_FRIENDS, '','', PERSON_FRIENDS_NUMBERS_NUMBER))', 'Friend''s Name', b'0', 1, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Constituent & Employees View & Field Definitions
--
-- *********************************************************************************************************************

DROP VIEW IF EXISTS VW_CONSTITUENTS_EMPLOYEES;
CREATE VIEW VW_CONSTITUENTS_EMPLOYEES
AS
	SELECT
		PERSON_PERSON_ID,
		PERSON_CONSTITUENT_ROLES,
		PERSON_CONSTITUENT_ROLE,
		PERSON_CONSTITUENT_TYPE,
		PERSON_CREATE_DATE,
		PERSON_FIRST_NAME,
		PERSON_LAPSED_DONOR,
		PERSON_LAST_NAME,
		PERSON_LEGAL_NAME,
		PERSON_LOGIN_ID,
		PERSON_MAJOR_DONOR,
		PERSON_MARITAL_STATUS,
		PERSON_MIDDLE_NAME,
		PERSON_NCAIS_CODE,
		PERSON_ORGANIZATION_NAME,
		PERSON_PREFERRED_PHONE_TYPE,
		PERSON_RECOGNITION_NAME,
		PERSON_SUFFIX,
		PERSON_TITLE,
		PERSON_UPDATE_DATE,
		PERSON_SITE_NAME,
		PERSON_EMPLOYEES,
		PERSON_EMPLOYEES_NUMBERS.NUMBER AS PERSON_EMPLOYEES_NUMBERS_NUMBER
	FROM VW_CONSTITUENTS_RELATIONSHIPS
	LEFT JOIN NUMBERS AS PERSON_EMPLOYEES_NUMBERS
		ON PERSON_EMPLOYEES_NUMBERS.NUMBER <= COUNTOFVALUES(PERSON_EMPLOYEES, ',')
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Constituents & Relationship Details');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Constituents & Employees', 0, 'VW_CONSTITUENTS_EMPLOYEES', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();


-- ***********************************************************************
-- Contact Details Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Contact Details', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('PERSON_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Manager Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager''))', 'Account Manager Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Account Manager Account Number
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager'')', 'Account Manager Account Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Constituent Type
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_TYPE', 'Constituent Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLES', 'Profile Types', b'0', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLE', 'Profile Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Title
CALL INSERTREPORTFIELD('PERSON_TITLE', 'Title', b'0', 1, @REPORTFIELDGROUP_ID);

-- First Name
CALL INSERTREPORTFIELD('PERSON_FIRST_NAME', 'First Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Middle Name
CALL INSERTREPORTFIELD('PERSON_MIDDLE_NAME', 'Middle Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Name
CALL INSERTREPORTFIELD('PERSON_LAST_NAME', 'Last Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Suffix
CALL INSERTREPORTFIELD('PERSON_SUFFIX', 'Suffix', b'0', 1, @REPORTFIELDGROUP_ID);

-- Recognition Name
CALL INSERTREPORTFIELD('PERSON_RECOGNITION_NAME', 'Recognition Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Organization Name
CALL INSERTREPORTFIELD('PERSON_ORGANIZATION_NAME', 'Organization Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Legal Name
CALL INSERTREPORTFIELD('PERSON_LEGAL_NAME', 'Legal Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.matching'')', 'Matching', b'0', 1, @REPORTFIELDGROUP_ID);

-- Percent Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.percentMatch'')', 'Percent Matching', b'0', 3, @REPORTFIELDGROUP_ID);

-- Maximum Match
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.maximumMatch'')', 'Maximum Match', b'0', 5, @REPORTFIELDGROUP_ID);

-- Website
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.website'')', 'Website', b'0', 1, @REPORTFIELDGROUP_ID);

-- Tax ID
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.taxid'')', 'Tax ID', b'0', 1, @REPORTFIELDGROUP_ID);

-- NCAIS Code
CALL INSERTREPORTFIELD('PERSON_NCAIS_CODE', 'NCAIS Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Communication Preferences
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''communicationPreferences'')', 'Communication Preferences', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Format
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''emailFormat'')', 'Email Format', b'0', 1, @REPORTFIELDGROUP_ID);

-- Create Date
CALL INSERTREPORTFIELD('CREATE_DATE', 'Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Update Date
CALL INSERTREPORTFIELD('UPDATE_DATE', 'Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Demographic Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Demographic Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Marital Status
CALL INSERTREPORTFIELD('PERSON_MARITAL_STATUS', 'Marital Status', b'0', 3, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.birthDate'')', 'Birth Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.deceased'')', 'Birth Date', b'0', 6, @REPORTFIELDGROUP_ID);

-- Gender
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.gender'')', 'Gender', b'0', 1, @REPORTFIELDGROUP_ID);

-- Race
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.race'')', 'Race', b'0', 1, @REPORTFIELDGROUP_ID);

-- Military
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.military'')', 'Military', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Miscellaneous Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Miscellaneous Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Major Donor
CALL INSERTREPORTFIELD('PERSON_MAJOR_DONOR', 'Major Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Lapsed Donor
CALL INSERTREPORTFIELD('PERSON_LAPSED_DONOR', 'Lapsed Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('PERSON_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Employees Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Employees Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Employees' Account Numbers
CALL INSERTREPORTFIELD('PERSON_EMPLOYEES', 'Employees'' Account Numbers', b'0', 1, @REPORTFIELDGROUP_ID);
-- Employees' Names
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAMES(PERSON_EMPLOYEES, '','')', 'Employees'' Names', b'0', 1, @REPORTFIELDGROUP_ID);

-- Employee's Account Number
CALL INSERTREPORTFIELD('GETVALUE(PERSON_EMPLOYEES, '','', PERSON_EMPLOYEES_NUMBERS_NUMBER)', 'Employee''s Account Number', b'0', 3, @REPORTFIELDGROUP_ID);
-- Parent's Member's Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETVALUE(PERSON_EMPLOYEES, '','', PERSON_EMPLOYEES_NUMBERS_NUMBER))', 'Employee''s Name', b'0', 1, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Constituent & Organizations View & Field Definitions (Parent Organization and Subsidiary List)
--
-- *********************************************************************************************************************

DROP VIEW IF EXISTS VW_CONSTITUENTS_ORGANIZATIONS;
CREATE VIEW VW_CONSTITUENTS_ORGANIZATIONS
AS
	SELECT
		PERSON_PERSON_ID,
		PERSON_CONSTITUENT_ROLES,
		PERSON_CONSTITUENT_ROLE,
		PERSON_CONSTITUENT_TYPE,
		PERSON_CREATE_DATE,
		PERSON_FIRST_NAME,
		PERSON_LAPSED_DONOR,
		PERSON_LAST_NAME,
		PERSON_LEGAL_NAME,
		PERSON_LOGIN_ID,
		PERSON_MAJOR_DONOR,
		PERSON_MARITAL_STATUS,
		PERSON_MIDDLE_NAME,
		PERSON_NCAIS_CODE,
		PERSON_ORGANIZATION_NAME,
		PERSON_PREFERRED_PHONE_TYPE,
		PERSON_RECOGNITION_NAME,
		PERSON_SUFFIX,
		PERSON_TITLE,
		PERSON_UPDATE_DATE,
		PERSON_SITE_NAME,
		PERSON_SUBSIDIARYLIST,
		PERSON_SUBSIDIARYLIST_NUMBERS.NUMBER AS PERSON_SUBSIDIARYLIST_NUMBERS_NUMBER
	FROM VW_CONSTITUENTS_RELATIONSHIPS
	LEFT JOIN NUMBERS AS PERSON_SUBSIDIARYLIST_NUMBERS
		ON PERSON_SUBSIDIARYLIST_NUMBERS.NUMBER <= COUNTOFVALUES(PERSON_SUBSIDIARYLIST, ',')
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Constituents & Relationship Details');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Constituents & Organizations', 0, 'VW_CONSTITUENTS_ORGANIZATIONS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();


-- ***********************************************************************
-- Contact Details Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Contact Details', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('PERSON_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Manager Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager''))', 'Account Manager Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Account Manager Account Number
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager'')', 'Account Manager Account Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Constituent Type
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_TYPE', 'Constituent Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLES', 'Profile Types', b'0', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLE', 'Profile Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Title
CALL INSERTREPORTFIELD('PERSON_TITLE', 'Title', b'0', 1, @REPORTFIELDGROUP_ID);

-- First Name
CALL INSERTREPORTFIELD('PERSON_FIRST_NAME', 'First Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Middle Name
CALL INSERTREPORTFIELD('PERSON_MIDDLE_NAME', 'Middle Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Name
CALL INSERTREPORTFIELD('PERSON_LAST_NAME', 'Last Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Suffix
CALL INSERTREPORTFIELD('PERSON_SUFFIX', 'Suffix', b'0', 1, @REPORTFIELDGROUP_ID);

-- Recognition Name
CALL INSERTREPORTFIELD('PERSON_RECOGNITION_NAME', 'Recognition Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Organization Name
CALL INSERTREPORTFIELD('PERSON_ORGANIZATION_NAME', 'Organization Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Legal Name
CALL INSERTREPORTFIELD('PERSON_LEGAL_NAME', 'Legal Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.matching'')', 'Matching', b'0', 1, @REPORTFIELDGROUP_ID);

-- Percent Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.percentMatch'')', 'Percent Matching', b'0', 3, @REPORTFIELDGROUP_ID);

-- Maximum Match
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.maximumMatch'')', 'Maximum Match', b'0', 5, @REPORTFIELDGROUP_ID);

-- Website
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.website'')', 'Website', b'0', 1, @REPORTFIELDGROUP_ID);

-- Tax ID
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.taxid'')', 'Tax ID', b'0', 1, @REPORTFIELDGROUP_ID);

-- NCAIS Code
CALL INSERTREPORTFIELD('PERSON_NCAIS_CODE', 'NCAIS Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Communication Preferences
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''communicationPreferences'')', 'Communication Preferences', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Format
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''emailFormat'')', 'Email Format', b'0', 1, @REPORTFIELDGROUP_ID);

-- Create Date
CALL INSERTREPORTFIELD('CREATE_DATE', 'Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Update Date
CALL INSERTREPORTFIELD('UPDATE_DATE', 'Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Demographic Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Demographic Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Marital Status
CALL INSERTREPORTFIELD('PERSON_MARITAL_STATUS', 'Marital Status', b'0', 3, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.birthDate'')', 'Birth Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.deceased'')', 'Birth Date', b'0', 6, @REPORTFIELDGROUP_ID);

-- Gender
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.gender'')', 'Gender', b'0', 1, @REPORTFIELDGROUP_ID);

-- Race
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.race'')', 'Race', b'0', 1, @REPORTFIELDGROUP_ID);

-- Military
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.military'')', 'Military', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Miscellaneous Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Miscellaneous Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Major Donor
CALL INSERTREPORTFIELD('PERSON_MAJOR_DONOR', 'Major Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Lapsed Donor
CALL INSERTREPORTFIELD('PERSON_LAPSED_DONOR', 'Lapsed Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('PERSON_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Organizations Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Organizations Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Parent Organization's Account Number
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.parent'')', 'Parent Organization''s Account Number', b'0', 3, @REPORTFIELDGROUP_ID);
-- Employees' Names
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.parent''))', 'Parent Organization''s Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Subsidiary List's Account Numbers
CALL INSERTREPORTFIELD('PERSON_SUBSIDIARYLIST', 'Subsidiary List''s Account Numbers', b'0', 1, @REPORTFIELDGROUP_ID);
-- Subsidiary List's Names
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAMES(PERSON_SUBSIDIARYLIST, '','')', 'Subsidiary List''s Names', b'0', 1, @REPORTFIELDGROUP_ID);

-- Subsidiary's Account Numbers
CALL INSERTREPORTFIELD('GETVALUE(PERSON_SUBSIDIARYLIST, '','', PERSON_SUBSIDIARYLIST_NUMBERS_NUMBER)', 'Subsidiary''s Account Number', b'0', 3, @REPORTFIELDGROUP_ID);
-- Subsidiary's Names
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETVALUE(PERSON_SUBSIDIARYLIST, '','', PERSON_SUBSIDIARYLIST_NUMBERS_NUMBER))', 'Subsidiary''s Name', b'0', 1, @REPORTFIELDGROUP_ID);


-- *********************************************************************************************************************
--
-- Constituent & Primary Contacts View & Field Definitions
--
-- *********************************************************************************************************************

DROP VIEW IF EXISTS VW_CONSTITUENTS_PRIMARYCONTACTS;
CREATE VIEW VW_CONSTITUENTS_PRIMARYCONTACTS
AS
	SELECT
		PERSON_PERSON_ID,
		PERSON_CONSTITUENT_ROLES,
		PERSON_CONSTITUENT_ROLE,
		PERSON_CONSTITUENT_TYPE,
		PERSON_CREATE_DATE,
		PERSON_FIRST_NAME,
		PERSON_LAPSED_DONOR,
		PERSON_LAST_NAME,
		PERSON_LEGAL_NAME,
		PERSON_LOGIN_ID,
		PERSON_MAJOR_DONOR,
		PERSON_MARITAL_STATUS,
		PERSON_MIDDLE_NAME,
		PERSON_NCAIS_CODE,
		PERSON_ORGANIZATION_NAME,
		PERSON_PREFERRED_PHONE_TYPE,
		PERSON_RECOGNITION_NAME,
		PERSON_SUFFIX,
		PERSON_TITLE,
		PERSON_UPDATE_DATE,
		PERSON_SITE_NAME,
		PERSON_PRIMARYCONTACTS,
		PERSON_PRIMARYCONTACTS_NUMBERS.NUMBER AS PERSON_PRIMARYCONTACTS_NUMBERS_NUMBER
	FROM VW_CONSTITUENTS_RELATIONSHIPS
	LEFT JOIN NUMBERS AS PERSON_PRIMARYCONTACTS_NUMBERS
		ON PERSON_PRIMARYCONTACTS_NUMBERS.NUMBER <= COUNTOFVALUES(PERSON_PRIMARYCONTACTS, ',')
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Constituents & Relationship Details');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Constituents & Primary Contacts', 0, 'VW_CONSTITUENTS_PRIMARYCONTACTS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();


-- ***********************************************************************
-- Contact Details Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Contact Details', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('PERSON_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Manager Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager''))', 'Account Manager Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Account Manager Account Number
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager'')', 'Account Manager Account Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Constituent Type
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_TYPE', 'Constituent Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLES', 'Profile Types', b'0', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLE', 'Profile Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Title
CALL INSERTREPORTFIELD('PERSON_TITLE', 'Title', b'0', 1, @REPORTFIELDGROUP_ID);

-- First Name
CALL INSERTREPORTFIELD('PERSON_FIRST_NAME', 'First Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Middle Name
CALL INSERTREPORTFIELD('PERSON_MIDDLE_NAME', 'Middle Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Name
CALL INSERTREPORTFIELD('PERSON_LAST_NAME', 'Last Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Suffix
CALL INSERTREPORTFIELD('PERSON_SUFFIX', 'Suffix', b'0', 1, @REPORTFIELDGROUP_ID);

-- Recognition Name
CALL INSERTREPORTFIELD('PERSON_RECOGNITION_NAME', 'Recognition Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Organization Name
CALL INSERTREPORTFIELD('PERSON_ORGANIZATION_NAME', 'Organization Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Legal Name
CALL INSERTREPORTFIELD('PERSON_LEGAL_NAME', 'Legal Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.matching'')', 'Matching', b'0', 1, @REPORTFIELDGROUP_ID);

-- Percent Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.percentMatch'')', 'Percent Matching', b'0', 3, @REPORTFIELDGROUP_ID);

-- Maximum Match
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.maximumMatch'')', 'Maximum Match', b'0', 5, @REPORTFIELDGROUP_ID);

-- Website
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.website'')', 'Website', b'0', 1, @REPORTFIELDGROUP_ID);

-- Tax ID
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.taxid'')', 'Tax ID', b'0', 1, @REPORTFIELDGROUP_ID);

-- NCAIS Code
CALL INSERTREPORTFIELD('PERSON_NCAIS_CODE', 'NCAIS Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Communication Preferences
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''communicationPreferences'')', 'Communication Preferences', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Format
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''emailFormat'')', 'Email Format', b'0', 1, @REPORTFIELDGROUP_ID);

-- Create Date
CALL INSERTREPORTFIELD('CREATE_DATE', 'Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Update Date
CALL INSERTREPORTFIELD('UPDATE_DATE', 'Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Demographic Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Demographic Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Marital Status
CALL INSERTREPORTFIELD('PERSON_MARITAL_STATUS', 'Marital Status', b'0', 3, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.birthDate'')', 'Birth Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.deceased'')', 'Birth Date', b'0', 6, @REPORTFIELDGROUP_ID);

-- Gender
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.gender'')', 'Gender', b'0', 1, @REPORTFIELDGROUP_ID);

-- Race
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.race'')', 'Race', b'0', 1, @REPORTFIELDGROUP_ID);

-- Military
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.military'')', 'Military', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Miscellaneous Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Miscellaneous Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Major Donor
CALL INSERTREPORTFIELD('PERSON_MAJOR_DONOR', 'Major Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Lapsed Donor
CALL INSERTREPORTFIELD('PERSON_LAPSED_DONOR', 'Lapsed Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('PERSON_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Primary Contacts Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Primary Contacts Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Primary Contacts' Account Numbers
CALL INSERTREPORTFIELD('PERSON_PRIMARYCONTACTS', 'Primary Contacts'' Account Numbers', b'0', 1, @REPORTFIELDGROUP_ID);
-- Primary Contacts' Names
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAMES(PERSON_PRIMARYCONTACTS, '','')', 'Primary Contacts'' Names', b'0', 1, @REPORTFIELDGROUP_ID);

-- Primary Contact's Account Number
CALL INSERTREPORTFIELD('GETVALUE(PERSON_PRIMARYCONTACTS, '','', PERSON_PRIMARYCONTACTS_NUMBERS_NUMBER)', 'Primary Contact''s Account Number', b'0', 3, @REPORTFIELDGROUP_ID);
-- Primary Contact's Member's Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETVALUE(PERSON_PRIMARYCONTACTS, '','', PERSON_PRIMARYCONTACTS_NUMBERS_NUMBER))', 'Primary Contact''s Name', b'0', 1, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Constituent & Billing Contacts View & Field Definitions
--
-- *********************************************************************************************************************

DROP VIEW IF EXISTS VW_CONSTITUENTS_BILLINGCONTACTS;
CREATE VIEW VW_CONSTITUENTS_BILLINGCONTACTS
AS
	SELECT
		PERSON_PERSON_ID,
		PERSON_CONSTITUENT_ROLES,
		PERSON_CONSTITUENT_ROLE,
		PERSON_CONSTITUENT_TYPE,
		PERSON_CREATE_DATE,
		PERSON_FIRST_NAME,
		PERSON_LAPSED_DONOR,
		PERSON_LAST_NAME,
		PERSON_LEGAL_NAME,
		PERSON_LOGIN_ID,
		PERSON_MAJOR_DONOR,
		PERSON_MARITAL_STATUS,
		PERSON_MIDDLE_NAME,
		PERSON_NCAIS_CODE,
		PERSON_ORGANIZATION_NAME,
		PERSON_PREFERRED_PHONE_TYPE,
		PERSON_RECOGNITION_NAME,
		PERSON_SUFFIX,
		PERSON_TITLE,
		PERSON_UPDATE_DATE,
		PERSON_SITE_NAME,
		PERSON_BILLINGCONTACTS,
		PERSON_BILLINGCONTACTS_NUMBERS.NUMBER AS PERSON_BILLINGCONTACTS_NUMBERS_NUMBER
	FROM VW_CONSTITUENTS_RELATIONSHIPS
	LEFT JOIN NUMBERS AS PERSON_BILLINGCONTACTS_NUMBERS
		ON PERSON_BILLINGCONTACTS_NUMBERS.NUMBER <= COUNTOFVALUES(PERSON_BILLINGCONTACTS, ',')
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Constituents & Relationship Details');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Constituents & Billing Contacts', 0, 'VW_CONSTITUENTS_BILLINGCONTACTS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();


-- ***********************************************************************
-- Contact Details Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Contact Details', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('PERSON_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Manager Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager''))', 'Account Manager Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Account Manager Account Number
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager'')', 'Account Manager Account Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Constituent Type
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_TYPE', 'Constituent Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLES', 'Profile Types', b'0', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLE', 'Profile Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Title
CALL INSERTREPORTFIELD('PERSON_TITLE', 'Title', b'0', 1, @REPORTFIELDGROUP_ID);

-- First Name
CALL INSERTREPORTFIELD('PERSON_FIRST_NAME', 'First Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Middle Name
CALL INSERTREPORTFIELD('PERSON_MIDDLE_NAME', 'Middle Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Name
CALL INSERTREPORTFIELD('PERSON_LAST_NAME', 'Last Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Suffix
CALL INSERTREPORTFIELD('PERSON_SUFFIX', 'Suffix', b'0', 1, @REPORTFIELDGROUP_ID);

-- Recognition Name
CALL INSERTREPORTFIELD('PERSON_RECOGNITION_NAME', 'Recognition Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Organization Name
CALL INSERTREPORTFIELD('PERSON_ORGANIZATION_NAME', 'Organization Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Legal Name
CALL INSERTREPORTFIELD('PERSON_LEGAL_NAME', 'Legal Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.matching'')', 'Matching', b'0', 1, @REPORTFIELDGROUP_ID);

-- Percent Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.percentMatch'')', 'Percent Matching', b'0', 3, @REPORTFIELDGROUP_ID);

-- Maximum Match
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.maximumMatch'')', 'Maximum Match', b'0', 5, @REPORTFIELDGROUP_ID);

-- Website
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.website'')', 'Website', b'0', 1, @REPORTFIELDGROUP_ID);

-- Tax ID
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.taxid'')', 'Tax ID', b'0', 1, @REPORTFIELDGROUP_ID);

-- NCAIS Code
CALL INSERTREPORTFIELD('PERSON_NCAIS_CODE', 'NCAIS Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Communication Preferences
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''communicationPreferences'')', 'Communication Preferences', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Format
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''emailFormat'')', 'Email Format', b'0', 1, @REPORTFIELDGROUP_ID);

-- Create Date
CALL INSERTREPORTFIELD('CREATE_DATE', 'Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Update Date
CALL INSERTREPORTFIELD('UPDATE_DATE', 'Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Demographic Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Demographic Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Marital Status
CALL INSERTREPORTFIELD('PERSON_MARITAL_STATUS', 'Marital Status', b'0', 3, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.birthDate'')', 'Birth Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.deceased'')', 'Birth Date', b'0', 6, @REPORTFIELDGROUP_ID);

-- Gender
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.gender'')', 'Gender', b'0', 1, @REPORTFIELDGROUP_ID);

-- Race
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.race'')', 'Race', b'0', 1, @REPORTFIELDGROUP_ID);

-- Military
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.military'')', 'Military', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Miscellaneous Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Miscellaneous Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Major Donor
CALL INSERTREPORTFIELD('PERSON_MAJOR_DONOR', 'Major Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Lapsed Donor
CALL INSERTREPORTFIELD('PERSON_LAPSED_DONOR', 'Lapsed Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('PERSON_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Billing Contacts Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Billing Contacts Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Billing Contacts' Account Numbers
CALL INSERTREPORTFIELD('PERSON_BILLINGCONTACTS', 'Billing Contacts'' Account Numbers', b'0', 1, @REPORTFIELDGROUP_ID);
-- Billing Contacts' Names
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAMES(PERSON_BILLINGCONTACTS, '','')', 'Billing Contacts'' Names', b'0', 1, @REPORTFIELDGROUP_ID);

-- Billing Contact's Account Number
CALL INSERTREPORTFIELD('GETVALUE(PERSON_BILLINGCONTACTS, '','', PERSON_BILLINGCONTACTS_NUMBERS_NUMBER)', 'Billing Contact''s Account Number', b'0', 3, @REPORTFIELDGROUP_ID);
-- Billing Conatact's Member's Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETVALUE(PERSON_BILLINGCONTACTS, '','', PERSON_BILLINGCONTACTS_NUMBERS_NUMBER))', 'Billing Contact''s Name', b'0', 1, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Constituent & Sales Contacts View & Field Definitions
--
-- *********************************************************************************************************************

DROP VIEW IF EXISTS VW_CONSTITUENTS_SALESCONTACTS;
CREATE VIEW VW_CONSTITUENTS_SALESCONTACTS
AS
	SELECT
		PERSON_PERSON_ID,
		PERSON_CONSTITUENT_ROLES,
		PERSON_CONSTITUENT_ROLE,
		PERSON_CONSTITUENT_TYPE,
		PERSON_CREATE_DATE,
		PERSON_FIRST_NAME,
		PERSON_LAPSED_DONOR,
		PERSON_LAST_NAME,
		PERSON_LEGAL_NAME,
		PERSON_LOGIN_ID,
		PERSON_MAJOR_DONOR,
		PERSON_MARITAL_STATUS,
		PERSON_MIDDLE_NAME,
		PERSON_NCAIS_CODE,
		PERSON_ORGANIZATION_NAME,
		PERSON_PREFERRED_PHONE_TYPE,
		PERSON_RECOGNITION_NAME,
		PERSON_SUFFIX,
		PERSON_TITLE,
		PERSON_UPDATE_DATE,
		PERSON_SITE_NAME,
		PERSON_SALESCONTACTS,
		PERSON_SALESCONTACTS_NUMBERS.NUMBER AS PERSON_SALESCONTACTS_NUMBERS_NUMBER
	FROM VW_CONSTITUENTS_RELATIONSHIPS
	LEFT JOIN NUMBERS AS PERSON_SALESCONTACTS_NUMBERS
		ON PERSON_SALESCONTACTS_NUMBERS.NUMBER <= COUNTOFVALUES(PERSON_SALESCONTACTS, ',')
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Constituents & Relationship Details');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Constituents & Sales Contacts', 0, 'VW_CONSTITUENTS_SALESCONTACTS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();


-- ***********************************************************************
-- Contact Details Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Contact Details', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('PERSON_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Manager Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager''))', 'Account Manager Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Account Manager Account Number
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager'')', 'Account Manager Account Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Constituent Type
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_TYPE', 'Constituent Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLES', 'Profile Types', b'0', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLE', 'Profile Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Title
CALL INSERTREPORTFIELD('PERSON_TITLE', 'Title', b'0', 1, @REPORTFIELDGROUP_ID);

-- First Name
CALL INSERTREPORTFIELD('PERSON_FIRST_NAME', 'First Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Middle Name
CALL INSERTREPORTFIELD('PERSON_MIDDLE_NAME', 'Middle Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Name
CALL INSERTREPORTFIELD('PERSON_LAST_NAME', 'Last Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Suffix
CALL INSERTREPORTFIELD('PERSON_SUFFIX', 'Suffix', b'0', 1, @REPORTFIELDGROUP_ID);

-- Recognition Name
CALL INSERTREPORTFIELD('PERSON_RECOGNITION_NAME', 'Recognition Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Organization Name
CALL INSERTREPORTFIELD('PERSON_ORGANIZATION_NAME', 'Organization Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Legal Name
CALL INSERTREPORTFIELD('PERSON_LEGAL_NAME', 'Legal Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.matching'')', 'Matching', b'0', 1, @REPORTFIELDGROUP_ID);

-- Percent Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.percentMatch'')', 'Percent Matching', b'0', 3, @REPORTFIELDGROUP_ID);

-- Maximum Match
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.maximumMatch'')', 'Maximum Match', b'0', 5, @REPORTFIELDGROUP_ID);

-- Website
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.website'')', 'Website', b'0', 1, @REPORTFIELDGROUP_ID);

-- Tax ID
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.taxid'')', 'Tax ID', b'0', 1, @REPORTFIELDGROUP_ID);

-- NCAIS Code
CALL INSERTREPORTFIELD('PERSON_NCAIS_CODE', 'NCAIS Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Communication Preferences
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''communicationPreferences'')', 'Communication Preferences', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Format
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''emailFormat'')', 'Email Format', b'0', 1, @REPORTFIELDGROUP_ID);

-- Create Date
CALL INSERTREPORTFIELD('CREATE_DATE', 'Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Update Date
CALL INSERTREPORTFIELD('UPDATE_DATE', 'Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Demographic Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Demographic Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Marital Status
CALL INSERTREPORTFIELD('PERSON_MARITAL_STATUS', 'Marital Status', b'0', 3, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.birthDate'')', 'Birth Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.deceased'')', 'Birth Date', b'0', 6, @REPORTFIELDGROUP_ID);

-- Gender
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.gender'')', 'Gender', b'0', 1, @REPORTFIELDGROUP_ID);

-- Race
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.race'')', 'Race', b'0', 1, @REPORTFIELDGROUP_ID);

-- Military
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.military'')', 'Military', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Miscellaneous Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Miscellaneous Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Major Donor
CALL INSERTREPORTFIELD('PERSON_MAJOR_DONOR', 'Major Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Lapsed Donor
CALL INSERTREPORTFIELD('PERSON_LAPSED_DONOR', 'Lapsed Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('PERSON_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Sales Contacts Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Sales Contacts Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Sales Contacts' Account Numbers
CALL INSERTREPORTFIELD('PERSON_SALESCONTACTS', 'Sales Contacts'' Account Numbers', b'0', 1, @REPORTFIELDGROUP_ID);
-- Sales Contacts' Names
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAMES(PERSON_SALESCONTACTS, '','')', 'Sales Contacts'' Names', b'0', 1, @REPORTFIELDGROUP_ID);

-- Sales Contact's Account Number
CALL INSERTREPORTFIELD('GETVALUE(PERSON_SALESCONTACTS, '','', PERSON_SALESCONTACTS_NUMBERS_NUMBER)', 'Sales Contact''s Account Number', b'0', 3, @REPORTFIELDGROUP_ID);
-- Sales Conatact's Member's Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETVALUE(PERSON_SALESCONTACTS, '','', PERSON_SALESCONTACTS_NUMBERS_NUMBER))', 'Sales Contact''s Name', b'0', 1, @REPORTFIELDGROUP_ID);


-- *********************************************************************************************************************
--
-- Constituent & Public Relations Contacts View & Field Definitions
--
-- *********************************************************************************************************************

DROP VIEW IF EXISTS VW_CONSTITUENTS_PUBLICRELATIONSCONTACTS;
CREATE VIEW VW_CONSTITUENTS_PUBLICRELATIONSCONTACTS
AS
	SELECT
		PERSON_PERSON_ID,
		PERSON_CONSTITUENT_ROLES,
		PERSON_CONSTITUENT_ROLE,
		PERSON_CONSTITUENT_TYPE,
		PERSON_CREATE_DATE,
		PERSON_FIRST_NAME,
		PERSON_LAPSED_DONOR,
		PERSON_LAST_NAME,
		PERSON_LEGAL_NAME,
		PERSON_LOGIN_ID,
		PERSON_MAJOR_DONOR,
		PERSON_MARITAL_STATUS,
		PERSON_MIDDLE_NAME,
		PERSON_NCAIS_CODE,
		PERSON_ORGANIZATION_NAME,
		PERSON_PREFERRED_PHONE_TYPE,
		PERSON_RECOGNITION_NAME,
		PERSON_SUFFIX,
		PERSON_TITLE,
		PERSON_UPDATE_DATE,
		PERSON_SITE_NAME,
		PERSON_PUBLICRELATIONSCONTACTS,
		PERSON_PUBLICRELATIONSCONTACTS_NUMBERS.NUMBER AS PERSON_PUBLICRELATIONSCONTACTS_NUMBERS_NUMBER
	FROM VW_CONSTITUENTS_RELATIONSHIPS
	LEFT JOIN NUMBERS AS PERSON_PUBLICRELATIONSCONTACTS_NUMBERS
		ON PERSON_PUBLICRELATIONSCONTACTS_NUMBERS.NUMBER <= COUNTOFVALUES(PERSON_PUBLICRELATIONSCONTACTS, ',')
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Constituents & Relationship Details');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Constituents & Public Relations Contacts', 0, 'VW_CONSTITUENTS_PUBLICRELATIONSCONTACTS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();


-- ***********************************************************************
-- Contact Details Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Contact Details', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('PERSON_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Manager Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager''))', 'Account Manager Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Account Manager Account Number
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager'')', 'Account Manager Account Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Constituent Type
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_TYPE', 'Constituent Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLES', 'Profile Types', b'0', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLE', 'Profile Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Title
CALL INSERTREPORTFIELD('PERSON_TITLE', 'Title', b'0', 1, @REPORTFIELDGROUP_ID);

-- First Name
CALL INSERTREPORTFIELD('PERSON_FIRST_NAME', 'First Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Middle Name
CALL INSERTREPORTFIELD('PERSON_MIDDLE_NAME', 'Middle Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Name
CALL INSERTREPORTFIELD('PERSON_LAST_NAME', 'Last Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Suffix
CALL INSERTREPORTFIELD('PERSON_SUFFIX', 'Suffix', b'0', 1, @REPORTFIELDGROUP_ID);

-- Recognition Name
CALL INSERTREPORTFIELD('PERSON_RECOGNITION_NAME', 'Recognition Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Organization Name
CALL INSERTREPORTFIELD('PERSON_ORGANIZATION_NAME', 'Organization Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Legal Name
CALL INSERTREPORTFIELD('PERSON_LEGAL_NAME', 'Legal Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.matching'')', 'Matching', b'0', 1, @REPORTFIELDGROUP_ID);

-- Percent Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.percentMatch'')', 'Percent Matching', b'0', 3, @REPORTFIELDGROUP_ID);

-- Maximum Match
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.maximumMatch'')', 'Maximum Match', b'0', 5, @REPORTFIELDGROUP_ID);

-- Website
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.website'')', 'Website', b'0', 1, @REPORTFIELDGROUP_ID);

-- Tax ID
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.taxid'')', 'Tax ID', b'0', 1, @REPORTFIELDGROUP_ID);

-- NCAIS Code
CALL INSERTREPORTFIELD('PERSON_NCAIS_CODE', 'NCAIS Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Communication Preferences
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''communicationPreferences'')', 'Communication Preferences', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Format
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''emailFormat'')', 'Email Format', b'0', 1, @REPORTFIELDGROUP_ID);

-- Create Date
CALL INSERTREPORTFIELD('CREATE_DATE', 'Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Update Date
CALL INSERTREPORTFIELD('UPDATE_DATE', 'Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Demographic Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Demographic Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Marital Status
CALL INSERTREPORTFIELD('PERSON_MARITAL_STATUS', 'Marital Status', b'0', 3, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.birthDate'')', 'Birth Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.deceased'')', 'Birth Date', b'0', 6, @REPORTFIELDGROUP_ID);

-- Gender
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.gender'')', 'Gender', b'0', 1, @REPORTFIELDGROUP_ID);

-- Race
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.race'')', 'Race', b'0', 1, @REPORTFIELDGROUP_ID);

-- Military
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.military'')', 'Military', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Miscellaneous Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Miscellaneous Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Major Donor
CALL INSERTREPORTFIELD('PERSON_MAJOR_DONOR', 'Major Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Lapsed Donor
CALL INSERTREPORTFIELD('PERSON_LAPSED_DONOR', 'Lapsed Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('PERSON_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Public Relations Contacts Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Public Relations Contacts Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Public Relations Contacts' Account Numbers
CALL INSERTREPORTFIELD('PERSON_PUBLICRELATIONSCONTACTS', 'Public Relations Contacts'' Account Numbers', b'0', 1, @REPORTFIELDGROUP_ID);
-- Public Relations Contacts' Names
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAMES(PERSON_PUBLICRELATIONSCONTACTS, '','')', 'Public Relations Contacts'' Names', b'0', 1, @REPORTFIELDGROUP_ID);

-- Public Relations Contact's Account Number
CALL INSERTREPORTFIELD('GETVALUE(PERSON_PUBLICRELATIONSCONTACTS, '','', PERSON_PUBLICRELATIONSCONTACTS_NUMBERS_NUMBER)', 'Public Relations Contact''s Account Number', b'0', 3, @REPORTFIELDGROUP_ID);
-- Public Relations Conatact's Member's Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETVALUE(PERSON_PUBLICRELATIONSCONTACTS, '','', PERSON_PUBLICRELATIONSCONTACTS_NUMBERS_NUMBER))', 'Public Relations Contact''s Name', b'0', 1, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Gifts View & Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_GIFTS;
CREATE VIEW VW_GIFTS
AS
	SELECT
		GIFT.PERSON_ID AS GIFT_PERSON_ID,
		GIFT.GIFT_ID AS GIFT_GIFT_ID,
		GIFT.AMOUNT AS GIFT_AMOUNT,
		GIFT.CURRENCY_CODE AS GIFT_CURRENCY_CODE,
		GIFT.DONATION_DATE AS GIFT_DONATION_DATE,
		GIFT.POSTMARK_DATE AS GIFT_POSTMARK_DATE,
		GIFT.COMMENTS AS GIFT_COMMENTS,
		GIFT.TRANSACTION_DATE AS GIFT_TRANSACTIONDATE,

		-- Payment Information
		PAYMENT_SOURCE.PAYMENT_PROFILE AS GIFT_PAYMENT_SOURCE_PAYMENT_PROFILE_DESCRIPTION,
		PAYMENT_SOURCE.PAYMENT_TYPE AS GIFT_PAYMENT_SOURCE_PAYMENT_TYPE,
		PAYMENT_SOURCE.CREDIT_CARD_TYPE AS GIFT_PAYMENT_SOURCE_CREDIT_CARD_TYPE,
		PAYMENT_SOURCE.CREDIT_CARD_HOLDER_NAME AS GIFT_PAYMENT_SOURCE_CREDIT_CARD_HOLDER_NAME,
		CONCAT(MONTH(PAYMENT_SOURCE.CREDIT_CARD_EXPIRATION), '/', YEAR(PAYMENT_SOURCE.CREDIT_CARD_EXPIRATION)) AS GIFT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION,
		PAYMENT_SOURCE.CREDIT_CARD_EXPIRATION AS GIFT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION_DATE,
		PAYMENT_SOURCE.ACH_HOLDER_NAME AS GIFT_PAYMENT_SOURCE_ACH_HOLDER_NAME,
		CONCAT('****', RIGHT(PAYMENT_SOURCE.ACH_ROUTING_NUMBER, 4)) AS GIFT_PAYMENT_SOURCE_ACH_ROUTING_NUMBER,
		GIFT.CHECK_NUMBER AS GIFT_CHECK_NUMBER,
		AUTH_CODE AS GIFT_AUTH_CODE,
			-- Payment Address
		GIFT_PAYMENT_ADDRESS.ADDRESS_LINE_1 AS GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_1,
		GIFT_PAYMENT_ADDRESS.ADDRESS_LINE_2 AS GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_2,
		GIFT_PAYMENT_ADDRESS.ADDRESS_LINE_3 AS GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_3,
		GIFT_PAYMENT_ADDRESS.CITY AS GIFT_PAYMENT_ADDRESS_CITY,
		GIFT_PAYMENT_ADDRESS.STATE_PROVINCE AS GIFT_PAYMENT_ADDRESS_STATE_PROVINCE,
		GIFT_PAYMENT_ADDRESS.POSTAL_CODE AS GIFT_PAYMENT_ADDRESS_POSTAL_CODE,
		GIFT_PAYMENT_ADDRESS.COUNTRY AS GIFT_PAYMENT_ADDRESS_COUNTRY,
			-- Payment Phone
		GIFT_PAYMENT_PHONE.NUMBER AS GIFT_PAYMENT_PHONE_NUMBER,

		-- Acknowledgment Information
		GIFT_ACKNOWLEDGEMENT_EMAIL.EMAIL_ADDRESS AS GIFT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS,
		SEND_ACKNOWLEDGMENT AS GIFT_SEND_ACKNOWLEDGMENT,
		ACKNOWLEDGMENT_DATE AS GIFT_ACKNOWLEDGMENT_DATE
	FROM GIFT
	LEFT JOIN PAYMENT_SOURCE ON GIFT.PAYMENT_SOURCE_ID = PAYMENT_SOURCE.PAYMENT_SOURCE_ID
	LEFT JOIN ADDRESS GIFT_PAYMENT_ADDRESS ON GIFT.ADDRESS_ID = GIFT_PAYMENT_ADDRESS.ADDRESS_ID
	LEFT JOIN PHONE GIFT_PAYMENT_PHONE ON GIFT.PHONE_ID = GIFT_PAYMENT_PHONE.PHONE_ID
	LEFT JOIN EMAIL GIFT_ACKNOWLEDGEMENT_EMAIL ON GIFT.EMAIL_ID = GIFT_ACKNOWLEDGEMENT_EMAIL.EMAIL_ID
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Transactions');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Gifts', 0, 'VW_GIFTS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();


-- ***********************************************************************
-- Gift Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Gift Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('GIFT_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GIFT_PERSON_ID)', 'Account Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Gift Reference Number
CALL INSERTREPORTFIELD('GIFT_GIFT_ID', 'Gift Reference Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Gift Amount
CALL INSERTREPORTFIELD('GIFT_AMOUNT', 'Gift Amount', b'1', 5, @REPORTFIELDGROUP_ID);

-- Currency Code
CALL INSERTREPORTFIELD('GIFT_CURRENCY_CODE', 'Currency Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Donation Date
CALL INSERTREPORTFIELD('GIFT_DONATION_DATE', 'Donation Date', b'1', 4, @REPORTFIELDGROUP_ID);

-- Postmark Date
CALL INSERTREPORTFIELD('GIFT_POSTMARK_DATE', 'Postmark Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Reference Account Number
CALL INSERTREPORTFIELD('GETGIFTCUSTOMFIELD(GIFT_GIFT_ID, ''reference'')', 'Reference Account Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Reference Account Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETGIFTCUSTOMFIELD(GIFT_GIFT_ID, ''reference''))', 'Reference Account Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Comments
CALL INSERTREPORTFIELD('GIFT_COMMENTS', 'Comments', b'0', 1, @REPORTFIELDGROUP_ID);

-- Transaction Date
CALL INSERTREPORTFIELD('GIFT_TRANSACTIONDATE', 'Transaction Date', b'0', 4, @REPORTFIELDGROUP_ID);


-- ***********************************************************************
-- Payment Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Payment Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Payment Profile Description
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_PAYMENT_PROFILE_DESCRIPTION', 'Payment Profile Description', b'0', 1, @REPORTFIELDGROUP_ID);

-- Payment Method
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_PAYMENT_TYPE', 'Payment Method', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Type
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_CREDIT_CARD_TYPE', 'Credit Card Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Holder Name
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_CREDIT_CARD_HOLDER_NAME', 'Credit Card Holder Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Expiration
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION', 'Credit Card Expiration', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Expiration (Date / Time)
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION_DATE', 'Credit Card Expiration (Date / Time)', b'0', 4, @REPORTFIELDGROUP_ID);

-- ACH Holder Name
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_ACH_HOLDER_NAME', 'ACH Holder Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ACH Routing Number
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_ACH_ROUTING_NUMBER', 'ACH Routing Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Check Number
CALL INSERTREPORTFIELD('GIFT_CHECK_NUMBER', 'Check Number', b'0', 2, @REPORTFIELDGROUP_ID);

-- Authorization Code
CALL INSERTREPORTFIELD('GIFT_AUTH_CODE', 'Authorization Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 1
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_1', 'Address Line 1', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 2
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_2', 'Address Line 2', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 3
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_3', 'Address Line 2', b'0', 1, @REPORTFIELDGROUP_ID);

-- City
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_CITY', 'City', b'0', 1, @REPORTFIELDGROUP_ID);

-- State/Province
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_STATE_PROVINCE', 'State/Province', b'0', 1, @REPORTFIELDGROUP_ID);

-- Zip/Postal Code
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_POSTAL_CODE', 'Zip/Postal Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Country
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_COUNTRY', 'Country', b'0', 1, @REPORTFIELDGROUP_ID);

-- Phone Number
CALL INSERTREPORTFIELD('GIFT_PAYMENT_PHONE_NUMBER', 'Phone Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Acknowledgment Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Acknowledgment Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Receipt Email
CALL INSERTREPORTFIELD('GIFT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS', 'Receipt Email', b'0', 1, @REPORTFIELDGROUP_ID);

-- Send Acknowledgment
CALL INSERTREPORTFIELD('GIFT_SEND_ACKNOWLEDGMENT', 'Send Acknowledgment', b'0', 6, @REPORTFIELDGROUP_ID);

-- Acknowledgment Date
CALL INSERTREPORTFIELD('GIFT_ACKNOWLEDGMENT_DATE', 'Acknowledgment Date', b'0', 4, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Gifts & Gift Distributions View & Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_GIFTS_DISTRIBUTIONS;
CREATE VIEW VW_GIFTS_DISTRIBUTIONS
AS
	SELECT
		GIFT.PERSON_ID AS GIFT_PERSON_ID,
		GIFT.GIFT_ID AS GIFT_GIFT_ID,
		GIFT.AMOUNT AS GIFT_AMOUNT,
		GIFT.CURRENCY_CODE AS GIFT_CURRENCY_CODE,
		GIFT.DONATION_DATE AS GIFT_DONATION_DATE,
		GIFT.POSTMARK_DATE AS GIFT_POSTMARK_DATE,
		GIFT.COMMENTS AS GIFT_COMMENTS,
		GIFT.TRANSACTION_DATE AS GIFT_TRANSACTIONDATE,

		-- Payment Information
		PAYMENT_SOURCE.PAYMENT_PROFILE AS GIFT_PAYMENT_SOURCE_PAYMENT_PROFILE_DESCRIPTION,
		PAYMENT_SOURCE.PAYMENT_TYPE AS GIFT_PAYMENT_SOURCE_PAYMENT_TYPE,
		PAYMENT_SOURCE.CREDIT_CARD_TYPE AS GIFT_PAYMENT_SOURCE_CREDIT_CARD_TYPE,
		PAYMENT_SOURCE.CREDIT_CARD_HOLDER_NAME AS GIFT_PAYMENT_SOURCE_CREDIT_CARD_HOLDER_NAME,
		CONCAT(MONTH(PAYMENT_SOURCE.CREDIT_CARD_EXPIRATION), '/', YEAR(PAYMENT_SOURCE.CREDIT_CARD_EXPIRATION)) AS GIFT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION,
		PAYMENT_SOURCE.CREDIT_CARD_EXPIRATION AS GIFT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION_DATE,
		PAYMENT_SOURCE.ACH_HOLDER_NAME AS GIFT_PAYMENT_SOURCE_ACH_HOLDER_NAME,
		CONCAT('****', RIGHT(PAYMENT_SOURCE.ACH_ROUTING_NUMBER, 4)) AS GIFT_PAYMENT_SOURCE_ACH_ROUTING_NUMBER,
		GIFT.CHECK_NUMBER AS GIFT_CHECK_NUMBER,
		AUTH_CODE AS GIFT_AUTH_CODE,
			-- Payment Address
		GIFT_PAYMENT_ADDRESS.ADDRESS_LINE_1 AS GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_1,
		GIFT_PAYMENT_ADDRESS.ADDRESS_LINE_2 AS GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_2,
		GIFT_PAYMENT_ADDRESS.ADDRESS_LINE_3 AS GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_3,
		GIFT_PAYMENT_ADDRESS.CITY AS GIFT_PAYMENT_ADDRESS_CITY,
		GIFT_PAYMENT_ADDRESS.STATE_PROVINCE AS GIFT_PAYMENT_ADDRESS_STATE_PROVINCE,
		GIFT_PAYMENT_ADDRESS.POSTAL_CODE AS GIFT_PAYMENT_ADDRESS_POSTAL_CODE,
		GIFT_PAYMENT_ADDRESS.COUNTRY AS GIFT_PAYMENT_ADDRESS_COUNTRY,
			-- Payment Phone
		GIFT_PAYMENT_PHONE.NUMBER AS GIFT_PAYMENT_PHONE_NUMBER,

		-- Acknowledgment Information
		GIFT_ACKNOWLEDGEMENT_EMAIL.EMAIL_ADDRESS AS GIFT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS,
		SEND_ACKNOWLEDGMENT AS GIFT_SEND_ACKNOWLEDGMENT,
		ACKNOWLEDGMENT_DATE AS GIFT_ACKNOWLEDGMENT_DATE,

		-- Gift Distribution Line Information
		DISTRO_LINE.DISTRO_LINE_ID AS DISTRO_LINE_DISTRO_LINE_ID,
		DISTRO_LINE.AMOUNT AS DISTRO_LINE_AMOUNT,
		DISTRO_LINE.PERCENTAGE AS DISTRO_LINE_PERCENTAGE,
		DISTRO_LINE.PROJECT_CODE AS DISTRO_LINE_PROJECT_CODE,
		DISTRO_LINE.MOTIVATION_CODE AS DISTRO_LINE_MOTIVATION_CODE
	FROM GIFT
	LEFT JOIN PAYMENT_SOURCE ON GIFT.PAYMENT_SOURCE_ID = PAYMENT_SOURCE.PAYMENT_SOURCE_ID
	LEFT JOIN ADDRESS GIFT_PAYMENT_ADDRESS ON GIFT.ADDRESS_ID = GIFT_PAYMENT_ADDRESS.ADDRESS_ID
	LEFT JOIN PHONE GIFT_PAYMENT_PHONE ON GIFT.PHONE_ID = GIFT_PAYMENT_PHONE.PHONE_ID
	LEFT JOIN EMAIL GIFT_ACKNOWLEDGEMENT_EMAIL ON GIFT.EMAIL_ID = GIFT_ACKNOWLEDGEMENT_EMAIL.EMAIL_ID
	LEFT JOIN DISTRO_LINE ON GIFT.GIFT_ID = DISTRO_LINE.GIFT_ID
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Transactions');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Gifts & Gift Distributions', 0, 'VW_GIFTS_DISTRIBUTIONS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();


-- ***********************************************************************
-- Gift Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Gift Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('GIFT_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GIFT_PERSON_ID)', 'Account Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Gift Reference Number
CALL INSERTREPORTFIELD('GIFT_GIFT_ID', 'Gift Reference Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Gift Amount
CALL INSERTREPORTFIELD('GIFT_AMOUNT', 'Gift Amount', b'1', 5, @REPORTFIELDGROUP_ID);

-- Currency Code
CALL INSERTREPORTFIELD('GIFT_CURRENCY_CODE', 'Currency Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Donation Date
CALL INSERTREPORTFIELD('GIFT_DONATION_DATE', 'Donation Date', b'1', 4, @REPORTFIELDGROUP_ID);

-- Postmark Date
CALL INSERTREPORTFIELD('GIFT_POSTMARK_DATE', 'Postmark Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Reference Account Number
CALL INSERTREPORTFIELD('GETGIFTCUSTOMFIELD(GIFT_GIFT_ID, ''reference'')', 'Reference Account Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Reference Account Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETGIFTCUSTOMFIELD(GIFT_GIFT_ID, ''reference''))', 'Reference Account Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Comments
CALL INSERTREPORTFIELD('GIFT_COMMENTS', 'Comments', b'0', 1, @REPORTFIELDGROUP_ID);

-- Transaction Date
CALL INSERTREPORTFIELD('GIFT_TRANSACTIONDATE', 'Transaction Date', b'0', 4, @REPORTFIELDGROUP_ID);


-- ***********************************************************************
-- Payment Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Payment Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Payment Profile Description
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_PAYMENT_PROFILE_DESCRIPTION', 'Payment Profile Description', b'0', 1, @REPORTFIELDGROUP_ID);

-- Payment Method
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_PAYMENT_TYPE', 'Payment Method', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Type
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_CREDIT_CARD_TYPE', 'Credit Card Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Holder Name
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_CREDIT_CARD_HOLDER_NAME', 'Credit Card Holder Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Expiration
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION', 'Credit Card Expiration', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Expiration (Date / Time)
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION_DATE', 'Credit Card Expiration (Date / Time)', b'0', 4, @REPORTFIELDGROUP_ID);

-- ACH Holder Name
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_ACH_HOLDER_NAME', 'ACH Holder Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ACH Routing Number
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_ACH_ROUTING_NUMBER', 'ACH Routing Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Check Number
CALL INSERTREPORTFIELD('GIFT_CHECK_NUMBER', 'Check Number', b'0', 2, @REPORTFIELDGROUP_ID);

-- Authorization Code
CALL INSERTREPORTFIELD('GIFT_AUTH_CODE', 'Authorization Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 1
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_1', 'Address Line 1', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 2
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_2', 'Address Line 2', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 3
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_3', 'Address Line 2', b'0', 1, @REPORTFIELDGROUP_ID);

-- City
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_CITY', 'City', b'0', 1, @REPORTFIELDGROUP_ID);

-- State/Province
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_STATE_PROVINCE', 'State/Province', b'0', 1, @REPORTFIELDGROUP_ID);

-- Zip/Postal Code
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_POSTAL_CODE', 'Zip/Postal Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Country
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_COUNTRY', 'Country', b'0', 1, @REPORTFIELDGROUP_ID);

-- Phone Number
CALL INSERTREPORTFIELD('GIFT_PAYMENT_PHONE_NUMBER', 'Phone Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Acknowledgment Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Acknowledgment Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Receipt Email
CALL INSERTREPORTFIELD('GIFT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS', 'Receipt Email', b'0', 1, @REPORTFIELDGROUP_ID);

-- Send Acknowledgment
CALL INSERTREPORTFIELD('GIFT_SEND_ACKNOWLEDGMENT', 'Send Acknowledgment', b'0', 6, @REPORTFIELDGROUP_ID);

-- Acknowledgment Date
CALL INSERTREPORTFIELD('GIFT_ACKNOWLEDGMENT_DATE', 'Acknowledgment Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Gift Distribution Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Gift Distribution', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Gift Distribution Reference Number
CALL INSERTREPORTFIELD('DISTRO_LINE_DISTRO_LINE_ID', 'Gift Distribution Reference Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Gift Distribution Amount
CALL INSERTREPORTFIELD('DISTRO_LINE_AMOUNT', 'Gift Distribution Amount', b'1', 5, @REPORTFIELDGROUP_ID);

-- Percentage
CALL INSERTREPORTFIELD('DISTRO_LINE_PERCENTAGE', 'Percentage', b'0', 5, @REPORTFIELDGROUP_ID);

-- Designation
CALL INSERTREPORTFIELD('DISTRO_LINE_PROJECT_CODE', 'Designation', b'0', 1, @REPORTFIELDGROUP_ID);

-- Motivation
CALL INSERTREPORTFIELD('DISTRO_LINE_MOTIVATION_CODE', 'Motivation', b'0', 1, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Payment History View & Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_PAYMENTHISTORY;
CREATE VIEW VW_PAYMENTHISTORY
AS
	SELECT
		PAYMENT_HISTORY.PAYMENT_HISTORY_ID AS PAYMENT_HISTORY_PAYMENT_HISTORY_ID,
		PAYMENT_HISTORY.PERSON_ID AS PAYMENT_HISTORY_PERSON_ID,
		PAYMENT_HISTORY.GIFT_ID AS PAYMENT_HISTORY_GIFT_ID,
		PAYMENT_HISTORY.TRANSACTION_DATE AS PAYMENT_HISTORY_TRANSACTION_DATE,
		PAYMENT_HISTORY.PAYMENT_TYPE AS PAYMENT_HISTORY_PAYMENT_TYPE,
		PAYMENT_HISTORY.AMOUNT AS PAYMENT_HISTORY_AMOUNT,
		PAYMENT_HISTORY.CURRENCY_CODE AS PAYMENT_HISTORY_CURRENCY_CODE,
		PAYMENT_HISTORY.PAYMENT_DESC AS PAYMENT_HISTORY_PAYMENT_DESC,
		CASE PAYMENT_HISTORY.PAYMENT_HISTORY_TYPE WHEN 0 THEN 'Unspecified' WHEN 1 THEN 'Gift' WHEN 2 THEN 'Membership' WHEN 3 THEN 'Order' END AS PAYMENT_HISTORY_PAYMENT_HISTORY_TYPE
	FROM PAYMENT_HISTORY
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Transactions');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Payment History', 0, 'VW_PAYMENTHISTORY', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();


-- ***********************************************************************
-- Payment Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Payment History', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Payment History ID
CALL INSERTREPORTFIELD('PAYMENT_HISTORY_PAYMENT_HISTORY_ID', 'Payment History ID', b'0', 3, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('PAYMENT_HISTORY_PERSON_ID', 'Account Number', b'0', 3, @REPORTFIELDGROUP_ID);

-- Account Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(PAYMENT_HISTORY_PERSON_ID)', 'Account Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Payment History Type
CALL INSERTREPORTFIELD('PAYMENT_HISTORY_PAYMENT_HISTORY_TYPE', 'Payment History Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Gift ID
CALL INSERTREPORTFIELD('PAYMENT_HISTORY_GIFT_ID', 'Gift ID', b'0', 3, @REPORTFIELDGROUP_ID);

-- Transaction Date
CALL INSERTREPORTFIELD('PAYMENT_HISTORY_TRANSACTION_DATE', 'Transaction Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Payment Method
CALL INSERTREPORTFIELD('PAYMENT_HISTORY_PAYMENT_TYPE', 'Payment Method', b'0', 1, @REPORTFIELDGROUP_ID);

-- Amount
CALL INSERTREPORTFIELD('PAYMENT_HISTORY_AMOUNT', 'Amount', b'0', 5, @REPORTFIELDGROUP_ID);

-- Currency Code
CALL INSERTREPORTFIELD('PAYMENT_HISTORY_CURRENCY_CODE', 'Currency Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Description
CALL INSERTREPORTFIELD('PAYMENT_HISTORY_PAYMENT_DESC', 'Description', b'0', 1, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Payment Methods View & Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_PAYMENTMETHODS;
CREATE VIEW VW_PAYMENTMETHODS
AS
	SELECT
		PAYMENT_SOURCE.PAYMENT_SOURCE_ID AS PAYMENT_SOURCE_PAYMENT_SOURCE_ID,
		PAYMENT_SOURCE.PERSON_ID AS PAYMENT_SOURCE_PERSON_ID,
		PAYMENT_SOURCE.PAYMENT_PROFILE AS PAYMENT_SOURCE_PAYMENT_PROFILE_DESCRIPTION,
		PAYMENT_SOURCE.PAYMENT_TYPE AS PAYMENT_SOURCE_PAYMENT_TYPE,
		PAYMENT_SOURCE.CREDIT_CARD_HOLDER_NAME AS PAYMENT_SOURCE_CREDIT_CARD_HOLDER_NAME,
		PAYMENT_SOURCE.CREDIT_CARD_TYPE AS PAYMENT_SOURCE_CREDIT_CARD_TYPE,
		CONCAT(MONTH(PAYMENT_SOURCE.CREDIT_CARD_EXPIRATION), '/', YEAR(PAYMENT_SOURCE.CREDIT_CARD_EXPIRATION)) AS PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION,
		PAYMENT_SOURCE.CREDIT_CARD_EXPIRATION AS PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION_DATE,
		PAYMENT_SOURCE.ACH_HOLDER_NAME AS PAYMENT_SOURCE_ACH_HOLDER_NAME,
		CONCAT('****', RIGHT(PAYMENT_SOURCE.ACH_ROUTING_NUMBER, 4)) AS PAYMENT_SOURCE_ACH_ROUTING_NUMBER,
			-- Payment Address
		PAYMENTMETHOD_ADDRESS.ADDRESS_LINE_1 AS PAYMENT_SOURCE_ADDRESS_ADDRESS_LINE_1,
		PAYMENTMETHOD_ADDRESS.ADDRESS_LINE_2 AS PAYMENT_SOURCE_ADDRESS_ADDRESS_LINE_2,
		PAYMENTMETHOD_ADDRESS.ADDRESS_LINE_3 AS PAYMENT_SOURCE_ADDRESS_ADDRESS_LINE_3,
		PAYMENTMETHOD_ADDRESS.CITY AS PAYMENT_SOURCE_ADDRESS_CITY,
		PAYMENTMETHOD_ADDRESS.STATE_PROVINCE AS PAYMENT_SOURCE_ADDRESS_STATE_PROVINCE,
		PAYMENTMETHOD_ADDRESS.POSTAL_CODE AS PAYMENT_SOURCE_ADDRESS_POSTAL_CODE,
		PAYMENTMETHOD_ADDRESS.COUNTRY AS PAYMENT_SOURCE_ADDRESS_COUNTRY,
			-- Payment Phone
		PAYMENTMETHOD_PHONE.NUMBER AS PAYMENT_SOURCE_PHONE_NUMBER
	FROM PAYMENT_SOURCE
	LEFT JOIN ADDRESS PAYMENTMETHOD_ADDRESS ON PAYMENT_SOURCE.ADDRESS_ID = PAYMENTMETHOD_ADDRESS.ADDRESS_ID
	LEFT JOIN PHONE PAYMENTMETHOD_PHONE ON PAYMENT_SOURCE.PHONE_ID = PAYMENTMETHOD_PHONE.PHONE_ID
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Transactions');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Payment Methods', 0, 'VW_PAYMENTMETHODS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();


-- ***********************************************************************
-- Payment Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Payment Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Payment Method ID
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_PAYMENT_SOURCE_ID', 'Payment Method ID', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(PAYMENT_SOURCE_PERSON_ID)', 'Account Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Payment Profile Description
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_PAYMENT_PROFILE_DESCRIPTION', 'Payment Profile Description', b'1', 1, @REPORTFIELDGROUP_ID);

-- Payment Method
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_PAYMENT_TYPE', 'Payment Method', b'1', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Holder Name
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_CREDIT_CARD_HOLDER_NAME', 'Credit Card Holder Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Type
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_CREDIT_CARD_TYPE', 'Credit Card Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Expiration
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION', 'Credit Card Expiration', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Expiration (Date / Time)
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION_DATE', 'Credit Card Expiration (Date / Time)', b'0', 4, @REPORTFIELDGROUP_ID);

-- ACH Holder Name
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_ACH_HOLDER_NAME', 'ACH Holder Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ACH Routing Number
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_ACH_ROUTING_NUMBER', 'ACH Routing Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Default Address/Phone Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Default Address/Phone Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Address Line 1
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_ADDRESS_ADDRESS_LINE_1', 'Address Line 1', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 2
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_ADDRESS_ADDRESS_LINE_2', 'Address Line 2', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 3
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_ADDRESS_ADDRESS_LINE_3', 'Address Line 3', b'0', 1, @REPORTFIELDGROUP_ID);

-- City
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_ADDRESS_CITY', 'City', b'0', 1, @REPORTFIELDGROUP_ID);

-- State/Province
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_ADDRESS_STATE_PROVINCE', 'State/Province', b'0', 1, @REPORTFIELDGROUP_ID);

-- Zip/Postal Code
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_ADDRESS_POSTAL_CODE', 'Zip/Postal Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Country
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_ADDRESS_COUNTRY', 'Country', b'0', 1, @REPORTFIELDGROUP_ID);

-- Phone Number
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_PHONE_NUMBER', 'Phone Number', b'0', 1, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Pledges View & Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_PLEDGES;
CREATE VIEW VW_PLEDGES
AS
	SELECT
		COMMITMENT.PERSON_ID AS COMMITMENT_PERSON_ID,
		COMMITMENT.COMMITMENT_ID AS COMMITMENT_COMMITMENT_ID,
		COMMITMENT.RECURRING AS COMMITMENT_RECURRING,
		COMMITMENT.AMOUNT_PER_GIFT AS COMMITMENT_AMOUNT_PER_GIFT,
		COMMITMENT.AMOUNT_TOTAL AS COMMITMENT_AMOUNT_TOTAL,	
		COMMITMENT.CURRENCY_CODE AS COMMITMENT_CURRENCY_CODE,
		COMMITMENT.STATUS AS COMMITMENT_STATUS,
		COMMITMENT.FREQUENCY AS COMMITMENT_FREQUENCY,
		COMMITMENT.PLEDGE_DATE AS COMMITMENT_PLEDGE_DATE,
		COMMITMENT.PROJECTED_DATE AS COMMITMENT_PROJECTED_DATE,
		COMMITMENT.START_DATE AS COMMITMENT_START_DATE,
		COMMITMENT.END_DATE AS COMMITMENT_END_DATE,
		COMMITMENT.COMMENTS AS COMMITMENT_COMMENTS,

		-- Acknowledgment Information
		COMMITMENT_ACKNOWLEDGEMENT_EMAIL.EMAIL_ADDRESS AS COMMITMENT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS,
		COMMITMENT.SEND_ACKNOWLEDGMENT AS COMMITMENT_SEND_ACKNOWLEDGMENT,
		COMMITMENT.ACKNOWLEDGMENT_DATE AS COMMITMENT_ACKNOWLEDGMENT_DATE
	FROM COMMITMENT	
	LEFT JOIN EMAIL COMMITMENT_ACKNOWLEDGEMENT_EMAIL ON COMMITMENT.EMAIL_ID = COMMITMENT_ACKNOWLEDGEMENT_EMAIL.EMAIL_ID
	WHERE COMMITMENT.COMMITMENT_TYPE = 'PLEDGE'
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Transactions');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Pledges', 0, 'VW_PLEDGES', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();

-- ***********************************************************************
-- Pledge Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Pledge Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account
CALL INSERTREPORTFIELD('COMMITMENT_COMMITMENT_ID', 'Pledge ID', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('COMMITMENT_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(COMMITMENT_PERSON_ID)', 'Account Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Recurring
CALL INSERTREPORTFIELD('COMMITMENT_RECURRING', 'Recurring', b'0', 6, @REPORTFIELDGROUP_ID);

-- Amount Per Gift
CALL INSERTREPORTFIELD('COMMITMENT_AMOUNT_PER_GIFT', 'Amount Per Gift', b'0', 5, @REPORTFIELDGROUP_ID);

-- Amount Total
CALL INSERTREPORTFIELD('COMMITMENT_AMOUNT_TOTAL', 'Amount Total', b'0', 5, @REPORTFIELDGROUP_ID);

-- Currency Code
CALL INSERTREPORTFIELD('COMMITMENT_CURRENCY_CODE', 'Currency Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Status
CALL INSERTREPORTFIELD('COMMITMENT_STATUS', 'Status', b'0', 1, @REPORTFIELDGROUP_ID);

-- Frequency
CALL INSERTREPORTFIELD('COMMITMENT_FREQUENCY', 'Frequency', b'0', 1, @REPORTFIELDGROUP_ID);

-- Pledge Date
CALL INSERTREPORTFIELD('COMMITMENT_PLEDGE_DATE', 'Pledge Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Projected Date
CALL INSERTREPORTFIELD('COMMITMENT_PROJECTED_DATE', 'Projected Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Start Date
CALL INSERTREPORTFIELD('COMMITMENT_START_DATE', 'Start Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- End Date
CALL INSERTREPORTFIELD('COMMITMENT_END_DATE', 'End Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Comments
CALL INSERTREPORTFIELD('COMMITMENT_COMMENTS', 'Comments', b'0', 1, @REPORTFIELDGROUP_ID);

-- Receipt Email
CALL INSERTREPORTFIELD('COMMITMENT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS', 'Receipt Email', b'0', 1, @REPORTFIELDGROUP_ID);

-- Send Acknowledgment
CALL INSERTREPORTFIELD('COMMITMENT_SEND_ACKNOWLEDGMENT', 'Send Acknowledgment', b'0', 6, @REPORTFIELDGROUP_ID);

-- Acknowledgment Date
CALL INSERTREPORTFIELD('COMMITMENT_ACKNOWLEDGMENT_DATE', 'Acknowledgment Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Acknowledgment Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Acknowledgment Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Receipt Email
CALL INSERTREPORTFIELD('COMMITMENT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS', 'Receipt Email', b'0', 1, @REPORTFIELDGROUP_ID);

-- Send Acknowledgment
CALL INSERTREPORTFIELD('COMMITMENT_SEND_ACKNOWLEDGMENT', 'Send Acknowledgment', b'0', 6, @REPORTFIELDGROUP_ID);

-- Acknowledgment Date
CALL INSERTREPORTFIELD('COMMITMENT_ACKNOWLEDGMENT_DATE', 'Acknowledgment Date', b'0', 4, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Pledges & Distributions View & Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_PLEDGES_DISTRIBUTIONS;
CREATE VIEW VW_PLEDGES_DISTRIBUTIONS
AS
	SELECT
		COMMITMENT.PERSON_ID AS COMMITMENT_PERSON_ID,
		COMMITMENT.COMMITMENT_ID AS COMMITMENT_COMMITMENT_ID,
		COMMITMENT.RECURRING AS COMMITMENT_RECURRING,
		COMMITMENT.AMOUNT_PER_GIFT AS COMMITMENT_AMOUNT_PER_GIFT,
		COMMITMENT.AMOUNT_TOTAL AS COMMITMENT_AMOUNT_TOTAL,	
		COMMITMENT.CURRENCY_CODE AS COMMITMENT_CURRENCY_CODE,
		COMMITMENT.STATUS AS COMMITMENT_STATUS,
		COMMITMENT.FREQUENCY AS COMMITMENT_FREQUENCY,
		COMMITMENT.PLEDGE_DATE AS COMMITMENT_PLEDGE_DATE,
		COMMITMENT.PROJECTED_DATE AS COMMITMENT_PROJECTED_DATE,
		COMMITMENT.START_DATE AS COMMITMENT_START_DATE,
		COMMITMENT.END_DATE AS COMMITMENT_END_DATE,
		COMMITMENT.COMMENTS AS COMMITMENT_COMMENTS,

		-- Acknowledgment Information
		COMMITMENT_ACKNOWLEDGEMENT_EMAIL.EMAIL_ADDRESS AS COMMITMENT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS,
		COMMITMENT.SEND_ACKNOWLEDGMENT AS COMMITMENT_SEND_ACKNOWLEDGMENT,
		COMMITMENT.ACKNOWLEDGMENT_DATE AS COMMITMENT_ACKNOWLEDGMENT_DATE,

		-- Gift Distribution Line Information
		DISTRO_LINE.DISTRO_LINE_ID AS DISTRO_LINE_DISTRO_LINE_ID,
		DISTRO_LINE.AMOUNT AS DISTRO_LINE_AMOUNT,
		DISTRO_LINE.PERCENTAGE AS DISTRO_LINE_PERCENTAGE,
		DISTRO_LINE.PROJECT_CODE AS DISTRO_LINE_PROJECT_CODE,
		DISTRO_LINE.MOTIVATION_CODE AS DISTRO_LINE_MOTIVATION_CODE
	FROM COMMITMENT	
	LEFT JOIN EMAIL COMMITMENT_ACKNOWLEDGEMENT_EMAIL ON COMMITMENT.EMAIL_ID = COMMITMENT_ACKNOWLEDGEMENT_EMAIL.EMAIL_ID
	LEFT JOIN DISTRO_LINE ON COMMITMENT.COMMITMENT_ID = DISTRO_LINE.COMMITMENT_ID
	WHERE COMMITMENT.COMMITMENT_TYPE = 'PLEDGE'
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Transactions');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Pledges & Distributions', 0, 'VW_PLEDGES_DISTRIBUTIONS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();

-- ***********************************************************************
-- Pledge Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Pledge Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account
CALL INSERTREPORTFIELD('COMMITMENT_COMMITMENT_ID', 'Pledge ID', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('COMMITMENT_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Recurring
CALL INSERTREPORTFIELD('COMMITMENT_RECURRING', 'Recurring', b'0', 6, @REPORTFIELDGROUP_ID);

-- Amount Per Gift
CALL INSERTREPORTFIELD('COMMITMENT_AMOUNT_PER_GIFT', 'Amount Per Gift', b'0', 5, @REPORTFIELDGROUP_ID);

-- Amount Total
CALL INSERTREPORTFIELD('COMMITMENT_AMOUNT_TOTAL', 'Amount Total', b'0', 5, @REPORTFIELDGROUP_ID);

-- Currency Code
CALL INSERTREPORTFIELD('COMMITMENT_CURRENCY_CODE', 'Currency Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Status
CALL INSERTREPORTFIELD('COMMITMENT_STATUS', 'Status', b'0', 1, @REPORTFIELDGROUP_ID);

-- Frequency
CALL INSERTREPORTFIELD('COMMITMENT_FREQUENCY', 'Frequency', b'0', 1, @REPORTFIELDGROUP_ID);

-- Pledge Date
CALL INSERTREPORTFIELD('COMMITMENT_PLEDGE_DATE', 'Pledge Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Projected Date
CALL INSERTREPORTFIELD('COMMITMENT_PROJECTED_DATE', 'Projected Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Start Date
CALL INSERTREPORTFIELD('COMMITMENT_START_DATE', 'Start Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- End Date
CALL INSERTREPORTFIELD('COMMITMENT_END_DATE', 'End Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Comments
CALL INSERTREPORTFIELD('COMMITMENT_COMMENTS', 'Comments', b'0', 1, @REPORTFIELDGROUP_ID);

-- Receipt Email
CALL INSERTREPORTFIELD('COMMITMENT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS', 'Receipt Email', b'0', 1, @REPORTFIELDGROUP_ID);

-- Send Acknowledgment
CALL INSERTREPORTFIELD('COMMITMENT_SEND_ACKNOWLEDGMENT', 'Send Acknowledgment', b'0', 6, @REPORTFIELDGROUP_ID);

-- Acknowledgment Date
CALL INSERTREPORTFIELD('COMMITMENT_ACKNOWLEDGMENT_DATE', 'Acknowledgment Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Acknowledgment Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Acknowledgment Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Receipt Email
CALL INSERTREPORTFIELD('COMMITMENT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS', 'Receipt Email', b'0', 1, @REPORTFIELDGROUP_ID);

-- Send Acknowledgment
CALL INSERTREPORTFIELD('COMMITMENT_SEND_ACKNOWLEDGMENT', 'Send Acknowledgment', b'0', 6, @REPORTFIELDGROUP_ID);

-- Acknowledgment Date
CALL INSERTREPORTFIELD('COMMITMENT_ACKNOWLEDGMENT_DATE', 'Acknowledgment Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Pledge Distribution Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Pledge Distribution', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Plege Distribution Reference Number
CALL INSERTREPORTFIELD('DISTRO_LINE_DISTRO_LINE_ID', 'Pledge Distribution Reference Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Pledge Distribution Amount
CALL INSERTREPORTFIELD('DISTRO_LINE_AMOUNT', 'Pledge Distribution Amount', b'1', 5, @REPORTFIELDGROUP_ID);

-- Percentage
CALL INSERTREPORTFIELD('DISTRO_LINE_PERCENTAGE', 'Percentage', b'0', 5, @REPORTFIELDGROUP_ID);

-- Designation
CALL INSERTREPORTFIELD('DISTRO_LINE_PROJECT_CODE', 'Designation', b'0', 1, @REPORTFIELDGROUP_ID);

-- Motivation
CALL INSERTREPORTFIELD('DISTRO_LINE_MOTIVATION_CODE', 'Motivation', b'0', 1, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Recurring Gifts View & Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_RECURRINGGIFTS;
CREATE VIEW VW_RECURRINGGIFTS
AS
	SELECT
		COMMITMENT.COMMITMENT_ID AS COMMITMENT_COMMITMENT_ID,
		COMMITMENT.PERSON_ID AS COMMITMENT_PERSON_ID,
		COMMITMENT.AUTO_PAY AS COMMITMENT_AUTO_PAY,
		COMMITMENT.AMOUNT_PER_GIFT AS COMMITMENT_AMOUNT_PER_GIFT,
		COMMITMENT.AMOUNT_TOTAL AS COMMITMENT_AMOUNT_TOTAL,
		COMMITMENT.CURRENCY_CODE AS COMMITMENT_CURRENCY_CODE,
		COMMITMENT.FREQUENCY AS COMMITMENT_FREQUENCY,
		COMMITMENT.START_DATE AS COMMITMENT_START_DATE,
		COMMITMENT.END_DATE AS COMMITMENT_END_DATE,
		COMMITMENT.STATUS AS COMMITMENT_STATUS,
		COMMITMENT.NOTES AS COMMITMENT_COMMENTS,
		COMMITMENT.LAST_ENTRY_DATE AS COMMITMENT_LAST_ENTRY_DATE,
		COMMITMENT.CREATE_DATE AS COMMITMENT_CREATE_DATE,
		COMMITMENT.UPDATE_DATE AS COMMITMENT_UPDATE_DATE,

		-- Payment Information
		PAYMENT_SOURCE.PAYMENT_PROFILE AS COMMITMENT_PAYMENT_SOURCE_PAYMENT_PROFILE_DESCRIPTION,
		PAYMENT_SOURCE.PAYMENT_TYPE AS COMMITMENT_PAYMENT_SOURCE_PAYMENT_TYPE,
		PAYMENT_SOURCE.CREDIT_CARD_TYPE AS COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_TYPE,
		PAYMENT_SOURCE.CREDIT_CARD_HOLDER_NAME AS COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_HOLDER_NAME,
		CONCAT(MONTH(PAYMENT_SOURCE.CREDIT_CARD_EXPIRATION), '/', YEAR(PAYMENT_SOURCE.CREDIT_CARD_EXPIRATION)) AS COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION,
		PAYMENT_SOURCE.CREDIT_CARD_EXPIRATION AS COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION_DATE,
		PAYMENT_SOURCE.ACH_HOLDER_NAME AS COMMITMENT_PAYMENT_SOURCE_ACH_HOLDER_NAME,
		CONCAT('****', RIGHT(PAYMENT_SOURCE.ACH_ROUTING_NUMBER, 4)) AS COMMITMENT_PAYMENT_SOURCE_ACH_ROUTING_NUMBER,
		COMMITMENT.CHECK_NUMBER AS COMMITMENT_CHECK_NUMBER,
			-- Payment Address
		COMMITMENT_PAYMENT_ADDRESS.ADDRESS_LINE_1 AS COMMITMENT_PAYMENT_ADDRESS_ADDRESS_LINE_1,
		COMMITMENT_PAYMENT_ADDRESS.ADDRESS_LINE_2 AS COMMITMENT_PAYMENT_ADDRESS_ADDRESS_LINE_2,
		COMMITMENT_PAYMENT_ADDRESS.ADDRESS_LINE_3 AS COMMITMENT_PAYMENT_ADDRESS_ADDRESS_LINE_3,
		COMMITMENT_PAYMENT_ADDRESS.CITY AS COMMITMENT_PAYMENT_ADDRESS_CITY,
		COMMITMENT_PAYMENT_ADDRESS.STATE_PROVINCE AS COMMITMENT_PAYMENT_ADDRESS_STATE_PROVINCE,
		COMMITMENT_PAYMENT_ADDRESS.POSTAL_CODE AS COMMITMENT_PAYMENT_ADDRESS_POSTAL_CODE,
		COMMITMENT_PAYMENT_ADDRESS.COUNTRY AS COMMITMENT_PAYMENT_ADDRESS_COUNTRY,
			-- Payment Phone
		COMMITMENT_PAYMENT_PHONE.NUMBER AS COMMITMENT_PAYMENT_PHONE_NUMBER,

		-- Acknowledgment Information
		COMMITMENT_ACKNOWLEDGEMENT_EMAIL.EMAIL_ADDRESS AS COMMITMENT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS,
		COMMITMENT.SEND_ACKNOWLEDGMENT AS COMMITMENT_SEND_ACKNOWLEDGMENT,
		COMMITMENT.ACKNOWLEDGMENT_DATE AS COMMITMENT_ACKNOWLEDGMENT_DATE
	FROM COMMITMENT
	LEFT JOIN PAYMENT_SOURCE ON COMMITMENT.PAYMENT_SOURCE_ID = PAYMENT_SOURCE.PAYMENT_SOURCE_ID
	LEFT JOIN ADDRESS COMMITMENT_PAYMENT_ADDRESS ON COMMITMENT.ADDRESS_ID = COMMITMENT_PAYMENT_ADDRESS.ADDRESS_ID
	LEFT JOIN PHONE COMMITMENT_PAYMENT_PHONE ON COMMITMENT.PHONE_ID = COMMITMENT_PAYMENT_PHONE.PHONE_ID
	LEFT JOIN EMAIL COMMITMENT_ACKNOWLEDGEMENT_EMAIL ON COMMITMENT.EMAIL_ID = COMMITMENT_ACKNOWLEDGEMENT_EMAIL.EMAIL_ID
	WHERE COMMITMENT.COMMITMENT_TYPE = 'RECURRING_GIFT'
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Transactions');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Recurring Gifts', 0, 'VW_RECURRINGGIFTS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();

-- ***********************************************************************
-- Recurring Gift Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Recurring Gift Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Recurring Gift ID
CALL INSERTREPORTFIELD('COMMITMENT_COMMITMENT_ID', 'Recurring Gift ID', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('COMMITMENT_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(COMMITMENT_PERSON_ID)', 'Account Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Auto Pay
CALL INSERTREPORTFIELD('COMMITMENT_AUTO_PAY', 'Auto Pay', b'0', 6, @REPORTFIELDGROUP_ID);

-- Amount Per Gift
CALL INSERTREPORTFIELD('COMMITMENT_AMOUNT_PER_GIFT', 'Amount Per Gift', b'1', 5, @REPORTFIELDGROUP_ID);

-- Amount Total
CALL INSERTREPORTFIELD('COMMITMENT_AMOUNT_TOTAL', 'Amount Total', b'1', 5, @REPORTFIELDGROUP_ID);

-- Currency Code
CALL INSERTREPORTFIELD('COMMITMENT_CURRENCY_CODE', 'Currency Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Frequency
CALL INSERTREPORTFIELD('COMMITMENT_FREQUENCY', 'Frequency', b'0', 1, @REPORTFIELDGROUP_ID);

-- Start Date
CALL INSERTREPORTFIELD('COMMITMENT_START_DATE', 'Start Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- End Date
CALL INSERTREPORTFIELD('COMMITMENT_END_DATE', 'End Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Status
CALL INSERTREPORTFIELD('COMMITMENT_STATUS', 'Status', b'0', 1, @REPORTFIELDGROUP_ID);

-- Reference Account Number
CALL INSERTREPORTFIELD('GETCOMMITMENTCUSTOMFIELD(COMMITMENT_COMMITMENT_ID, ''reference'')', 'Reference Account Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Reference Account Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETCOMMITMENTCUSTOMFIELD(COMMITMENT_COMMITMENT_ID, ''reference''))', 'Reference Account Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Comments
CALL INSERTREPORTFIELD('COMMITMENT_COMMENTS', 'Comments', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Entry Date
CALL INSERTREPORTFIELD('COMMITMENT_LAST_ENTRY_DATE', 'Last Entry Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Recurring Gift Create Date
CALL INSERTREPORTFIELD('COMMITMENT_CREATE_DATE', 'Recurring Gift Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Recurring Gift Update Date
CALL INSERTREPORTFIELD('COMMITMENT_UPDATE_DATE', 'Recurring Gift Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Payment Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Payment Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Payment Profile Description
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_PAYMENT_PROFILE_DESCRIPTION', 'Payment Profile Description', b'0', 1, @REPORTFIELDGROUP_ID);

-- Payment Method
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_PAYMENT_TYPE', 'Payment Method', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Type
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_TYPE', 'Credit Card Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Holder Name
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_HOLDER_NAME', 'Credit Card Holder Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Expiration
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION', 'Credit Card Expiration', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Expiration (Date / Time)
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION_DATE', 'Credit Card Expiration (Date / Time)', b'0', 4, @REPORTFIELDGROUP_ID);

-- ACH Holder Name
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_ACH_HOLDER_NAME', 'ACH Holder Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ACH Routing Number
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_ACH_ROUTING_NUMBER', 'ACH Routing Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Check Number
CALL INSERTREPORTFIELD('COMMITMENT_CHECK_NUMBER', 'Check Number', b'0', 2, @REPORTFIELDGROUP_ID);

-- Address Line 1
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_ADDRESS_LINE_1', 'Address Line 1', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 2
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_ADDRESS_LINE_2', 'Address Line 2', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 3
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_ADDRESS_LINE_3', 'Address Line 3', b'0', 1, @REPORTFIELDGROUP_ID);

-- City
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_CITY', 'City', b'0', 1, @REPORTFIELDGROUP_ID);

-- State/Province
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_STATE_PROVINCE', 'State/Province', b'0', 1, @REPORTFIELDGROUP_ID);

-- Zip/Postal Code
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_POSTAL_CODE', 'Zip/Postal Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Country
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_COUNTRY', 'Country', b'0', 1, @REPORTFIELDGROUP_ID);

-- Phone Number
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_PHONE_NUMBER', 'Phone Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Acknowledgment Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Acknowledgment Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Receipt Email
CALL INSERTREPORTFIELD('COMMITMENT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS', 'Receipt Email', b'0', 1, @REPORTFIELDGROUP_ID);

-- Send Acknowledgment
CALL INSERTREPORTFIELD('COMMITMENT_SEND_ACKNOWLEDGMENT', 'Send Acknowledgment', b'0', 6, @REPORTFIELDGROUP_ID);

-- Acknowledgment Date
CALL INSERTREPORTFIELD('COMMITMENT_ACKNOWLEDGMENT_DATE', 'Acknowledgment Date', b'0', 4, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Recurring Gifts & Distributions View & Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_RECURRINGGIFTS_DISTRIBUTIONS;
CREATE VIEW VW_RECURRINGGIFTS_DISTRIBUTIONS
AS
	SELECT
		COMMITMENT.COMMITMENT_ID AS COMMITMENT_COMMITMENT_ID,
		COMMITMENT.PERSON_ID AS COMMITMENT_PERSON_ID,
		COMMITMENT.AUTO_PAY AS COMMITMENT_AUTO_PAY,
		COMMITMENT.AMOUNT_PER_GIFT AS COMMITMENT_AMOUNT_PER_GIFT,
		COMMITMENT.AMOUNT_TOTAL AS COMMITMENT_AMOUNT_TOTAL,
		COMMITMENT.CURRENCY_CODE AS COMMITMENT_CURRENCY_CODE,
		COMMITMENT.FREQUENCY AS COMMITMENT_FREQUENCY,
		COMMITMENT.START_DATE AS COMMITMENT_START_DATE,
		COMMITMENT.END_DATE AS COMMITMENT_END_DATE,
		COMMITMENT.STATUS AS COMMITMENT_STATUS,
		COMMITMENT.NOTES AS COMMITMENT_COMMENTS,
		COMMITMENT.RECURRING AS COMMITMENT_RECURRING,
		COMMITMENT.LAST_ENTRY_DATE AS COMMITMENT_LAST_ENTRY_DATE,
		COMMITMENT.CREATE_DATE AS COMMITMENT_CREATE_DATE,
		COMMITMENT.UPDATE_DATE AS COMMITMENT_UPDATE_DATE,

		-- Payment Information
		PAYMENT_SOURCE.PAYMENT_PROFILE AS COMMITMENT_PAYMENT_SOURCE_PAYMENT_PROFILE_DESCRIPTION,
		PAYMENT_SOURCE.PAYMENT_TYPE AS COMMITMENT_PAYMENT_SOURCE_PAYMENT_TYPE,
		PAYMENT_SOURCE.CREDIT_CARD_TYPE AS COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_TYPE,
		PAYMENT_SOURCE.CREDIT_CARD_HOLDER_NAME AS COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_HOLDER_NAME,
		CONCAT(MONTH(PAYMENT_SOURCE.CREDIT_CARD_EXPIRATION), '/', YEAR(PAYMENT_SOURCE.CREDIT_CARD_EXPIRATION)) AS COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION,
		PAYMENT_SOURCE.CREDIT_CARD_EXPIRATION AS COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION_DATE,
		PAYMENT_SOURCE.ACH_HOLDER_NAME AS COMMITMENT_PAYMENT_SOURCE_ACH_HOLDER_NAME,
		CONCAT('****', RIGHT(PAYMENT_SOURCE.ACH_ROUTING_NUMBER, 4)) AS COMMITMENT_PAYMENT_SOURCE_ACH_ROUTING_NUMBER,
		COMMITMENT.CHECK_NUMBER AS COMMITMENT_CHECK_NUMBER,
			-- Payment Address
		COMMITMENT_PAYMENT_ADDRESS.ADDRESS_LINE_1 AS COMMITMENT_PAYMENT_ADDRESS_ADDRESS_LINE_1,
		COMMITMENT_PAYMENT_ADDRESS.ADDRESS_LINE_2 AS COMMITMENT_PAYMENT_ADDRESS_ADDRESS_LINE_2,
		COMMITMENT_PAYMENT_ADDRESS.ADDRESS_LINE_3 AS COMMITMENT_PAYMENT_ADDRESS_ADDRESS_LINE_3,
		COMMITMENT_PAYMENT_ADDRESS.CITY AS COMMITMENT_PAYMENT_ADDRESS_CITY,
		COMMITMENT_PAYMENT_ADDRESS.STATE_PROVINCE AS COMMITMENT_PAYMENT_ADDRESS_STATE_PROVINCE,
		COMMITMENT_PAYMENT_ADDRESS.POSTAL_CODE AS COMMITMENT_PAYMENT_ADDRESS_POSTAL_CODE,
		COMMITMENT_PAYMENT_ADDRESS.COUNTRY AS COMMITMENT_PAYMENT_ADDRESS_COUNTRY,
			-- Payment Phone
		COMMITMENT_PAYMENT_PHONE.NUMBER AS COMMITMENT_PAYMENT_PHONE_NUMBER,

		-- Acknowledgment Information
		COMMITMENT_ACKNOWLEDGEMENT_EMAIL.EMAIL_ADDRESS AS COMMITMENT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS,
		COMMITMENT.SEND_ACKNOWLEDGMENT AS COMMITMENT_SEND_ACKNOWLEDGMENT,
		COMMITMENT.ACKNOWLEDGMENT_DATE AS COMMITMENT_ACKNOWLEDGMENT_DATE,

		-- Gift Distribution Line Information
		DISTRO_LINE.DISTRO_LINE_ID AS DISTRO_LINE_DISTRO_LINE_ID,
		DISTRO_LINE.AMOUNT AS DISTRO_LINE_AMOUNT,
		DISTRO_LINE.PERCENTAGE AS DISTRO_LINE_PERCENTAGE,
		DISTRO_LINE.PROJECT_CODE AS DISTRO_LINE_PROJECT_CODE,
		DISTRO_LINE.MOTIVATION_CODE AS DISTRO_LINE_MOTIVATION_CODE
	FROM COMMITMENT
	LEFT JOIN PAYMENT_SOURCE ON COMMITMENT.PAYMENT_SOURCE_ID = PAYMENT_SOURCE.PAYMENT_SOURCE_ID
	LEFT JOIN ADDRESS COMMITMENT_PAYMENT_ADDRESS ON COMMITMENT.ADDRESS_ID = COMMITMENT_PAYMENT_ADDRESS.ADDRESS_ID
	LEFT JOIN PHONE COMMITMENT_PAYMENT_PHONE ON COMMITMENT.PHONE_ID = COMMITMENT_PAYMENT_PHONE.PHONE_ID
	LEFT JOIN EMAIL COMMITMENT_ACKNOWLEDGEMENT_EMAIL ON COMMITMENT.EMAIL_ID = COMMITMENT_ACKNOWLEDGEMENT_EMAIL.EMAIL_ID
	LEFT JOIN DISTRO_LINE ON COMMITMENT.COMMITMENT_ID = DISTRO_LINE.COMMITMENT_ID
	WHERE COMMITMENT.COMMITMENT_TYPE = 'RECURRING_GIFT'
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Transactions');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Recurring Gifts & Distributions', 0, 'VW_RECURRINGGIFTS_DISTRIBUTIONS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();

-- ***********************************************************************
-- Recurring Gift Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Recurring Gift Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Recurring Gift ID
CALL INSERTREPORTFIELD('COMMITMENT_COMMITMENT_ID', 'Recurring Gift ID', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('COMMITMENT_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(COMMITMENT_PERSON_ID)', 'Account Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Auto Pay
CALL INSERTREPORTFIELD('COMMITMENT_AUTO_PAY', 'Auto Pay', b'0', 6, @REPORTFIELDGROUP_ID);

-- Amount Per Gift
CALL INSERTREPORTFIELD('COMMITMENT_AMOUNT_PER_GIFT', 'Amount Per Gift', b'1', 5, @REPORTFIELDGROUP_ID);

-- Amount Total
CALL INSERTREPORTFIELD('COMMITMENT_AMOUNT_TOTAL', 'Amount Total', b'1', 5, @REPORTFIELDGROUP_ID);

-- Currency Code
CALL INSERTREPORTFIELD('COMMITMENT_CURRENCY_CODE', 'Currency Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Frequency
CALL INSERTREPORTFIELD('COMMITMENT_FREQUENCY', 'Frequency', b'0', 1, @REPORTFIELDGROUP_ID);

-- Start Date
CALL INSERTREPORTFIELD('COMMITMENT_START_DATE', 'Start Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- End Date
CALL INSERTREPORTFIELD('COMMITMENT_END_DATE', 'End Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Status
CALL INSERTREPORTFIELD('COMMITMENT_STATUS', 'Status', b'0', 1, @REPORTFIELDGROUP_ID);

-- Reference Account Number
CALL INSERTREPORTFIELD('GETCOMMITMENTCUSTOMFIELD(COMMITMENT_COMMITMENT_ID, ''reference'')', 'Reference Account Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Reference Account Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETCOMMITMENTCUSTOMFIELD(COMMITMENT_COMMITMENT_ID, ''reference''))', 'Reference Account Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Comments
CALL INSERTREPORTFIELD('COMMITMENT_COMMENTS', 'Comments', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Entry Date
CALL INSERTREPORTFIELD('COMMITMENT_LAST_ENTRY_DATE', 'Last Entry Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Recurring Gift Create Date
CALL INSERTREPORTFIELD('COMMITMENT_CREATE_DATE', 'Recurring Gift Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Recurring Gift Update Date
CALL INSERTREPORTFIELD('COMMITMENT_UPDATE_DATE', 'Recurring Gift Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Payment Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Payment Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Payment Profile Description
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_PAYMENT_PROFILE_DESCRIPTION', 'Payment Profile Description', b'0', 1, @REPORTFIELDGROUP_ID);

-- Payment Method
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_PAYMENT_TYPE', 'Payment Method', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Type
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_TYPE', 'Credit Card Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Holder Name
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_HOLDER_NAME', 'Credit Card Holder Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Expiration
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION', 'Credit Card Expiration', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Expiration (Date / Time)
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION_DATE', 'Credit Card Expiration (Date / Time)', b'0', 4, @REPORTFIELDGROUP_ID);

-- ACH Holder Name
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_ACH_HOLDER_NAME', 'ACH Holder Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ACH Routing Number
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_ACH_ROUTING_NUMBER', 'ACH Routing Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Check Number
CALL INSERTREPORTFIELD('COMMITMENT_CHECK_NUMBER', 'Check Number', b'0', 2, @REPORTFIELDGROUP_ID);

-- Address Line 1
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_ADDRESS_LINE_1', 'Address Line 1', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 2
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_ADDRESS_LINE_2', 'Address Line 2', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 3
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_ADDRESS_LINE_3', 'Address Line 3', b'0', 1, @REPORTFIELDGROUP_ID);

-- City
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_CITY', 'City', b'0', 1, @REPORTFIELDGROUP_ID);

-- State/Province
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_STATE_PROVINCE', 'State/Province', b'0', 1, @REPORTFIELDGROUP_ID);

-- Zip/Postal Code
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_POSTAL_CODE', 'Zip/Postal Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Country
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_COUNTRY', 'Country', b'0', 1, @REPORTFIELDGROUP_ID);

-- Phone Number
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_PHONE_NUMBER', 'Phone Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Acknowledgment Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Acknowledgment Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Receipt Email
CALL INSERTREPORTFIELD('COMMITMENT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS', 'Receipt Email', b'0', 1, @REPORTFIELDGROUP_ID);

-- Send Acknowledgment
CALL INSERTREPORTFIELD('COMMITMENT_SEND_ACKNOWLEDGMENT', 'Send Acknowledgment', b'0', 6, @REPORTFIELDGROUP_ID);

-- Acknowledgment Date
CALL INSERTREPORTFIELD('COMMITMENT_ACKNOWLEDGMENT_DATE', 'Acknowledgment Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Gift Distribution Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Recurring Gift Distribution', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Gift Distribution Reference Number
CALL INSERTREPORTFIELD('DISTRO_LINE_DISTRO_LINE_ID', 'Gift Distribution Reference Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Gift Distribution Amount
CALL INSERTREPORTFIELD('DISTRO_LINE_AMOUNT', 'Gift Distribution Amount', b'1', 5, @REPORTFIELDGROUP_ID);

-- Percentage
CALL INSERTREPORTFIELD('DISTRO_LINE_PERCENTAGE', 'Percentage', b'0', 5, @REPORTFIELDGROUP_ID);

-- Designation
CALL INSERTREPORTFIELD('DISTRO_LINE_PROJECT_CODE', 'Designation', b'0', 1, @REPORTFIELDGROUP_ID);

-- Motivation
CALL INSERTREPORTFIELD('DISTRO_LINE_MOTIVATION_CODE', 'Motivation', b'0', 1, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Constituents & Gifts View & Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_CONSTITUENTS_GIFTS;
CREATE VIEW VW_CONSTITUENTS_GIFTS
AS
	SELECT
		PERSON_PERSON_ID,
		PERSON_CONSTITUENT_ROLES,
		PERSON_CONSTITUENT_ROLE,
		PERSON_CONSTITUENT_TYPE,
		PERSON_CREATE_DATE,
		PERSON_FIRST_NAME,
		PERSON_LAPSED_DONOR,
		PERSON_LAST_NAME,
		PERSON_LEGAL_NAME,
		PERSON_LOGIN_ID,
		PERSON_MAJOR_DONOR,
		PERSON_MARITAL_STATUS,
		PERSON_MIDDLE_NAME,
		PERSON_NCAIS_CODE,
		PERSON_ORGANIZATION_NAME,
		PERSON_PREFERRED_PHONE_TYPE,
		PERSON_RECOGNITION_NAME,
		PERSON_SUFFIX,
		PERSON_TITLE,
		PERSON_UPDATE_DATE,
		PERSON_SITE_NAME,

		-- Gift Information
		GIFT_PERSON_ID,
		GIFT_GIFT_ID,
		GIFT_AMOUNT,
		GIFT_CURRENCY_CODE,
		GIFT_DONATION_DATE,
		GIFT_POSTMARK_DATE,
		GIFT_COMMENTS,
		GIFT_TRANSACTIONDATE,
		GIFT_PAYMENT_SOURCE_PAYMENT_PROFILE_DESCRIPTION,
		GIFT_PAYMENT_SOURCE_PAYMENT_TYPE,
		GIFT_PAYMENT_SOURCE_CREDIT_CARD_TYPE,
		GIFT_PAYMENT_SOURCE_CREDIT_CARD_HOLDER_NAME,
		GIFT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION,
		GIFT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION_DATE,
		GIFT_PAYMENT_SOURCE_ACH_HOLDER_NAME,
		GIFT_PAYMENT_SOURCE_ACH_ROUTING_NUMBER,
		GIFT_CHECK_NUMBER,
		GIFT_AUTH_CODE,
		GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_1,
		GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_2,
		GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_3,
		GIFT_PAYMENT_ADDRESS_CITY,
		GIFT_PAYMENT_ADDRESS_STATE_PROVINCE,
		GIFT_PAYMENT_ADDRESS_POSTAL_CODE,
		GIFT_PAYMENT_ADDRESS_COUNTRY,
		GIFT_PAYMENT_PHONE_NUMBER,
		GIFT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS,
		GIFT_SEND_ACKNOWLEDGMENT,
		GIFT_ACKNOWLEDGMENT_DATE
	FROM VW_CONSTITUENTS
	LEFT JOIN VW_GIFTS ON PERSON_PERSON_ID = GIFT_PERSON_ID
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Constituents & Transactions');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Constituents & Gifts', 0, 'VW_CONSTITUENTS_GIFTS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();


-- ***********************************************************************
-- Contact Details Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Contact Details', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('PERSON_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Manager Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager''))', 'Account Manager Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Account Manager Account Number
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager'')', 'Account Manager Account Number', b'0', 3, @REPORTFIELDGROUP_ID);

-- Constituent Type
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_TYPE', 'Constituent Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLES', 'Profile Types', b'0', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLE', 'Profile Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Title
CALL INSERTREPORTFIELD('PERSON_TITLE', 'Title', b'0', 1, @REPORTFIELDGROUP_ID);

-- First Name
CALL INSERTREPORTFIELD('PERSON_FIRST_NAME', 'First Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Middle Name
CALL INSERTREPORTFIELD('PERSON_MIDDLE_NAME', 'Middle Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Name
CALL INSERTREPORTFIELD('PERSON_LAST_NAME', 'Last Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Suffix
CALL INSERTREPORTFIELD('PERSON_SUFFIX', 'Suffix', b'0', 1, @REPORTFIELDGROUP_ID);

-- Recognition Name
CALL INSERTREPORTFIELD('PERSON_RECOGNITION_NAME', 'Recognition Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Organization Name
CALL INSERTREPORTFIELD('PERSON_ORGANIZATION_NAME', 'Organization Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Legal Name
CALL INSERTREPORTFIELD('PERSON_LEGAL_NAME', 'Legal Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.matching'')', 'Matching', b'0', 1, @REPORTFIELDGROUP_ID);

-- Percent Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.percentMatch'')', 'Percent Matching', b'0', 3, @REPORTFIELDGROUP_ID);

-- Maximum Match
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.maximumMatch'')', 'Maximum Match', b'0', 5, @REPORTFIELDGROUP_ID);

-- Website
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.website'')', 'Website', b'0', 1, @REPORTFIELDGROUP_ID);

-- Tax ID
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.taxid'')', 'Tax ID', b'0', 1, @REPORTFIELDGROUP_ID);

-- NCAIS Code
CALL INSERTREPORTFIELD('PERSON_NCAIS_CODE', 'NCAIS Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Communication Preferences
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''communicationPreferences'')', 'Communication Preferences', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Format
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''emailFormat'')', 'Email Format', b'0', 1, @REPORTFIELDGROUP_ID);

-- Create Date
CALL INSERTREPORTFIELD('PERSON_CREATE_DATE', 'Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Update Date
CALL INSERTREPORTFIELD('PERSON_UPDATE_DATE', 'Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Demographic Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Demographic Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Marital Status
CALL INSERTREPORTFIELD('PERSON_MARITAL_STATUS', 'Marital Status', b'0', 3, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.birthDate'')', 'Birth Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Deceased
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.deceased'')', 'Deceased', b'0', 6, @REPORTFIELDGROUP_ID);

-- Gender
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.gender'')', 'Gender', b'0', 1, @REPORTFIELDGROUP_ID);

-- Race
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.race'')', 'Race', b'0', 1, @REPORTFIELDGROUP_ID);

-- Military
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.military'')', 'Military', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Miscellaneous Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Miscellaneous Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Major Donor
CALL INSERTREPORTFIELD('PERSON_MAJOR_DONOR', 'Major Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Lapsed Donor
CALL INSERTREPORTFIELD('PERSON_LAPSED_DONOR', 'Lapsed Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('PERSON_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Gift Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Gift Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Gift Reference Number
CALL INSERTREPORTFIELD('GIFT_GIFT_ID', 'Gift Reference Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Gift Amount
CALL INSERTREPORTFIELD('GIFT_AMOUNT', 'Gift Amount', b'1', 5, @REPORTFIELDGROUP_ID);

-- Currency Code
CALL INSERTREPORTFIELD('GIFT_CURRENCY_CODE', 'Currency Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Donation Date
CALL INSERTREPORTFIELD('GIFT_DONATION_DATE', 'Donation Date', b'1', 4, @REPORTFIELDGROUP_ID);

-- Postmark Date
CALL INSERTREPORTFIELD('GIFT_POSTMARK_DATE', 'Postmark Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Reference Account Number
CALL INSERTREPORTFIELD('GETGIFTCUSTOMFIELD(GIFT_GIFT_ID, ''reference'')', 'Reference Account Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Reference Account Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETGIFTCUSTOMFIELD(GIFT_GIFT_ID, ''reference''))', 'Reference Account Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Comments
CALL INSERTREPORTFIELD('GIFT_COMMENTS', 'Comments', b'0', 1, @REPORTFIELDGROUP_ID);

-- Transaction Date
CALL INSERTREPORTFIELD('GIFT_TRANSACTIONDATE', 'Transaction Date', b'0', 4, @REPORTFIELDGROUP_ID);


-- ***********************************************************************
-- Payment Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Payment Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Payment Profile Description
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_PAYMENT_PROFILE_DESCRIPTION', 'Payment Profile Description', b'0', 1, @REPORTFIELDGROUP_ID);

-- Payment Method
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_PAYMENT_TYPE', 'Payment Method', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Type
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_CREDIT_CARD_TYPE', 'Credit Card Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Holder Name
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_CREDIT_CARD_HOLDER_NAME', 'Credit Card Holder Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Expiration
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION', 'Credit Card Expiration', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Expiration (Date / Time)
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION_DATE', 'Credit Card Expiration (Date / Time)', b'0', 4, @REPORTFIELDGROUP_ID);

-- ACH Holder Name
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_ACH_HOLDER_NAME', 'ACH Holder Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ACH Routing Number
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_ACH_ROUTING_NUMBER', 'ACH Routing Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Check Number
CALL INSERTREPORTFIELD('GIFT_CHECK_NUMBER', 'Check Number', b'0', 2, @REPORTFIELDGROUP_ID);

-- Authorization Code
CALL INSERTREPORTFIELD('GIFT_AUTH_CODE', 'Authorization Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 1
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_1', 'Address Line 1', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 2
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_2', 'Address Line 2', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 3
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_3', 'Address Line 2', b'0', 1, @REPORTFIELDGROUP_ID);

-- City
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_CITY', 'City', b'0', 1, @REPORTFIELDGROUP_ID);

-- State/Province
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_STATE_PROVINCE', 'State/Province', b'0', 1, @REPORTFIELDGROUP_ID);

-- Zip/Postal Code
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_POSTAL_CODE', 'Zip/Postal Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Country
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_COUNTRY', 'Country', b'0', 1, @REPORTFIELDGROUP_ID);

-- Phone Number
CALL INSERTREPORTFIELD('GIFT_PAYMENT_PHONE_NUMBER', 'Phone Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Acknowledgment Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Acknowledgment Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Receipt Email
CALL INSERTREPORTFIELD('GIFT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS', 'Receipt Email', b'0', 1, @REPORTFIELDGROUP_ID);

-- Send Acknowledgment
CALL INSERTREPORTFIELD('GIFT_SEND_ACKNOWLEDGMENT', 'Send Acknowledgment', b'0', 6, @REPORTFIELDGROUP_ID);

-- Acknowledgment Date
CALL INSERTREPORTFIELD('GIFT_ACKNOWLEDGMENT_DATE', 'Acknowledgment Date', b'0', 4, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Constituents & Gift Distributions View & Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_CONSTITUENTS_GIFTDISTRIBUTIONS;
CREATE VIEW VW_CONSTITUENTS_GIFTDISTRIBUTIONS
AS
	SELECT
		PERSON_PERSON_ID,
		PERSON_CONSTITUENT_ROLES,
		PERSON_CONSTITUENT_ROLE,
		PERSON_CONSTITUENT_TYPE,
		PERSON_CREATE_DATE,
		PERSON_FIRST_NAME,
		PERSON_LAPSED_DONOR,
		PERSON_LAST_NAME,
		PERSON_LEGAL_NAME,
		PERSON_LOGIN_ID,
		PERSON_MAJOR_DONOR,
		PERSON_MARITAL_STATUS,
		PERSON_MIDDLE_NAME,
		PERSON_NCAIS_CODE,
		PERSON_ORGANIZATION_NAME,
		PERSON_PREFERRED_PHONE_TYPE,
		PERSON_RECOGNITION_NAME,
		PERSON_SUFFIX,
		PERSON_TITLE,
		PERSON_UPDATE_DATE,
		PERSON_SITE_NAME,

		-- Gift Information
		GIFT_GIFT_ID,
		GIFT_AMOUNT,
		GIFT_CURRENCY_CODE,
		GIFT_DONATION_DATE,
		GIFT_POSTMARK_DATE,
		GIFT_COMMENTS,
		GIFT_TRANSACTIONDATE,
		GIFT_PAYMENT_SOURCE_PAYMENT_PROFILE_DESCRIPTION,
		GIFT_PAYMENT_SOURCE_PAYMENT_TYPE,
		GIFT_PAYMENT_SOURCE_CREDIT_CARD_TYPE,
		GIFT_PAYMENT_SOURCE_CREDIT_CARD_HOLDER_NAME,
		GIFT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION,
		GIFT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION_DATE,
		GIFT_PAYMENT_SOURCE_ACH_HOLDER_NAME,
		GIFT_PAYMENT_SOURCE_ACH_ROUTING_NUMBER,
		GIFT_CHECK_NUMBER,
		GIFT_AUTH_CODE,
		GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_1,
		GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_2,
		GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_3,
		GIFT_PAYMENT_ADDRESS_CITY,
		GIFT_PAYMENT_ADDRESS_STATE_PROVINCE,
		GIFT_PAYMENT_ADDRESS_POSTAL_CODE,
		GIFT_PAYMENT_ADDRESS_COUNTRY,
		GIFT_PAYMENT_PHONE_NUMBER,
		GIFT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS,
		GIFT_SEND_ACKNOWLEDGMENT,
		GIFT_ACKNOWLEDGMENT_DATE,
		DISTRO_LINE_DISTRO_LINE_ID,
		DISTRO_LINE_AMOUNT,
		DISTRO_LINE_PERCENTAGE,
		DISTRO_LINE_PROJECT_CODE,
		DISTRO_LINE_MOTIVATION_CODE
	FROM VW_CONSTITUENTS
	LEFT JOIN VW_GIFTS_DISTRIBUTIONS ON PERSON_PERSON_ID = GIFT_PERSON_ID
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Constituents & Transactions');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Constituents & Gift Distributions', 0, 'VW_CONSTITUENTS_GIFTDISTRIBUTIONS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();


-- ***********************************************************************
-- Contact Details Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Contact Details', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('PERSON_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Manager Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager''))', 'Account Manager Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Account Manager Account Number
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager'')', 'Account Manager Account Number', b'0', 3, @REPORTFIELDGROUP_ID);

-- Constituent Type
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_TYPE', 'Constituent Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLES', 'Profile Types', b'0', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLE', 'Profile Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Title
CALL INSERTREPORTFIELD('PERSON_TITLE', 'Title', b'0', 1, @REPORTFIELDGROUP_ID);

-- First Name
CALL INSERTREPORTFIELD('PERSON_FIRST_NAME', 'First Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Middle Name
CALL INSERTREPORTFIELD('PERSON_MIDDLE_NAME', 'Middle Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Name
CALL INSERTREPORTFIELD('PERSON_LAST_NAME', 'Last Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Suffix
CALL INSERTREPORTFIELD('PERSON_SUFFIX', 'Suffix', b'0', 1, @REPORTFIELDGROUP_ID);

-- Recognition Name
CALL INSERTREPORTFIELD('PERSON_RECOGNITION_NAME', 'Recognition Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Organization Name
CALL INSERTREPORTFIELD('PERSON_ORGANIZATION_NAME', 'Organization Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Legal Name
CALL INSERTREPORTFIELD('PERSON_LEGAL_NAME', 'Legal Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.matching'')', 'Matching', b'0', 1, @REPORTFIELDGROUP_ID);

-- Percent Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.percentMatch'')', 'Percent Matching', b'0', 3, @REPORTFIELDGROUP_ID);

-- Maximum Match
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.maximumMatch'')', 'Maximum Match', b'0', 5, @REPORTFIELDGROUP_ID);

-- Website
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.website'')', 'Website', b'0', 1, @REPORTFIELDGROUP_ID);

-- Tax ID
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.taxid'')', 'Tax ID', b'0', 1, @REPORTFIELDGROUP_ID);

-- NCAIS Code
CALL INSERTREPORTFIELD('PERSON_NCAIS_CODE', 'NCAIS Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Communication Preferences
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''communicationPreferences'')', 'Communication Preferences', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Format
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''emailFormat'')', 'Email Format', b'0', 1, @REPORTFIELDGROUP_ID);

-- Create Date
CALL INSERTREPORTFIELD('PERSON_CREATE_DATE', 'Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Update Date
CALL INSERTREPORTFIELD('PERSON_UPDATE_DATE', 'Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Demographic Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Demographic Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Marital Status
CALL INSERTREPORTFIELD('PERSON_MARITAL_STATUS', 'Marital Status', b'0', 3, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.birthDate'')', 'Birth Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Deceased
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.deceased'')', 'Deceased', b'0', 6, @REPORTFIELDGROUP_ID);

-- Gender
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.gender'')', 'Gender', b'0', 1, @REPORTFIELDGROUP_ID);

-- Race
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.race'')', 'Race', b'0', 1, @REPORTFIELDGROUP_ID);

-- Military
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.military'')', 'Military', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Miscellaneous Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Miscellaneous Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Major Donor
CALL INSERTREPORTFIELD('PERSON_MAJOR_DONOR', 'Major Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Lapsed Donor
CALL INSERTREPORTFIELD('PERSON_LAPSED_DONOR', 'Lapsed Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('PERSON_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);


-- ***********************************************************************
-- Gift Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Gift Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Gift Reference Number
CALL INSERTREPORTFIELD('GIFT_GIFT_ID', 'Gift Reference Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Gift Amount
CALL INSERTREPORTFIELD('GIFT_AMOUNT', 'Gift Amount', b'1', 5, @REPORTFIELDGROUP_ID);

-- Currency Code
CALL INSERTREPORTFIELD('GIFT_CURRENCY_CODE', 'Currency Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Donation Date
CALL INSERTREPORTFIELD('GIFT_DONATION_DATE', 'Donation Date', b'1', 4, @REPORTFIELDGROUP_ID);

-- Postmark Date
CALL INSERTREPORTFIELD('GIFT_POSTMARK_DATE', 'Postmark Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Reference Account Number
CALL INSERTREPORTFIELD('GETGIFTCUSTOMFIELD(GIFT_GIFT_ID, ''reference'')', 'Reference Account Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Reference Account Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETGIFTCUSTOMFIELD(GIFT_GIFT_ID, ''reference''))', 'Reference Account Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Comments
CALL INSERTREPORTFIELD('GIFT_COMMENTS', 'Comments', b'0', 1, @REPORTFIELDGROUP_ID);

-- Transaction Date
CALL INSERTREPORTFIELD('GIFT_TRANSACTIONDATE', 'Transaction Date', b'0', 4, @REPORTFIELDGROUP_ID);


-- ***********************************************************************
-- Payment Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Payment Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Payment Profile Description
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_PAYMENT_PROFILE_DESCRIPTION', 'Payment Profile Description', b'0', 1, @REPORTFIELDGROUP_ID);

-- Payment Method
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_PAYMENT_TYPE', 'Payment Method', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Type
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_CREDIT_CARD_TYPE', 'Credit Card Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Holder Name
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_CREDIT_CARD_HOLDER_NAME', 'Credit Card Holder Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Expiration
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION', 'Credit Card Expiration', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Expiration (Date / Time)
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION_DATE', 'Credit Card Expiration (Date / Time)', b'0', 4, @REPORTFIELDGROUP_ID);

-- ACH Holder Name
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_ACH_HOLDER_NAME', 'ACH Holder Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ACH Routing Number
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_ACH_ROUTING_NUMBER', 'ACH Routing Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Check Number
CALL INSERTREPORTFIELD('GIFT_CHECK_NUMBER', 'Check Number', b'0', 2, @REPORTFIELDGROUP_ID);

-- Authorization Code
CALL INSERTREPORTFIELD('GIFT_AUTH_CODE', 'Authorization Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 1
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_1', 'Address Line 1', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 2
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_2', 'Address Line 2', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 3
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_3', 'Address Line 2', b'0', 1, @REPORTFIELDGROUP_ID);

-- City
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_CITY', 'City', b'0', 1, @REPORTFIELDGROUP_ID);

-- State/Province
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_STATE_PROVINCE', 'State/Province', b'0', 1, @REPORTFIELDGROUP_ID);

-- Zip/Postal Code
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_POSTAL_CODE', 'Zip/Postal Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Country
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_COUNTRY', 'Country', b'0', 1, @REPORTFIELDGROUP_ID);

-- Phone Number
CALL INSERTREPORTFIELD('GIFT_PAYMENT_PHONE_NUMBER', 'Phone Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Acknowledgment Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Acknowledgment Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Receipt Email
CALL INSERTREPORTFIELD('GIFT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS', 'Receipt Email', b'0', 1, @REPORTFIELDGROUP_ID);

-- Send Acknowledgment
CALL INSERTREPORTFIELD('GIFT_SEND_ACKNOWLEDGMENT', 'Send Acknowledgment', b'0', 6, @REPORTFIELDGROUP_ID);

-- Acknowledgment Date
CALL INSERTREPORTFIELD('GIFT_ACKNOWLEDGMENT_DATE', 'Acknowledgment Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Gift Distribution Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Gift Distribution', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Gift Distribution Reference Number
CALL INSERTREPORTFIELD('DISTRO_LINE_DISTRO_LINE_ID', 'Gift Distribution Reference Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Gift Distribution Amount
CALL INSERTREPORTFIELD('DISTRO_LINE_AMOUNT', 'Gift Distribution Amount', b'1', 5, @REPORTFIELDGROUP_ID);

-- Percentage
CALL INSERTREPORTFIELD('DISTRO_LINE_PERCENTAGE', 'Percentage', b'0', 5, @REPORTFIELDGROUP_ID);

-- Designation
CALL INSERTREPORTFIELD('DISTRO_LINE_PROJECT_CODE', 'Designation', b'0', 1, @REPORTFIELDGROUP_ID);

-- Motivation
CALL INSERTREPORTFIELD('DISTRO_LINE_MOTIVATION_CODE', 'Motivation', b'0', 1, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Constituents & Payment History View & Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_CONSTITUENTS_PAYMENTHISTORY;
CREATE VIEW VW_CONSTITUENTS_PAYMENTHISTORY
AS
	SELECT
		PERSON_PERSON_ID,
		PERSON_CONSTITUENT_ROLES,
		PERSON_CONSTITUENT_ROLE,
		PERSON_CONSTITUENT_TYPE,
		PERSON_CREATE_DATE,
		PERSON_FIRST_NAME,
		PERSON_LAPSED_DONOR,
		PERSON_LAST_NAME,
		PERSON_LEGAL_NAME,
		PERSON_LOGIN_ID,
		PERSON_MAJOR_DONOR,
		PERSON_MARITAL_STATUS,
		PERSON_MIDDLE_NAME,
		PERSON_NCAIS_CODE,
		PERSON_ORGANIZATION_NAME,
		PERSON_PREFERRED_PHONE_TYPE,
		PERSON_RECOGNITION_NAME,
		PERSON_SUFFIX,
		PERSON_TITLE,
		PERSON_UPDATE_DATE,
		PERSON_SITE_NAME,

		PAYMENT_HISTORY_PAYMENT_HISTORY_ID,
		PAYMENT_HISTORY_PERSON_ID,
		PAYMENT_HISTORY_GIFT_ID,
		PAYMENT_HISTORY_TRANSACTION_DATE,
		PAYMENT_HISTORY_PAYMENT_TYPE,
		PAYMENT_HISTORY_AMOUNT,
		PAYMENT_HISTORY_CURRENCY_CODE,
		PAYMENT_HISTORY_PAYMENT_DESC,
		PAYMENT_HISTORY_PAYMENT_HISTORY_TYPE
	FROM VW_CONSTITUENTS
	LEFT JOIN VW_PAYMENTHISTORY ON VW_CONSTITUENTS.PERSON_PERSON_ID = VW_PAYMENTHISTORY.PAYMENT_HISTORY_PERSON_ID
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Constituents & Transactions');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Constituents & Payment History', 0, 'VW_CONSTITUENTS_PAYMENTHISTORY', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();

-- ***********************************************************************
-- Contact Details Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Contact Details', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('PERSON_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Manager Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager''))', 'Account Manager Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Account Manager Account Number
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager'')', 'Account Manager Account Number', b'0', 3, @REPORTFIELDGROUP_ID);

-- Constituent Type
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_TYPE', 'Constituent Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLES', 'Profile Types', b'0', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLE', 'Profile Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Title
CALL INSERTREPORTFIELD('PERSON_TITLE', 'Title', b'0', 1, @REPORTFIELDGROUP_ID);

-- First Name
CALL INSERTREPORTFIELD('PERSON_FIRST_NAME', 'First Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Middle Name
CALL INSERTREPORTFIELD('PERSON_MIDDLE_NAME', 'Middle Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Name
CALL INSERTREPORTFIELD('PERSON_LAST_NAME', 'Last Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Suffix
CALL INSERTREPORTFIELD('PERSON_SUFFIX', 'Suffix', b'0', 1, @REPORTFIELDGROUP_ID);

-- Recognition Name
CALL INSERTREPORTFIELD('PERSON_RECOGNITION_NAME', 'Recognition Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Organization Name
CALL INSERTREPORTFIELD('PERSON_ORGANIZATION_NAME', 'Organization Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Legal Name
CALL INSERTREPORTFIELD('PERSON_LEGAL_NAME', 'Legal Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.matching'')', 'Matching', b'0', 1, @REPORTFIELDGROUP_ID);

-- Percent Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.percentMatch'')', 'Percent Matching', b'0', 3, @REPORTFIELDGROUP_ID);

-- Maximum Match
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.maximumMatch'')', 'Maximum Match', b'0', 5, @REPORTFIELDGROUP_ID);

-- Website
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.website'')', 'Website', b'0', 1, @REPORTFIELDGROUP_ID);

-- Tax ID
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.taxid'')', 'Tax ID', b'0', 1, @REPORTFIELDGROUP_ID);

-- NCAIS Code
CALL INSERTREPORTFIELD('PERSON_NCAIS_CODE', 'NCAIS Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Communication Preferences
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''communicationPreferences'')', 'Communication Preferences', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Format
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''emailFormat'')', 'Email Format', b'0', 1, @REPORTFIELDGROUP_ID);

-- Create Date
CALL INSERTREPORTFIELD('PERSON_CREATE_DATE', 'Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Update Date
CALL INSERTREPORTFIELD('PERSON_UPDATE_DATE', 'Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Demographic Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Demographic Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Marital Status
CALL INSERTREPORTFIELD('PERSON_MARITAL_STATUS', 'Marital Status', b'0', 3, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.birthDate'')', 'Birth Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Deceased
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.deceased'')', 'Deceased', b'0', 6, @REPORTFIELDGROUP_ID);

-- Gender
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.gender'')', 'Gender', b'0', 1, @REPORTFIELDGROUP_ID);

-- Race
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.race'')', 'Race', b'0', 1, @REPORTFIELDGROUP_ID);

-- Military
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.military'')', 'Military', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Miscellaneous Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Miscellaneous Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Major Donor
CALL INSERTREPORTFIELD('PERSON_MAJOR_DONOR', 'Major Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Lapsed Donor
CALL INSERTREPORTFIELD('PERSON_LAPSED_DONOR', 'Lapsed Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('PERSON_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Payment Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Payment History', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Payment History ID
CALL INSERTREPORTFIELD('PAYMENT_HISTORY_PAYMENT_HISTORY_ID', 'Payment History ID', b'0', 3, @REPORTFIELDGROUP_ID);

-- Payment History Type
CALL INSERTREPORTFIELD('PAYMENT_HISTORY_PAYMENT_HISTORY_TYPE', 'Payment History Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Gift ID
CALL INSERTREPORTFIELD('PAYMENT_HISTORY_GIFT_ID', 'Gift ID', b'0', 3, @REPORTFIELDGROUP_ID);

-- Transaction Date
CALL INSERTREPORTFIELD('PAYMENT_HISTORY_TRANSACTION_DATE', 'Transaction Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Payment Method
CALL INSERTREPORTFIELD('PAYMENT_HISTORY_PAYMENT_TYPE', 'Payment Method', b'0', 1, @REPORTFIELDGROUP_ID);

-- Amount
CALL INSERTREPORTFIELD('PAYMENT_HISTORY_AMOUNT', 'Amount', b'0', 5, @REPORTFIELDGROUP_ID);

-- Currency Code
CALL INSERTREPORTFIELD('PAYMENT_HISTORY_CURRENCY_CODE', 'Currency Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Description
CALL INSERTREPORTFIELD('PAYMENT_HISTORY_PAYMENT_DESC', 'Description', b'0', 1, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Constituents & Payment Methods View & Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_CONSTITUENTS_PAYMENTMETHODS;
CREATE VIEW VW_CONSTITUENTS_PAYMENTMETHODS
AS
	SELECT
		PERSON_PERSON_ID,
		PERSON_CONSTITUENT_ROLES,
		PERSON_CONSTITUENT_ROLE,
		PERSON_CONSTITUENT_TYPE,
		PERSON_CREATE_DATE,
		PERSON_FIRST_NAME,
		PERSON_LAPSED_DONOR,
		PERSON_LAST_NAME,
		PERSON_LEGAL_NAME,
		PERSON_LOGIN_ID,
		PERSON_MAJOR_DONOR,
		PERSON_MARITAL_STATUS,
		PERSON_MIDDLE_NAME,
		PERSON_NCAIS_CODE,
		PERSON_ORGANIZATION_NAME,
		PERSON_PREFERRED_PHONE_TYPE,
		PERSON_RECOGNITION_NAME,
		PERSON_SUFFIX,
		PERSON_TITLE,
		PERSON_UPDATE_DATE,
		PERSON_SITE_NAME,
		-- Payment Information
		PAYMENT_SOURCE.PAYMENT_SOURCE_ID AS PAYMENT_SOURCE_PAYMENT_SOURCE_ID,
		PAYMENT_SOURCE.PERSON_ID AS PAYMENT_SOURCE_PERSON_ID,
		PAYMENT_SOURCE.PAYMENT_PROFILE AS GIFT_PAYMENT_SOURCE_PAYMENT_PROFILE_DESCRIPTION,
		PAYMENT_SOURCE.PAYMENT_TYPE AS GIFT_PAYMENT_SOURCE_PAYMENT_TYPE,
		PAYMENT_SOURCE.CREDIT_CARD_HOLDER_NAME AS GIFT_PAYMENT_SOURCE_CREDIT_CARD_HOLDER_NAME,
		PAYMENT_SOURCE.CREDIT_CARD_TYPE AS GIFT_PAYMENT_SOURCE_CREDIT_CARD_TYPE,
		CONCAT(MONTH(PAYMENT_SOURCE.CREDIT_CARD_EXPIRATION), '/', YEAR(PAYMENT_SOURCE.CREDIT_CARD_EXPIRATION)) AS GIFT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION,
		PAYMENT_SOURCE.CREDIT_CARD_EXPIRATION AS GIFT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION_DATE,
		PAYMENT_SOURCE.ACH_HOLDER_NAME AS GIFT_PAYMENT_SOURCE_ACH_HOLDER_NAME,
		CONCAT('****', RIGHT(PAYMENT_SOURCE.ACH_ROUTING_NUMBER, 4)) AS GIFT_PAYMENT_SOURCE_ACH_ROUTING_NUMBER,
			-- Payment Address
		PAYMENTMETHOD_ADDRESS.ADDRESS_LINE_1 AS GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_1,
		PAYMENTMETHOD_ADDRESS.ADDRESS_LINE_2 AS GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_2,
		PAYMENTMETHOD_ADDRESS.ADDRESS_LINE_3 AS GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_3,
		PAYMENTMETHOD_ADDRESS.CITY AS GIFT_PAYMENT_ADDRESS_CITY,
		PAYMENTMETHOD_ADDRESS.STATE_PROVINCE AS GIFT_PAYMENT_ADDRESS_STATE_PROVINCE,
		PAYMENTMETHOD_ADDRESS.POSTAL_CODE AS GIFT_PAYMENT_ADDRESS_POSTAL_CODE,
		PAYMENTMETHOD_ADDRESS.COUNTRY AS GIFT_PAYMENT_ADDRESS_COUNTRY,
			-- Payment Phone
		PAYMENTMETHOD_PHONE.NUMBER AS GIFT_PAYMENT_PHONE_NUMBER
	FROM VW_CONSTITUENTS
	LEFT JOIN PAYMENT_SOURCE ON VW_CONSTITUENTS.PERSON_PERSON_ID = PAYMENT_SOURCE.PERSON_ID
	LEFT JOIN ADDRESS PAYMENTMETHOD_ADDRESS ON PAYMENT_SOURCE.ADDRESS_ID = PAYMENTMETHOD_ADDRESS.ADDRESS_ID
	LEFT JOIN PHONE PAYMENTMETHOD_PHONE ON PAYMENT_SOURCE.PHONE_ID = PAYMENTMETHOD_PHONE.PHONE_ID
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Constituents & Transactions');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Constituents & Payment Methods', 0, 'VW_CONSTITUENTS_PAYMENTMETHODS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();

-- ***********************************************************************
-- Contact Details Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Contact Details', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('PERSON_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Manager Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager''))', 'Account Manager Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Account Manager Account Number
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager'')', 'Account Manager Account Number', b'0', 3, @REPORTFIELDGROUP_ID);

-- Constituent Type
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_TYPE', 'Constituent Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLES', 'Profile Types', b'0', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLE', 'Profile Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Title
CALL INSERTREPORTFIELD('PERSON_TITLE', 'Title', b'0', 1, @REPORTFIELDGROUP_ID);

-- First Name
CALL INSERTREPORTFIELD('PERSON_FIRST_NAME', 'First Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Middle Name
CALL INSERTREPORTFIELD('PERSON_MIDDLE_NAME', 'Middle Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Name
CALL INSERTREPORTFIELD('PERSON_LAST_NAME', 'Last Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Suffix
CALL INSERTREPORTFIELD('PERSON_SUFFIX', 'Suffix', b'0', 1, @REPORTFIELDGROUP_ID);

-- Recognition Name
CALL INSERTREPORTFIELD('PERSON_RECOGNITION_NAME', 'Recognition Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Organization Name
CALL INSERTREPORTFIELD('PERSON_ORGANIZATION_NAME', 'Organization Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Legal Name
CALL INSERTREPORTFIELD('PERSON_LEGAL_NAME', 'Legal Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.matching'')', 'Matching', b'0', 1, @REPORTFIELDGROUP_ID);

-- Percent Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.percentMatch'')', 'Percent Matching', b'0', 3, @REPORTFIELDGROUP_ID);

-- Maximum Match
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.maximumMatch'')', 'Maximum Match', b'0', 5, @REPORTFIELDGROUP_ID);

-- Website
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.website'')', 'Website', b'0', 1, @REPORTFIELDGROUP_ID);

-- Tax ID
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.taxid'')', 'Tax ID', b'0', 1, @REPORTFIELDGROUP_ID);

-- NCAIS Code
CALL INSERTREPORTFIELD('PERSON_NCAIS_CODE', 'NCAIS Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Communication Preferences
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''communicationPreferences'')', 'Communication Preferences', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Format
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''emailFormat'')', 'Email Format', b'0', 1, @REPORTFIELDGROUP_ID);

-- Create Date
CALL INSERTREPORTFIELD('PERSON_CREATE_DATE', 'Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Update Date
CALL INSERTREPORTFIELD('PERSON_UPDATE_DATE', 'Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Demographic Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Demographic Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Marital Status
CALL INSERTREPORTFIELD('PERSON_MARITAL_STATUS', 'Marital Status', b'0', 3, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.birthDate'')', 'Birth Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Deceased
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.deceased'')', 'Deceased', b'0', 6, @REPORTFIELDGROUP_ID);

-- Gender
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.gender'')', 'Gender', b'0', 1, @REPORTFIELDGROUP_ID);

-- Race
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.race'')', 'Race', b'0', 1, @REPORTFIELDGROUP_ID);

-- Military
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.military'')', 'Military', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Miscellaneous Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Miscellaneous Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Major Donor
CALL INSERTREPORTFIELD('PERSON_MAJOR_DONOR', 'Major Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Lapsed Donor
CALL INSERTREPORTFIELD('PERSON_LAPSED_DONOR', 'Lapsed Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('PERSON_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Payment Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Payment Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Payment Method ID
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_PAYMENT_SOURCE_ID', 'Payment Method ID', b'1', 3, @REPORTFIELDGROUP_ID);

-- Payment Profile Description
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_PAYMENT_PROFILE_DESCRIPTION', 'Payment Profile Description', b'1', 1, @REPORTFIELDGROUP_ID);

-- Payment Method
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_PAYMENT_TYPE', 'Payment Method', b'1', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Holder Name
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_CREDIT_CARD_HOLDER_NAME', 'Credit Card Holder Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Type
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_CREDIT_CARD_TYPE', 'Credit Card Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Expiration
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION', 'Credit Card Expiration', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Expiration (Date / Time)
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION_DATE', 'Credit Card Expiration (Date / Time)', b'0', 4, @REPORTFIELDGROUP_ID);

-- ACH Holder Name
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_ACH_HOLDER_NAME', 'ACH Holder Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ACH Routing Number
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_ACH_ROUTING_NUMBER', 'ACH Routing Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Default Address/Phone Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Default Address/Phone Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Address Line 1
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_1', 'Address Line 1', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 2
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_2', 'Address Line 2', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 3
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_3', 'Address Line 3', b'0', 1, @REPORTFIELDGROUP_ID);

-- City
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_CITY', 'City', b'0', 1, @REPORTFIELDGROUP_ID);

-- State/Province
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_STATE_PROVINCE', 'State/Province', b'0', 1, @REPORTFIELDGROUP_ID);

-- Zip/Postal Code
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_POSTAL_CODE', 'Zip/Postal Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Country
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_COUNTRY', 'Country', b'0', 1, @REPORTFIELDGROUP_ID);

-- Phone Number
CALL INSERTREPORTFIELD('GIFT_PAYMENT_PHONE_NUMBER', 'Phone Number', b'0', 1, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Constituents & Pledges View & Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_CONSTITUENTS_PLEDGES;
CREATE VIEW VW_CONSTITUENTS_PLEDGES
AS
	SELECT
		PERSON_PERSON_ID,
		PERSON_CONSTITUENT_ROLES,
		PERSON_CONSTITUENT_ROLE,
		PERSON_CONSTITUENT_TYPE,
		PERSON_CREATE_DATE,
		PERSON_FIRST_NAME,
		PERSON_LAPSED_DONOR,
		PERSON_LAST_NAME,
		PERSON_LEGAL_NAME,
		PERSON_LOGIN_ID,
		PERSON_MAJOR_DONOR,
		PERSON_MARITAL_STATUS,
		PERSON_MIDDLE_NAME,
		PERSON_NCAIS_CODE,
		PERSON_ORGANIZATION_NAME,
		PERSON_PREFERRED_PHONE_TYPE,
		PERSON_RECOGNITION_NAME,
		PERSON_SUFFIX,
		PERSON_TITLE,
		PERSON_UPDATE_DATE,
		PERSON_SITE_NAME,

		COMMITMENT_PERSON_ID,
		COMMITMENT_COMMITMENT_ID,
		COMMITMENT_RECURRING,
		COMMITMENT_AMOUNT_PER_GIFT,
		COMMITMENT_AMOUNT_TOTAL,
		COMMITMENT_CURRENCY_CODE,
		COMMITMENT_STATUS,
		COMMITMENT_FREQUENCY,
		COMMITMENT_PLEDGE_DATE,
		COMMITMENT_PROJECTED_DATE,
		COMMITMENT_START_DATE,
		COMMITMENT_END_DATE,
		COMMITMENT_COMMENTS,
		COMMITMENT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS,
		COMMITMENT_SEND_ACKNOWLEDGMENT,
		COMMITMENT_ACKNOWLEDGMENT_DATE
	FROM VW_CONSTITUENTS
	LEFT JOIN VW_PLEDGES ON VW_CONSTITUENTS.PERSON_PERSON_ID = VW_PLEDGES.COMMITMENT_PERSON_ID
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Constituents & Transactions');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Constituents & Pledges', 0, 'VW_CONSTITUENTS_PLEDGES', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();

-- ***********************************************************************
-- Contact Details Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Contact Details', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('PERSON_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Manager Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager''))', 'Account Manager Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Account Manager Account Number
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager'')', 'Account Manager Account Number', b'0', 3, @REPORTFIELDGROUP_ID);

-- Constituent Type
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_TYPE', 'Constituent Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLES', 'Profile Types', b'0', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLE', 'Profile Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Title
CALL INSERTREPORTFIELD('PERSON_TITLE', 'Title', b'0', 1, @REPORTFIELDGROUP_ID);

-- First Name
CALL INSERTREPORTFIELD('PERSON_FIRST_NAME', 'First Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Middle Name
CALL INSERTREPORTFIELD('PERSON_MIDDLE_NAME', 'Middle Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Name
CALL INSERTREPORTFIELD('PERSON_LAST_NAME', 'Last Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Suffix
CALL INSERTREPORTFIELD('PERSON_SUFFIX', 'Suffix', b'0', 1, @REPORTFIELDGROUP_ID);

-- Recognition Name
CALL INSERTREPORTFIELD('PERSON_RECOGNITION_NAME', 'Recognition Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Organization Name
CALL INSERTREPORTFIELD('PERSON_ORGANIZATION_NAME', 'Organization Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Legal Name
CALL INSERTREPORTFIELD('PERSON_LEGAL_NAME', 'Legal Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.matching'')', 'Matching', b'0', 1, @REPORTFIELDGROUP_ID);

-- Percent Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.percentMatch'')', 'Percent Matching', b'0', 3, @REPORTFIELDGROUP_ID);

-- Maximum Match
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.maximumMatch'')', 'Maximum Match', b'0', 5, @REPORTFIELDGROUP_ID);

-- Website
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.website'')', 'Website', b'0', 1, @REPORTFIELDGROUP_ID);

-- Tax ID
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.taxid'')', 'Tax ID', b'0', 1, @REPORTFIELDGROUP_ID);

-- NCAIS Code
CALL INSERTREPORTFIELD('PERSON_NCAIS_CODE', 'NCAIS Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Communication Preferences
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''communicationPreferences'')', 'Communication Preferences', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Format
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''emailFormat'')', 'Email Format', b'0', 1, @REPORTFIELDGROUP_ID);

-- Create Date
CALL INSERTREPORTFIELD('PERSON_CREATE_DATE', 'Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Update Date
CALL INSERTREPORTFIELD('PERSON_UPDATE_DATE', 'Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Demographic Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Demographic Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Marital Status
CALL INSERTREPORTFIELD('PERSON_MARITAL_STATUS', 'Marital Status', b'0', 3, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.birthDate'')', 'Birth Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Deceased
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.deceased'')', 'Deceased', b'0', 6, @REPORTFIELDGROUP_ID);

-- Gender
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.gender'')', 'Gender', b'0', 1, @REPORTFIELDGROUP_ID);

-- Race
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.race'')', 'Race', b'0', 1, @REPORTFIELDGROUP_ID);

-- Military
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.military'')', 'Military', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Miscellaneous Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Miscellaneous Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Major Donor
CALL INSERTREPORTFIELD('PERSON_MAJOR_DONOR', 'Major Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Lapsed Donor
CALL INSERTREPORTFIELD('PERSON_LAPSED_DONOR', 'Lapsed Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('PERSON_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Pledge Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Pledge Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account
CALL INSERTREPORTFIELD('COMMITMENT_COMMITMENT_ID', 'Pledge ID', b'1', 3, @REPORTFIELDGROUP_ID);

-- Recurring
CALL INSERTREPORTFIELD('COMMITMENT_RECURRING', 'Recurring', b'0', 6, @REPORTFIELDGROUP_ID);

-- Amount Per Gift
CALL INSERTREPORTFIELD('COMMITMENT_AMOUNT_PER_GIFT', 'Amount Per Gift', b'0', 5, @REPORTFIELDGROUP_ID);

-- Amount Total
CALL INSERTREPORTFIELD('COMMITMENT_AMOUNT_TOTAL', 'Amount Total', b'0', 5, @REPORTFIELDGROUP_ID);

-- Currency Code
CALL INSERTREPORTFIELD('COMMITMENT_CURRENCY_CODE', 'Currency Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Status
CALL INSERTREPORTFIELD('COMMITMENT_STATUS', 'Status', b'0', 1, @REPORTFIELDGROUP_ID);

-- Frequency
CALL INSERTREPORTFIELD('COMMITMENT_FREQUENCY', 'Frequency', b'0', 1, @REPORTFIELDGROUP_ID);

-- Pledge Date
CALL INSERTREPORTFIELD('COMMITMENT_PLEDGE_DATE', 'Pledge Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Projected Date
CALL INSERTREPORTFIELD('COMMITMENT_PROJECTED_DATE', 'Projected Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Start Date
CALL INSERTREPORTFIELD('COMMITMENT_START_DATE', 'Start Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- End Date
CALL INSERTREPORTFIELD('COMMITMENT_END_DATE', 'End Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Comments
CALL INSERTREPORTFIELD('COMMITMENT_COMMENTS', 'Comments', b'0', 1, @REPORTFIELDGROUP_ID);

-- Receipt Email
CALL INSERTREPORTFIELD('COMMITMENT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS', 'Receipt Email', b'0', 1, @REPORTFIELDGROUP_ID);

-- Send Acknowledgment
CALL INSERTREPORTFIELD('COMMITMENT_SEND_ACKNOWLEDGMENT', 'Send Acknowledgment', b'0', 6, @REPORTFIELDGROUP_ID);

-- Acknowledgment Date
CALL INSERTREPORTFIELD('COMMITMENT_ACKNOWLEDGMENT_DATE', 'Acknowledgment Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Acknowledgment Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Acknowledgment Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Receipt Email
CALL INSERTREPORTFIELD('COMMITMENT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS', 'Receipt Email', b'0', 1, @REPORTFIELDGROUP_ID);

-- Send Acknowledgment
CALL INSERTREPORTFIELD('COMMITMENT_SEND_ACKNOWLEDGMENT', 'Send Acknowledgment', b'0', 6, @REPORTFIELDGROUP_ID);

-- Acknowledgment Date
CALL INSERTREPORTFIELD('COMMITMENT_ACKNOWLEDGMENT_DATE', 'Acknowledgment Date', b'0', 4, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Constituents & Pledges & Distributions View & Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_CONSTITUENTS_PLEDGES_DISTRIBUTIONS;
CREATE VIEW VW_CONSTITUENTS_PLEDGES_DISTRIBUTIONS
AS
	SELECT
		PERSON_PERSON_ID,
		PERSON_CONSTITUENT_ROLES,
		PERSON_CONSTITUENT_ROLE,
		PERSON_CONSTITUENT_TYPE,
		PERSON_CREATE_DATE,
		PERSON_FIRST_NAME,
		PERSON_LAPSED_DONOR,
		PERSON_LAST_NAME,
		PERSON_LEGAL_NAME,
		PERSON_LOGIN_ID,
		PERSON_MAJOR_DONOR,
		PERSON_MARITAL_STATUS,
		PERSON_MIDDLE_NAME,
		PERSON_NCAIS_CODE,
		PERSON_ORGANIZATION_NAME,
		PERSON_PREFERRED_PHONE_TYPE,
		PERSON_RECOGNITION_NAME,
		PERSON_SUFFIX,
		PERSON_TITLE,
		PERSON_UPDATE_DATE,
		PERSON_SITE_NAME,

		COMMITMENT_PERSON_ID,
		COMMITMENT_COMMITMENT_ID,
		COMMITMENT_RECURRING,
		COMMITMENT_AMOUNT_PER_GIFT,
		COMMITMENT_AMOUNT_TOTAL,
		COMMITMENT_CURRENCY_CODE,
		COMMITMENT_STATUS,
		COMMITMENT_FREQUENCY,
		COMMITMENT_PLEDGE_DATE,
		COMMITMENT_PROJECTED_DATE,
		COMMITMENT_START_DATE,
		COMMITMENT_END_DATE,
		COMMITMENT_COMMENTS,
		COMMITMENT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS,
		COMMITMENT_SEND_ACKNOWLEDGMENT,
		COMMITMENT_ACKNOWLEDGMENT_DATE,
		DISTRO_LINE_DISTRO_LINE_ID,
		DISTRO_LINE_AMOUNT,
		DISTRO_LINE_PERCENTAGE,
		DISTRO_LINE_PROJECT_CODE,
		DISTRO_LINE_MOTIVATION_CODE
	FROM VW_CONSTITUENTS
	LEFT JOIN VW_PLEDGES_DISTRIBUTIONS ON VW_CONSTITUENTS.PERSON_PERSON_ID = VW_PLEDGES_DISTRIBUTIONS.COMMITMENT_PERSON_ID
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Constituents & Transactions');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Constituents & Pledges & Distributions', 0, 'VW_CONSTITUENTS_PLEDGES_DISTRIBUTIONS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();

-- ***********************************************************************
-- Contact Details Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Contact Details', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('PERSON_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Manager Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager''))', 'Account Manager Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Account Manager Account Number
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager'')', 'Account Manager Account Number', b'0', 3, @REPORTFIELDGROUP_ID);

-- Constituent Type
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_TYPE', 'Constituent Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLES', 'Profile Types', b'0', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLE', 'Profile Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Title
CALL INSERTREPORTFIELD('PERSON_TITLE', 'Title', b'0', 1, @REPORTFIELDGROUP_ID);

-- First Name
CALL INSERTREPORTFIELD('PERSON_FIRST_NAME', 'First Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Middle Name
CALL INSERTREPORTFIELD('PERSON_MIDDLE_NAME', 'Middle Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Name
CALL INSERTREPORTFIELD('PERSON_LAST_NAME', 'Last Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Suffix
CALL INSERTREPORTFIELD('PERSON_SUFFIX', 'Suffix', b'0', 1, @REPORTFIELDGROUP_ID);

-- Recognition Name
CALL INSERTREPORTFIELD('PERSON_RECOGNITION_NAME', 'Recognition Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Organization Name
CALL INSERTREPORTFIELD('PERSON_ORGANIZATION_NAME', 'Organization Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Legal Name
CALL INSERTREPORTFIELD('PERSON_LEGAL_NAME', 'Legal Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.matching'')', 'Matching', b'0', 1, @REPORTFIELDGROUP_ID);

-- Percent Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.percentMatch'')', 'Percent Matching', b'0', 3, @REPORTFIELDGROUP_ID);

-- Maximum Match
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.maximumMatch'')', 'Maximum Match', b'0', 5, @REPORTFIELDGROUP_ID);

-- Website
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.website'')', 'Website', b'0', 1, @REPORTFIELDGROUP_ID);

-- Tax ID
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.taxid'')', 'Tax ID', b'0', 1, @REPORTFIELDGROUP_ID);

-- NCAIS Code
CALL INSERTREPORTFIELD('PERSON_NCAIS_CODE', 'NCAIS Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Communication Preferences
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''communicationPreferences'')', 'Communication Preferences', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Format
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''emailFormat'')', 'Email Format', b'0', 1, @REPORTFIELDGROUP_ID);

-- Create Date
CALL INSERTREPORTFIELD('PERSON_CREATE_DATE', 'Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Update Date
CALL INSERTREPORTFIELD('PERSON_UPDATE_DATE', 'Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Demographic Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Demographic Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Marital Status
CALL INSERTREPORTFIELD('PERSON_MARITAL_STATUS', 'Marital Status', b'0', 3, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.birthDate'')', 'Birth Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Deceased
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.deceased'')', 'Deceased', b'0', 6, @REPORTFIELDGROUP_ID);

-- Gender
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.gender'')', 'Gender', b'0', 1, @REPORTFIELDGROUP_ID);

-- Race
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.race'')', 'Race', b'0', 1, @REPORTFIELDGROUP_ID);

-- Military
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.military'')', 'Military', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Miscellaneous Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Miscellaneous Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Major Donor
CALL INSERTREPORTFIELD('PERSON_MAJOR_DONOR', 'Major Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Lapsed Donor
CALL INSERTREPORTFIELD('PERSON_LAPSED_DONOR', 'Lapsed Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('PERSON_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Pledge Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Pledge Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account
CALL INSERTREPORTFIELD('COMMITMENT_COMMITMENT_ID', 'Pledge ID', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('COMMITMENT_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Recurring
CALL INSERTREPORTFIELD('COMMITMENT_RECURRING', 'Recurring', b'0', 6, @REPORTFIELDGROUP_ID);

-- Amount Per Gift
CALL INSERTREPORTFIELD('COMMITMENT_AMOUNT_PER_GIFT', 'Amount Per Gift', b'0', 5, @REPORTFIELDGROUP_ID);

-- Amount Total
CALL INSERTREPORTFIELD('COMMITMENT_AMOUNT_TOTAL', 'Amount Total', b'0', 5, @REPORTFIELDGROUP_ID);

-- Currency Code
CALL INSERTREPORTFIELD('COMMITMENT_CURRENCY_CODE', 'Currency Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Status
CALL INSERTREPORTFIELD('COMMITMENT_STATUS', 'Status', b'0', 1, @REPORTFIELDGROUP_ID);

-- Frequency
CALL INSERTREPORTFIELD('COMMITMENT_FREQUENCY', 'Frequency', b'0', 1, @REPORTFIELDGROUP_ID);

-- Pledge Date
CALL INSERTREPORTFIELD('COMMITMENT_PLEDGE_DATE', 'Pledge Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Projected Date
CALL INSERTREPORTFIELD('COMMITMENT_PROJECTED_DATE', 'Projected Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Start Date
CALL INSERTREPORTFIELD('COMMITMENT_START_DATE', 'Start Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- End Date
CALL INSERTREPORTFIELD('COMMITMENT_END_DATE', 'End Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Comments
CALL INSERTREPORTFIELD('COMMITMENT_COMMENTS', 'Comments', b'0', 1, @REPORTFIELDGROUP_ID);

-- Receipt Email
CALL INSERTREPORTFIELD('COMMITMENT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS', 'Receipt Email', b'0', 1, @REPORTFIELDGROUP_ID);

-- Send Acknowledgment
CALL INSERTREPORTFIELD('COMMITMENT_SEND_ACKNOWLEDGMENT', 'Send Acknowledgment', b'0', 6, @REPORTFIELDGROUP_ID);

-- Acknowledgment Date
CALL INSERTREPORTFIELD('COMMITMENT_ACKNOWLEDGMENT_DATE', 'Acknowledgment Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Acknowledgment Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Acknowledgment Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Receipt Email
CALL INSERTREPORTFIELD('COMMITMENT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS', 'Receipt Email', b'0', 1, @REPORTFIELDGROUP_ID);

-- Send Acknowledgment
CALL INSERTREPORTFIELD('COMMITMENT_SEND_ACKNOWLEDGMENT', 'Send Acknowledgment', b'0', 6, @REPORTFIELDGROUP_ID);

-- Acknowledgment Date
CALL INSERTREPORTFIELD('COMMITMENT_ACKNOWLEDGMENT_DATE', 'Acknowledgment Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Pledge Distribution Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Pledge Distribution', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Plege Distribution Reference Number
CALL INSERTREPORTFIELD('DISTRO_LINE_DISTRO_LINE_ID', 'Pledge Distribution Reference Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Pledge Distribution Amount
CALL INSERTREPORTFIELD('DISTRO_LINE_AMOUNT', 'Pledge Distribution Amount', b'1', 5, @REPORTFIELDGROUP_ID);

-- Percentage
CALL INSERTREPORTFIELD('DISTRO_LINE_PERCENTAGE', 'Percentage', b'0', 5, @REPORTFIELDGROUP_ID);

-- Designation
CALL INSERTREPORTFIELD('DISTRO_LINE_PROJECT_CODE', 'Designation', b'0', 1, @REPORTFIELDGROUP_ID);

-- Motivation
CALL INSERTREPORTFIELD('DISTRO_LINE_MOTIVATION_CODE', 'Motivation', b'0', 1, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Constituents & Recurring Gifts View & Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_CONSTITUENTS_RECURRINGGIFTS;
CREATE VIEW VW_CONSTITUENTS_RECURRINGGIFTS
AS
	SELECT
		PERSON_PERSON_ID,
		PERSON_CONSTITUENT_ROLES,
		PERSON_CONSTITUENT_ROLE,
		PERSON_CONSTITUENT_TYPE,
		PERSON_CREATE_DATE,
		PERSON_FIRST_NAME,
		PERSON_LAPSED_DONOR,
		PERSON_LAST_NAME,
		PERSON_LEGAL_NAME,
		PERSON_LOGIN_ID,
		PERSON_MAJOR_DONOR,
		PERSON_MARITAL_STATUS,
		PERSON_MIDDLE_NAME,
		PERSON_NCAIS_CODE,
		PERSON_ORGANIZATION_NAME,
		PERSON_PREFERRED_PHONE_TYPE,
		PERSON_RECOGNITION_NAME,
		PERSON_SUFFIX,
		PERSON_TITLE,
		PERSON_UPDATE_DATE,
		PERSON_SITE_NAME,

		COMMITMENT_COMMITMENT_ID,
		COMMITMENT_PERSON_ID,
		COMMITMENT_AUTO_PAY,
		COMMITMENT_AMOUNT_PER_GIFT,
		COMMITMENT_AMOUNT_TOTAL,
		COMMITMENT_CURRENCY_CODE,
		COMMITMENT_FREQUENCY,
		COMMITMENT_START_DATE,
		COMMITMENT_END_DATE,
		COMMITMENT_STATUS,
		COMMITMENT_COMMENTS,
		COMMITMENT_LAST_ENTRY_DATE,
		COMMITMENT_CREATE_DATE,
		COMMITMENT_UPDATE_DATE,
		COMMITMENT_PAYMENT_SOURCE_PAYMENT_PROFILE_DESCRIPTION,
		COMMITMENT_PAYMENT_SOURCE_PAYMENT_TYPE,
		COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_TYPE,
		COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_HOLDER_NAME,
		COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION,
		COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION_DATE,
		COMMITMENT_PAYMENT_SOURCE_ACH_HOLDER_NAME,
		COMMITMENT_PAYMENT_SOURCE_ACH_ROUTING_NUMBER,
		COMMITMENT_CHECK_NUMBER,
		COMMITMENT_PAYMENT_ADDRESS_ADDRESS_LINE_1,
		COMMITMENT_PAYMENT_ADDRESS_ADDRESS_LINE_2,
		COMMITMENT_PAYMENT_ADDRESS_ADDRESS_LINE_3,
		COMMITMENT_PAYMENT_ADDRESS_CITY,
		COMMITMENT_PAYMENT_ADDRESS_STATE_PROVINCE,
		COMMITMENT_PAYMENT_ADDRESS_POSTAL_CODE,
		COMMITMENT_PAYMENT_ADDRESS_COUNTRY,
		COMMITMENT_PAYMENT_PHONE_NUMBER,
		COMMITMENT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS,
		COMMITMENT_SEND_ACKNOWLEDGMENT,
		COMMITMENT_ACKNOWLEDGMENT_DATE
	FROM VW_CONSTITUENTS
	LEFT JOIN VW_RECURRINGGIFTS ON VW_CONSTITUENTS.PERSON_PERSON_ID = VW_RECURRINGGIFTS.COMMITMENT_PERSON_ID
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Constituents & Transactions');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Constituents & Recurring Gifts', 0, 'VW_CONSTITUENTS_RECURRINGGIFTS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();

-- ***********************************************************************
-- Contact Details Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Contact Details', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('PERSON_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Manager Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager''))', 'Account Manager Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Account Manager Account Number
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager'')', 'Account Manager Account Number', b'0', 3, @REPORTFIELDGROUP_ID);

-- Constituent Type
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_TYPE', 'Constituent Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLES', 'Profile Types', b'0', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLE', 'Profile Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Title
CALL INSERTREPORTFIELD('PERSON_TITLE', 'Title', b'0', 1, @REPORTFIELDGROUP_ID);

-- First Name
CALL INSERTREPORTFIELD('PERSON_FIRST_NAME', 'First Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Middle Name
CALL INSERTREPORTFIELD('PERSON_MIDDLE_NAME', 'Middle Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Name
CALL INSERTREPORTFIELD('PERSON_LAST_NAME', 'Last Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Suffix
CALL INSERTREPORTFIELD('PERSON_SUFFIX', 'Suffix', b'0', 1, @REPORTFIELDGROUP_ID);

-- Recognition Name
CALL INSERTREPORTFIELD('PERSON_RECOGNITION_NAME', 'Recognition Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Organization Name
CALL INSERTREPORTFIELD('PERSON_ORGANIZATION_NAME', 'Organization Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Legal Name
CALL INSERTREPORTFIELD('PERSON_LEGAL_NAME', 'Legal Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.matching'')', 'Matching', b'0', 1, @REPORTFIELDGROUP_ID);

-- Percent Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.percentMatch'')', 'Percent Matching', b'0', 3, @REPORTFIELDGROUP_ID);

-- Maximum Match
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.maximumMatch'')', 'Maximum Match', b'0', 5, @REPORTFIELDGROUP_ID);

-- Website
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.website'')', 'Website', b'0', 1, @REPORTFIELDGROUP_ID);

-- Tax ID
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.taxid'')', 'Tax ID', b'0', 1, @REPORTFIELDGROUP_ID);

-- NCAIS Code
CALL INSERTREPORTFIELD('PERSON_NCAIS_CODE', 'NCAIS Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Communication Preferences
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''communicationPreferences'')', 'Communication Preferences', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Format
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''emailFormat'')', 'Email Format', b'0', 1, @REPORTFIELDGROUP_ID);

-- Create Date
CALL INSERTREPORTFIELD('PERSON_CREATE_DATE', 'Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Update Date
CALL INSERTREPORTFIELD('PERSON_UPDATE_DATE', 'Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Demographic Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Demographic Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Marital Status
CALL INSERTREPORTFIELD('PERSON_MARITAL_STATUS', 'Marital Status', b'0', 3, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.birthDate'')', 'Birth Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Deceased
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.deceased'')', 'Deceased', b'0', 6, @REPORTFIELDGROUP_ID);

-- Gender
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.gender'')', 'Gender', b'0', 1, @REPORTFIELDGROUP_ID);

-- Race
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.race'')', 'Race', b'0', 1, @REPORTFIELDGROUP_ID);

-- Military
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.military'')', 'Military', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Miscellaneous Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Miscellaneous Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Major Donor
CALL INSERTREPORTFIELD('PERSON_MAJOR_DONOR', 'Major Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Lapsed Donor
CALL INSERTREPORTFIELD('PERSON_LAPSED_DONOR', 'Lapsed Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('PERSON_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Recurring Gift Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Recurring Gift Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Recurring Gift ID
CALL INSERTREPORTFIELD('COMMITMENT_COMMITMENT_ID', 'Recurring Gift ID', b'1', 3, @REPORTFIELDGROUP_ID);

-- Auto Pay
CALL INSERTREPORTFIELD('COMMITMENT_AUTO_PAY', 'Auto Pay', b'0', 6, @REPORTFIELDGROUP_ID);

-- Amount Per Gift
CALL INSERTREPORTFIELD('COMMITMENT_AMOUNT_PER_GIFT', 'Amount Per Gift', b'1', 5, @REPORTFIELDGROUP_ID);

-- Amount Total
CALL INSERTREPORTFIELD('COMMITMENT_AMOUNT_TOTAL', 'Amount Total', b'1', 5, @REPORTFIELDGROUP_ID);

-- Currency Code
CALL INSERTREPORTFIELD('COMMITMENT_CURRENCY_CODE', 'Currency Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Frequency
CALL INSERTREPORTFIELD('COMMITMENT_FREQUENCY', 'Frequency', b'0', 1, @REPORTFIELDGROUP_ID);

-- Start Date
CALL INSERTREPORTFIELD('COMMITMENT_START_DATE', 'Start Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- End Date
CALL INSERTREPORTFIELD('COMMITMENT_END_DATE', 'End Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Status
CALL INSERTREPORTFIELD('COMMITMENT_STATUS', 'Status', b'0', 1, @REPORTFIELDGROUP_ID);

-- Reference Account Number
CALL INSERTREPORTFIELD('GETCOMMITMENTCUSTOMFIELD(COMMITMENT_COMMITMENT_ID, ''reference'')', 'Reference Account Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Reference Account Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETCOMMITMENTCUSTOMFIELD(COMMITMENT_COMMITMENT_ID, ''reference''))', 'Reference Account Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Comments
CALL INSERTREPORTFIELD('COMMITMENT_COMMENTS', 'Comments', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Entry Date
CALL INSERTREPORTFIELD('COMMITMENT_LAST_ENTRY_DATE', 'Last Entry Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Recurring Gift Create Date
CALL INSERTREPORTFIELD('COMMITMENT_CREATE_DATE', 'Recurring Gift Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Recurring Gift Update Date
CALL INSERTREPORTFIELD('COMMITMENT_UPDATE_DATE', 'Recurring Gift Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Payment Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Payment Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Payment Profile Description
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_PAYMENT_PROFILE_DESCRIPTION', 'Payment Profile Description', b'0', 1, @REPORTFIELDGROUP_ID);

-- Payment Method
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_PAYMENT_TYPE', 'Payment Method', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Type
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_TYPE', 'Credit Card Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Holder Name
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_HOLDER_NAME', 'Credit Card Holder Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Expiration
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION', 'Credit Card Expiration', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Expiration (Date / Time)
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION_DATE', 'Credit Card Expiration (Date / Time)', b'0', 4, @REPORTFIELDGROUP_ID);

-- ACH Holder Name
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_ACH_HOLDER_NAME', 'ACH Holder Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ACH Routing Number
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_ACH_ROUTING_NUMBER', 'ACH Routing Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Check Number
CALL INSERTREPORTFIELD('COMMITMENT_CHECK_NUMBER', 'Check Number', b'0', 2, @REPORTFIELDGROUP_ID);

-- Address Line 1
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_ADDRESS_LINE_1', 'Address Line 1', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 2
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_ADDRESS_LINE_2', 'Address Line 2', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 3
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_ADDRESS_LINE_3', 'Address Line 3', b'0', 1, @REPORTFIELDGROUP_ID);

-- City
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_CITY', 'City', b'0', 1, @REPORTFIELDGROUP_ID);

-- State/Province
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_STATE_PROVINCE', 'State/Province', b'0', 1, @REPORTFIELDGROUP_ID);

-- Zip/Postal Code
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_POSTAL_CODE', 'Zip/Postal Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Country
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_COUNTRY', 'Country', b'0', 1, @REPORTFIELDGROUP_ID);

-- Phone Number
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_PHONE_NUMBER', 'Phone Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Acknowledgment Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Acknowledgment Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Receipt Email
CALL INSERTREPORTFIELD('COMMITMENT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS', 'Receipt Email', b'0', 1, @REPORTFIELDGROUP_ID);

-- Send Acknowledgment
CALL INSERTREPORTFIELD('COMMITMENT_SEND_ACKNOWLEDGMENT', 'Send Acknowledgment', b'0', 6, @REPORTFIELDGROUP_ID);

-- Acknowledgment Date
CALL INSERTREPORTFIELD('COMMITMENT_ACKNOWLEDGMENT_DATE', 'Acknowledgment Date', b'0', 4, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Constituents & Recurring Gifts & Distributions View & Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_CONSTITUENTS_RECURRINGGIFTS_DISTRIBUTIONS;
CREATE VIEW VW_CONSTITUENTS_RECURRINGGIFTS_DISTRIBUTIONS
AS
	SELECT
		PERSON_PERSON_ID,
		PERSON_CONSTITUENT_ROLES,
		PERSON_CONSTITUENT_ROLE,
		PERSON_CONSTITUENT_TYPE,
		PERSON_CREATE_DATE,
		PERSON_FIRST_NAME,
		PERSON_LAPSED_DONOR,
		PERSON_LAST_NAME,
		PERSON_LEGAL_NAME,
		PERSON_LOGIN_ID,
		PERSON_MAJOR_DONOR,
		PERSON_MARITAL_STATUS,
		PERSON_MIDDLE_NAME,
		PERSON_NCAIS_CODE,
		PERSON_ORGANIZATION_NAME,
		PERSON_PREFERRED_PHONE_TYPE,
		PERSON_RECOGNITION_NAME,
		PERSON_SUFFIX,
		PERSON_TITLE,
		PERSON_UPDATE_DATE,
		PERSON_SITE_NAME,

		COMMITMENT_COMMITMENT_ID,
		COMMITMENT_PERSON_ID,
		COMMITMENT_AUTO_PAY,
		COMMITMENT_AMOUNT_PER_GIFT,
		COMMITMENT_AMOUNT_TOTAL,
		COMMITMENT_CURRENCY_CODE,
		COMMITMENT_FREQUENCY,
		COMMITMENT_START_DATE,
		COMMITMENT_END_DATE,
		COMMITMENT_STATUS,
		COMMITMENT_COMMENTS,
		COMMITMENT_LAST_ENTRY_DATE,
		COMMITMENT_CREATE_DATE,
		COMMITMENT_UPDATE_DATE,
		COMMITMENT_PAYMENT_SOURCE_PAYMENT_PROFILE_DESCRIPTION,
		COMMITMENT_PAYMENT_SOURCE_PAYMENT_TYPE,
		COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_TYPE,
		COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_HOLDER_NAME,
		COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION,
		COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION_DATE,
		COMMITMENT_PAYMENT_SOURCE_ACH_HOLDER_NAME,
		COMMITMENT_PAYMENT_SOURCE_ACH_ROUTING_NUMBER,
		COMMITMENT_CHECK_NUMBER,
		COMMITMENT_PAYMENT_ADDRESS_ADDRESS_LINE_1,
		COMMITMENT_PAYMENT_ADDRESS_ADDRESS_LINE_2,
		COMMITMENT_PAYMENT_ADDRESS_ADDRESS_LINE_3,
		COMMITMENT_PAYMENT_ADDRESS_CITY,
		COMMITMENT_PAYMENT_ADDRESS_STATE_PROVINCE,
		COMMITMENT_PAYMENT_ADDRESS_POSTAL_CODE,
		COMMITMENT_PAYMENT_ADDRESS_COUNTRY,
		COMMITMENT_PAYMENT_PHONE_NUMBER,
		COMMITMENT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS,
		COMMITMENT_SEND_ACKNOWLEDGMENT,
		COMMITMENT_ACKNOWLEDGMENT_DATE,
		DISTRO_LINE_DISTRO_LINE_ID,
		DISTRO_LINE_AMOUNT,
		DISTRO_LINE_PERCENTAGE,
		DISTRO_LINE_PROJECT_CODE,
		DISTRO_LINE_MOTIVATION_CODE
	FROM VW_CONSTITUENTS
	LEFT JOIN VW_RECURRINGGIFTS_DISTRIBUTIONS ON VW_CONSTITUENTS.PERSON_PERSON_ID = VW_RECURRINGGIFTS_DISTRIBUTIONS.COMMITMENT_PERSON_ID
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Constituents & Transactions');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Constituents & Recurring Gifts & Distributions', 0, 'VW_CONSTITUENTS_RECURRINGGIFTS_DISTRIBUTIONS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();

-- ***********************************************************************
-- Contact Details Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Contact Details', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('PERSON_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Manager Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager''))', 'Account Manager Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Account Manager Account Number
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager'')', 'Account Manager Account Number', b'0', 3, @REPORTFIELDGROUP_ID);

-- Constituent Type
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_TYPE', 'Constituent Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLES', 'Profile Types', b'0', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLE', 'Profile Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Title
CALL INSERTREPORTFIELD('PERSON_TITLE', 'Title', b'0', 1, @REPORTFIELDGROUP_ID);

-- First Name
CALL INSERTREPORTFIELD('PERSON_FIRST_NAME', 'First Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Middle Name
CALL INSERTREPORTFIELD('PERSON_MIDDLE_NAME', 'Middle Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Name
CALL INSERTREPORTFIELD('PERSON_LAST_NAME', 'Last Name', b'1', 1, @REPORTFIELDGROUP_ID);

-- Suffix
CALL INSERTREPORTFIELD('PERSON_SUFFIX', 'Suffix', b'0', 1, @REPORTFIELDGROUP_ID);

-- Recognition Name
CALL INSERTREPORTFIELD('PERSON_RECOGNITION_NAME', 'Recognition Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Organization Name
CALL INSERTREPORTFIELD('PERSON_ORGANIZATION_NAME', 'Organization Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Legal Name
CALL INSERTREPORTFIELD('PERSON_LEGAL_NAME', 'Legal Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.matching'')', 'Matching', b'0', 1, @REPORTFIELDGROUP_ID);

-- Percent Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.percentMatch'')', 'Percent Matching', b'0', 3, @REPORTFIELDGROUP_ID);

-- Maximum Match
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.maximumMatch'')', 'Maximum Match', b'0', 5, @REPORTFIELDGROUP_ID);

-- Website
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.website'')', 'Website', b'0', 1, @REPORTFIELDGROUP_ID);

-- Tax ID
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.taxid'')', 'Tax ID', b'0', 1, @REPORTFIELDGROUP_ID);

-- NCAIS Code
CALL INSERTREPORTFIELD('PERSON_NCAIS_CODE', 'NCAIS Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Communication Preferences
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''communicationPreferences'')', 'Communication Preferences', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Format
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''emailFormat'')', 'Email Format', b'0', 1, @REPORTFIELDGROUP_ID);

-- Create Date
CALL INSERTREPORTFIELD('PERSON_CREATE_DATE', 'Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Update Date
CALL INSERTREPORTFIELD('PERSON_UPDATE_DATE', 'Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Demographic Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Demographic Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Marital Status
CALL INSERTREPORTFIELD('PERSON_MARITAL_STATUS', 'Marital Status', b'0', 3, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.birthDate'')', 'Birth Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Deceased
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.deceased'')', 'Deceased', b'0', 6, @REPORTFIELDGROUP_ID);

-- Gender
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.gender'')', 'Gender', b'0', 1, @REPORTFIELDGROUP_ID);

-- Race
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.race'')', 'Race', b'0', 1, @REPORTFIELDGROUP_ID);

-- Military
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.military'')', 'Military', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Miscellaneous Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Miscellaneous Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Major Donor
CALL INSERTREPORTFIELD('PERSON_MAJOR_DONOR', 'Major Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Lapsed Donor
CALL INSERTREPORTFIELD('PERSON_LAPSED_DONOR', 'Lapsed Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('PERSON_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Recurring Gift Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Recurring Gift Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Recurring Gift ID
CALL INSERTREPORTFIELD('COMMITMENT_COMMITMENT_ID', 'Recurring Gift ID', b'1', 3, @REPORTFIELDGROUP_ID);

-- Auto Pay
CALL INSERTREPORTFIELD('COMMITMENT_AUTO_PAY', 'Auto Pay', b'0', 6, @REPORTFIELDGROUP_ID);

-- Amount Per Gift
CALL INSERTREPORTFIELD('COMMITMENT_AMOUNT_PER_GIFT', 'Amount Per Gift', b'1', 5, @REPORTFIELDGROUP_ID);

-- Amount Total
CALL INSERTREPORTFIELD('COMMITMENT_AMOUNT_TOTAL', 'Amount Total', b'1', 5, @REPORTFIELDGROUP_ID);

-- Currency Code
CALL INSERTREPORTFIELD('COMMITMENT_CURRENCY_CODE', 'Currency Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Frequency
CALL INSERTREPORTFIELD('COMMITMENT_FREQUENCY', 'Frequency', b'0', 1, @REPORTFIELDGROUP_ID);

-- Start Date
CALL INSERTREPORTFIELD('COMMITMENT_START_DATE', 'Start Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- End Date
CALL INSERTREPORTFIELD('COMMITMENT_END_DATE', 'End Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Status
CALL INSERTREPORTFIELD('COMMITMENT_STATUS', 'Status', b'0', 1, @REPORTFIELDGROUP_ID);

-- Reference Account Number
CALL INSERTREPORTFIELD('GETCOMMITMENTCUSTOMFIELD(COMMITMENT_COMMITMENT_ID, ''reference'')', 'Reference Account Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Reference Account Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETCOMMITMENTCUSTOMFIELD(COMMITMENT_COMMITMENT_ID, ''reference''))', 'Reference Account Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Comments
CALL INSERTREPORTFIELD('COMMITMENT_COMMENTS', 'Comments', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Entry Date
CALL INSERTREPORTFIELD('COMMITMENT_LAST_ENTRY_DATE', 'Last Entry Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Recurring Gift Create Date
CALL INSERTREPORTFIELD('COMMITMENT_CREATE_DATE', 'Recurring Gift Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Recurring Gift Update Date
CALL INSERTREPORTFIELD('COMMITMENT_UPDATE_DATE', 'Recurring Gift Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Payment Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Payment Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Payment Profile Description
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_PAYMENT_PROFILE_DESCRIPTION', 'Payment Profile Description', b'0', 1, @REPORTFIELDGROUP_ID);

-- Payment Method
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_PAYMENT_TYPE', 'Payment Method', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Type
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_TYPE', 'Credit Card Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Holder Name
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_HOLDER_NAME', 'Credit Card Holder Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Expiration
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION', 'Credit Card Expiration', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Expiration (Date / Time)
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION_DATE', 'Credit Card Expiration (Date / Time)', b'0', 4, @REPORTFIELDGROUP_ID);

-- ACH Holder Name
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_ACH_HOLDER_NAME', 'ACH Holder Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ACH Routing Number
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_ACH_ROUTING_NUMBER', 'ACH Routing Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Check Number
CALL INSERTREPORTFIELD('COMMITMENT_CHECK_NUMBER', 'Check Number', b'0', 2, @REPORTFIELDGROUP_ID);

-- Address Line 1
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_ADDRESS_LINE_1', 'Address Line 1', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 2
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_ADDRESS_LINE_2', 'Address Line 2', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 3
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_ADDRESS_LINE_3', 'Address Line 3', b'0', 1, @REPORTFIELDGROUP_ID);

-- City
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_CITY', 'City', b'0', 1, @REPORTFIELDGROUP_ID);

-- State/Province
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_STATE_PROVINCE', 'State/Province', b'0', 1, @REPORTFIELDGROUP_ID);

-- Zip/Postal Code
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_POSTAL_CODE', 'Zip/Postal Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Country
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_COUNTRY', 'Country', b'0', 1, @REPORTFIELDGROUP_ID);

-- Phone Number
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_PHONE_NUMBER', 'Phone Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Acknowledgment Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Acknowledgment Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Receipt Email
CALL INSERTREPORTFIELD('COMMITMENT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS', 'Receipt Email', b'0', 1, @REPORTFIELDGROUP_ID);

-- Send Acknowledgment
CALL INSERTREPORTFIELD('COMMITMENT_SEND_ACKNOWLEDGMENT', 'Send Acknowledgment', b'0', 6, @REPORTFIELDGROUP_ID);

-- Acknowledgment Date
CALL INSERTREPORTFIELD('COMMITMENT_ACKNOWLEDGMENT_DATE', 'Acknowledgment Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Gift Distribution Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Recurring Gift Distribution Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Gift Distribution Reference Number
CALL INSERTREPORTFIELD('DISTRO_LINE_DISTRO_LINE_ID', 'Gift Distribution Reference Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Gift Distribution Amount
CALL INSERTREPORTFIELD('DISTRO_LINE_AMOUNT', 'Gift Distribution Amount', b'1', 5, @REPORTFIELDGROUP_ID);

-- Percentage
CALL INSERTREPORTFIELD('DISTRO_LINE_PERCENTAGE', 'Percentage', b'0', 5, @REPORTFIELDGROUP_ID);

-- Designation
CALL INSERTREPORTFIELD('DISTRO_LINE_PROJECT_CODE', 'Designation', b'0', 1, @REPORTFIELDGROUP_ID);

-- Motivation
CALL INSERTREPORTFIELD('DISTRO_LINE_MOTIVATION_CODE', 'Motivation', b'0', 1, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Audit History View & Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_AUDITHISTORY;
CREATE VIEW VW_AUDITHISTORY
AS
	SELECT
		AUDIT.AUDIT_ID AS AUDIT_AUDIT_ID,
		AUDIT.DATE AS AUDIT_DATE,
		AUDIT.USER AS AUDIT_USER,
		AUDIT.AUDIT_TYPE AS AUDIT_AUDIT_TYPE,
		AUDIT.DESCRIPTION AS AUDIT_DESCRIPTION,
		AUDIT.ENTITY_TYPE AS AUDIT_ENTITY_TYPE,
		AUDIT.OBJECT_ID AS AUDIT_OBJECT_ID,
		AUDIT.PERSON_ID AS AUDIT_PERSON_ID,
		AUDIT.SITE_NAME AS AUDIT_SITE_NAME
	FROM AUDIT
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Audit History');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Audit History', 0, 'VW_AUDITHISTORY', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();

-- ***********************************************************************
-- Audit History Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Audit History Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Audit History ID
CALL INSERTREPORTFIELD('AUDIT_AUDIT_ID', 'Audit History ID', b'1', 3, @REPORTFIELDGROUP_ID);

-- Date
CALL INSERTREPORTFIELD('AUDIT_DATE', 'Date', b'1', 4, @REPORTFIELDGROUP_ID);

-- User
CALL INSERTREPORTFIELD('AUDIT_USER', 'User', b'1', 1, @REPORTFIELDGROUP_ID);

-- Type
CALL INSERTREPORTFIELD('AUDIT_AUDIT_TYPE', 'Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Description
CALL INSERTREPORTFIELD('AUDIT_DESCRIPTION', 'Description', b'1', 1, @REPORTFIELDGROUP_ID);

-- Object Type
CALL INSERTREPORTFIELD('AUDIT_ENTITY_TYPE', 'Object Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Object ID
CALL INSERTREPORTFIELD('AUDIT_OBJECT_ID', 'Object ID', b'1', 3, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('AUDIT_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Address Audit History View & Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_AUDITHISTORY_ADDRESSES;
CREATE VIEW VW_AUDITHISTORY_ADDRESSES
AS
	SELECT
		VW_AUDITHISTORY.AUDIT_AUDIT_ID,
		VW_AUDITHISTORY.AUDIT_DATE,
		VW_AUDITHISTORY.AUDIT_USER,
		VW_AUDITHISTORY.AUDIT_AUDIT_TYPE,
		VW_AUDITHISTORY.AUDIT_DESCRIPTION,
		VW_AUDITHISTORY.AUDIT_ENTITY_TYPE,
		VW_AUDITHISTORY.AUDIT_OBJECT_ID,
		VW_AUDITHISTORY.AUDIT_PERSON_ID,
		VW_AUDITHISTORY.AUDIT_SITE_NAME,

		-- Address Information
		ADDRESS.ADDRESS_ID AS ADDRESS_ADDRESS_ID,
		ADDRESS.PERSON_ID AS ADDRESS_PERSON_ID,
		ADDRESS.ADDRESS_TYPE AS ADDRESS_ADDRESS_TYPE,
		ADDRESS.ACTIVATION_STATUS AS ADDRESS_ACTIVATION_STATUS,
		ADDRESS.EFFECTIVE_DATE AS ADDRESS_EFFECTIVE_DATE,
		ADDRESS.ADDRESS_LINE_1 AS ADDRESS_ADDRESS_LINE_1,
		ADDRESS.ADDRESS_LINE_2 AS ADDRESS_ADDRESS_LINE_2,
		ADDRESS.ADDRESS_LINE_3 AS ADDRESS_ADDRESS_LINE_3,
		ADDRESS.CITY AS ADDRESS_CITY,
		ADDRESS.STATE_PROVINCE AS ADDRESS_STATE_PROVINCE,
		ADDRESS.COUNTRY AS ADDRESS_COUNTRY,
		ADDRESS.POSTAL_CODE AS ADDRESS_POSTAL_CODE,
		ADDRESS.RECEIVE_CORRESPONDENCE AS ADDRESS_RECEIVE_CORRESPONDENCE,
		ADDRESS.COMMENT AS ADDRESS_COMMENT,
		ADDRESS.SEASONAL_END_DATE AS ADDRESS_SEASONAL_END_DATE,
		ADDRESS.SEASONAL_START_DATE AS ADDRESS_SEASONAL_START_DATE,
		ADDRESS.TEMPORARY_END_DATE AS ADDRESS_TEMPORARY_END_DATE,
		ADDRESS.TEMPORARY_START_DATE AS ADDRESS_TEMPORARY_START_DATE,
		ADDRESS.CREATE_DATE AS ADDRESS_CREATE_DATE,
		ADDRESS.UPDATE_DATE AS ADDRESS_UPDATE_DATE,
		ADDRESS.INACTIVE AS ADDRESS_INACTIVE
	FROM VW_AUDITHISTORY
	LEFT JOIN ADDRESS ON VW_AUDITHISTORY.AUDIT_OBJECT_ID = ADDRESS.ADDRESS_ID
	WHERE VW_AUDITHISTORY.AUDIT_ENTITY_TYPE = 'address'
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Audit History');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Address Audit History', 0, 'VW_AUDITHISTORY_ADDRESSES', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();

-- ***********************************************************************
-- Audit History Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Audit History Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Audit History ID
CALL INSERTREPORTFIELD('AUDIT_AUDIT_ID', 'Audit History ID', b'1', 3, @REPORTFIELDGROUP_ID);

-- Date
CALL INSERTREPORTFIELD('AUDIT_DATE', 'Date', b'1', 4, @REPORTFIELDGROUP_ID);

-- User
CALL INSERTREPORTFIELD('AUDIT_USER', 'User', b'1', 1, @REPORTFIELDGROUP_ID);

-- Type
CALL INSERTREPORTFIELD('AUDIT_AUDIT_TYPE', 'Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Description
CALL INSERTREPORTFIELD('AUDIT_DESCRIPTION', 'Description', b'1', 1, @REPORTFIELDGROUP_ID);

-- Object Type
CALL INSERTREPORTFIELD('AUDIT_ENTITY_TYPE', 'Object Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Object ID
CALL INSERTREPORTFIELD('AUDIT_OBJECT_ID', 'Object ID', b'0', 3, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('AUDIT_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Address Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Address Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('ADDRESS_PERSON_ID', 'Account Number', b'0', 3, @REPORTFIELDGROUP_ID);

-- Account Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(ADDRESS_PERSON_ID)', 'Account Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address ID
CALL INSERTREPORTFIELD('ADDRESS_ADDRESS_ID', 'Address ID', b'1', 3, @REPORTFIELDGROUP_ID);

-- Address Type
CALL INSERTREPORTFIELD('ADDRESS_ADDRESS_TYPE', 'Address Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Status
CALL INSERTREPORTFIELD('ADDRESS_ACTIVATION_STATUS', 'Address Status', b'0', 1, @REPORTFIELDGROUP_ID);

-- Effective Date
CALL INSERTREPORTFIELD('ADDRESS_EFFECTIVE_DATE', 'Address Effective Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Seasonal Start Date
CALL INSERTREPORTFIELD('ADDRESS_SEASONAL_START_DATE', 'Seasonal Start Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Seasonal End Date
CALL INSERTREPORTFIELD('ADDRESS_SEASONAL_END_DATE', 'Seasonal End Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Temporary Start Date
CALL INSERTREPORTFIELD('ADDRESS_TEMPORARY_START_DATE', 'Temporary Start Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Temporary End Date
CALL INSERTREPORTFIELD('ADDRESS_TEMPORARY_END_DATE', 'Temporary End Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Address Line 1
CALL INSERTREPORTFIELD('ADDRESS_ADDRESS_LINE_1', 'Address Line 1', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 2
CALL INSERTREPORTFIELD('ADDRESS_ADDRESS_LINE_2', 'Address Line 2', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 3
CALL INSERTREPORTFIELD('ADDRESS_ADDRESS_LINE_3', 'Address Line 2', b'0', 1, @REPORTFIELDGROUP_ID);

-- City
CALL INSERTREPORTFIELD('ADDRESS_CITY', 'City', b'0', 1, @REPORTFIELDGROUP_ID);

-- State/Province
CALL INSERTREPORTFIELD('ADDRESS_STATE_PROVINCE', 'State/Province', b'0', 1, @REPORTFIELDGROUP_ID);

-- Country
CALL INSERTREPORTFIELD('ADDRESS_COUNTRY', 'Country', b'0', 1, @REPORTFIELDGROUP_ID);

-- Zip/Postal Code
CALL INSERTREPORTFIELD('ADDRESS_POSTAL_CODE', 'Zip/Postal Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Receive Correspondence
CALL INSERTREPORTFIELD('ADDRESS_RECEIVE_CORRESPONDENCE', 'Receive Correspondence', b'0', 6, @REPORTFIELDGROUP_ID);

-- Comments
CALL INSERTREPORTFIELD('ADDRESS_COMMENT', 'Comments', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Create Date
CALL INSERTREPORTFIELD('ADDRESS_CREATE_DATE', 'Address Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Address Update Date
CALL INSERTREPORTFIELD('ADDRESS_UPDATE_DATE', 'Address Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Address Inactive
CALL INSERTREPORTFIELD('ADDRESS_INACTIVE', 'Address Inactive', b'0', 6, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Constituents Audit History View & Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_AUDITHISTORY_CONSTITUENTS;
CREATE VIEW VW_AUDITHISTORY_CONSTITUENTS
AS
	SELECT
		VW_AUDITHISTORY.AUDIT_AUDIT_ID,
		VW_AUDITHISTORY.AUDIT_DATE,
		VW_AUDITHISTORY.AUDIT_USER,
		VW_AUDITHISTORY.AUDIT_AUDIT_TYPE,
		VW_AUDITHISTORY.AUDIT_DESCRIPTION,
		VW_AUDITHISTORY.AUDIT_ENTITY_TYPE,
		VW_AUDITHISTORY.AUDIT_OBJECT_ID,
		VW_AUDITHISTORY.AUDIT_PERSON_ID,
		VW_AUDITHISTORY.AUDIT_SITE_NAME,

		VW_CONSTITUENTS.PERSON_PERSON_ID,
		VW_CONSTITUENTS.PERSON_CONSTITUENT_ROLES,
		VW_CONSTITUENTS.PERSON_CONSTITUENT_ROLE,
		VW_CONSTITUENTS.PERSON_CONSTITUENT_TYPE,
		VW_CONSTITUENTS.PERSON_CREATE_DATE,
		VW_CONSTITUENTS.PERSON_FIRST_NAME,
		VW_CONSTITUENTS.PERSON_LAPSED_DONOR,
		VW_CONSTITUENTS.PERSON_LAST_NAME,
		VW_CONSTITUENTS.PERSON_LEGAL_NAME,
		VW_CONSTITUENTS.PERSON_LOGIN_ID,
		VW_CONSTITUENTS.PERSON_MAJOR_DONOR,
		VW_CONSTITUENTS.PERSON_MARITAL_STATUS,
		VW_CONSTITUENTS.PERSON_MIDDLE_NAME,
		VW_CONSTITUENTS.PERSON_NCAIS_CODE,
		VW_CONSTITUENTS.PERSON_ORGANIZATION_NAME,
		VW_CONSTITUENTS.PERSON_PREFERRED_PHONE_TYPE,
		VW_CONSTITUENTS.PERSON_RECOGNITION_NAME,
		VW_CONSTITUENTS.PERSON_SUFFIX,
		VW_CONSTITUENTS.PERSON_TITLE,
		VW_CONSTITUENTS.PERSON_UPDATE_DATE,
		VW_CONSTITUENTS.PERSON_SITE_NAME
	FROM VW_AUDITHISTORY
	LEFT JOIN VW_CONSTITUENTS ON VW_CONSTITUENTS.PERSON_PERSON_ID = VW_AUDITHISTORY.AUDIT_OBJECT_ID
	WHERE VW_AUDITHISTORY.AUDIT_ENTITY_TYPE = 'person'
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Audit History');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Constituent Audit History', 0, 'VW_AUDITHISTORY_CONSTITUENTS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();

-- ***********************************************************************
-- Audit History Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Audit History Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Audit History ID
CALL INSERTREPORTFIELD('AUDIT_AUDIT_ID', 'Audit History ID', b'1', 3, @REPORTFIELDGROUP_ID);

-- Date
CALL INSERTREPORTFIELD('AUDIT_DATE', 'Date', b'1', 4, @REPORTFIELDGROUP_ID);

-- User
CALL INSERTREPORTFIELD('AUDIT_USER', 'User', b'1', 1, @REPORTFIELDGROUP_ID);

-- Type
CALL INSERTREPORTFIELD('AUDIT_AUDIT_TYPE', 'Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Description
CALL INSERTREPORTFIELD('AUDIT_DESCRIPTION', 'Description', b'1', 1, @REPORTFIELDGROUP_ID);

-- Object Type
CALL INSERTREPORTFIELD('AUDIT_ENTITY_TYPE', 'Object Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Object ID
CALL INSERTREPORTFIELD('AUDIT_OBJECT_ID', 'Object ID', b'0', 3, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('AUDIT_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Contact Details Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Contact Details', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('PERSON_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Manager Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager''))', 'Account Manager Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Account Manager Account Number
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager'')', 'Account Manager Account Number', b'0', 3, @REPORTFIELDGROUP_ID);

-- Constituent Type
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_TYPE', 'Constituent Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLES', 'Profile Types', b'0', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLE', 'Profile Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Title
CALL INSERTREPORTFIELD('PERSON_TITLE', 'Title', b'0', 1, @REPORTFIELDGROUP_ID);

-- First Name
CALL INSERTREPORTFIELD('PERSON_FIRST_NAME', 'First Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Middle Name
CALL INSERTREPORTFIELD('PERSON_MIDDLE_NAME', 'Middle Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Name
CALL INSERTREPORTFIELD('PERSON_LAST_NAME', 'Last Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Suffix
CALL INSERTREPORTFIELD('PERSON_SUFFIX', 'Suffix', b'0', 1, @REPORTFIELDGROUP_ID);

-- Recognition Name
CALL INSERTREPORTFIELD('PERSON_RECOGNITION_NAME', 'Recognition Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Organization Name
CALL INSERTREPORTFIELD('PERSON_ORGANIZATION_NAME', 'Organization Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Legal Name
CALL INSERTREPORTFIELD('PERSON_LEGAL_NAME', 'Legal Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.matching'')', 'Matching', b'0', 1, @REPORTFIELDGROUP_ID);

-- Percent Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.percentMatch'')', 'Percent Matching', b'0', 3, @REPORTFIELDGROUP_ID);

-- Maximum Match
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.maximumMatch'')', 'Maximum Match', b'0', 5, @REPORTFIELDGROUP_ID);

-- Website
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.website'')', 'Website', b'0', 1, @REPORTFIELDGROUP_ID);

-- Tax ID
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.taxid'')', 'Tax ID', b'0', 1, @REPORTFIELDGROUP_ID);

-- NCAIS Code
CALL INSERTREPORTFIELD('PERSON_NCAIS_CODE', 'NCAIS Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Communication Preferences
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''communicationPreferences'')', 'Communication Preferences', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Format
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''emailFormat'')', 'Email Format', b'0', 1, @REPORTFIELDGROUP_ID);

-- Create Date
CALL INSERTREPORTFIELD('PERSON_CREATE_DATE', 'Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Update Date
CALL INSERTREPORTFIELD('PERSON_UPDATE_DATE', 'Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Demographic Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Demographic Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Marital Status
CALL INSERTREPORTFIELD('PERSON_MARITAL_STATUS', 'Marital Status', b'0', 3, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.birthDate'')', 'Birth Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Deceased
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.deceased'')', 'Deceased', b'0', 6, @REPORTFIELDGROUP_ID);

-- Gender
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.gender'')', 'Gender', b'0', 1, @REPORTFIELDGROUP_ID);

-- Race
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.race'')', 'Race', b'0', 1, @REPORTFIELDGROUP_ID);

-- Military
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.military'')', 'Military', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Miscellaneous Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Miscellaneous Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Major Donor
CALL INSERTREPORTFIELD('PERSON_MAJOR_DONOR', 'Major Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Lapsed Donor
CALL INSERTREPORTFIELD('PERSON_LAPSED_DONOR', 'Lapsed Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('PERSON_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Email Addresses Audit History View & Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_AUDITHISTORY_EMAILADDRESSES;
CREATE VIEW VW_AUDITHISTORY_EMAILADDRESSES
AS
	SELECT
		VW_AUDITHISTORY.AUDIT_AUDIT_ID,
		VW_AUDITHISTORY.AUDIT_DATE,
		VW_AUDITHISTORY.AUDIT_USER,
		VW_AUDITHISTORY.AUDIT_AUDIT_TYPE,
		VW_AUDITHISTORY.AUDIT_DESCRIPTION,
		VW_AUDITHISTORY.AUDIT_ENTITY_TYPE,
		VW_AUDITHISTORY.AUDIT_OBJECT_ID,
		VW_AUDITHISTORY.AUDIT_PERSON_ID,
		VW_AUDITHISTORY.AUDIT_SITE_NAME,

		-- Email Information
		EMAIL.EMAIL_ID AS EMAIL_EMAIL_ID,
		EMAIL.PERSON_ID AS EMAIL_PERSON_ID,
		EMAIL.EMAIL_TYPE AS EMAIL_EMAIL_TYPE,
		EMAIL.ACTIVATION_STATUS AS EMAIL_ACTIVATION_STATUS,
		EMAIL.EFFECTIVE_DATE AS EMAIL_EFFECTIVE_DATE,
		EMAIL.SEASONAL_START_DATE AS EMAIL_SEASONAL_START_DATE,
		EMAIL.SEASONAL_END_DATE AS EMAIL_SEASONAL_END_DATE,
		EMAIL.TEMPORARY_START_DATE AS EMAIL_TEMPORARY_START_DATE,
		EMAIL.TEMPORARY_END_DATE AS EMAIL_TEMPORARY_END_DATE,
		EMAIL.EMAIL_ADDRESS AS EMAIL_EMAIL_ADDRESS,
		EMAIL.EMAIL_DISPLAY AS EMAIL_EMAIL_DISPLAY,
		EMAIL.RECEIVE_CORRESPONDENCE AS EMAIL_RECEIVE_CORRESPONDENCE,
		EMAIL.COMMENT AS EMAIL_COMMENT,
		EMAIL.CREATE_DATE AS EMAIL_CREATE_DATE,
		EMAIL.UPDATE_DATE AS EMAIL_UPDATE_DATE,
		EMAIL.INACTIVE AS EMAIL_INACTIVE
	FROM VW_AUDITHISTORY
	LEFT JOIN EMAIL ON VW_AUDITHISTORY.AUDIT_OBJECT_ID = EMAIL.EMAIL_ID
	WHERE VW_AUDITHISTORY.AUDIT_ENTITY_TYPE = 'email'
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Audit History');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Email Address Audit History', 0, 'VW_AUDITHISTORY_EMAILADDRESSES', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();

-- ***********************************************************************
-- Audit History Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Audit History Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Audit History ID
CALL INSERTREPORTFIELD('AUDIT_AUDIT_ID', 'Audit History ID', b'1', 3, @REPORTFIELDGROUP_ID);

-- Date
CALL INSERTREPORTFIELD('AUDIT_DATE', 'Date', b'1', 4, @REPORTFIELDGROUP_ID);

-- User
CALL INSERTREPORTFIELD('AUDIT_USER', 'User', b'1', 1, @REPORTFIELDGROUP_ID);

-- Type
CALL INSERTREPORTFIELD('AUDIT_AUDIT_TYPE', 'Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Description
CALL INSERTREPORTFIELD('AUDIT_DESCRIPTION', 'Description', b'1', 1, @REPORTFIELDGROUP_ID);

-- Object Type
CALL INSERTREPORTFIELD('AUDIT_ENTITY_TYPE', 'Object Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Object ID
CALL INSERTREPORTFIELD('AUDIT_OBJECT_ID', 'Object ID', b'0', 3, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('AUDIT_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Email Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Email Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Email Address ID
CALL INSERTREPORTFIELD('EMAIL_EMAIL_ID', 'Email Address ID', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('EMAIL_PERSON_ID', 'Account Number', b'0', 3, @REPORTFIELDGROUP_ID);

-- Account Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(EMAIL_PERSON_ID)', 'Account Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Type
CALL INSERTREPORTFIELD('EMAIL_EMAIL_TYPE', 'Email Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Status
CALL INSERTREPORTFIELD('EMAIL_ACTIVATION_STATUS', 'Email Status', b'0', 1, @REPORTFIELDGROUP_ID);

-- Effective Date
CALL INSERTREPORTFIELD('EMAIL_EFFECTIVE_DATE', 'Effective Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Seasonal Start Date
CALL INSERTREPORTFIELD('EMAIL_SEASONAL_START_DATE', 'Seasonal Start Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Seasonal End Date
CALL INSERTREPORTFIELD('EMAIL_SEASONAL_END_DATE', 'Seasonal End Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Temporary Start Date
CALL INSERTREPORTFIELD('EMAIL_TEMPORARY_START_DATE', 'Temporary Start Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Temporary End Date
CALL INSERTREPORTFIELD('EMAIL_TEMPORARY_END_DATE', 'Temporary End Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Email Address
CALL INSERTREPORTFIELD('EMAIL_EMAIL_ADDRESS', 'Email Address', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Display
CALL INSERTREPORTFIELD('EMAIL_EMAIL_DISPLAY', 'Email Display', b'0', 1, @REPORTFIELDGROUP_ID);

-- Receive Correspondence
CALL INSERTREPORTFIELD('EMAIL_RECEIVE_CORRESPONDENCE', 'Receive Correspondence', b'0', 6, @REPORTFIELDGROUP_ID);

-- Comments
CALL INSERTREPORTFIELD('EMAIL_COMMENT', 'Comments', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Address Create Date
CALL INSERTREPORTFIELD('EMAIL_CREATE_DATE', 'Email Address Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Email Address Update Date
CALL INSERTREPORTFIELD('EMAIL_UPDATE_DATE', 'Email Address Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Email Address Inactive
CALL INSERTREPORTFIELD('EMAIL_INACTIVE', 'Email Address Inactive', b'0', 6, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Gift Audit History View & Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_AUDITHISTORY_GIFTS;
CREATE VIEW VW_AUDITHISTORY_GIFTS
AS
	SELECT
		VW_AUDITHISTORY.AUDIT_AUDIT_ID,
		VW_AUDITHISTORY.AUDIT_DATE,
		VW_AUDITHISTORY.AUDIT_USER,
		VW_AUDITHISTORY.AUDIT_AUDIT_TYPE,
		VW_AUDITHISTORY.AUDIT_DESCRIPTION,
		VW_AUDITHISTORY.AUDIT_ENTITY_TYPE,
		VW_AUDITHISTORY.AUDIT_OBJECT_ID,
		VW_AUDITHISTORY.AUDIT_PERSON_ID,
		VW_AUDITHISTORY.AUDIT_SITE_NAME,

		GIFT_PERSON_ID,
		GIFT_GIFT_ID,
		GIFT_AMOUNT,
		GIFT_CURRENCY_CODE,
		GIFT_DONATION_DATE,
		GIFT_POSTMARK_DATE,
		GIFT_COMMENTS,
		GIFT_TRANSACTIONDATE,
		GIFT_PAYMENT_SOURCE_PAYMENT_PROFILE_DESCRIPTION,
		GIFT_PAYMENT_SOURCE_PAYMENT_TYPE,
		GIFT_PAYMENT_SOURCE_CREDIT_CARD_TYPE,
		GIFT_PAYMENT_SOURCE_CREDIT_CARD_HOLDER_NAME,
		GIFT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION,
		GIFT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION_DATE,
		GIFT_PAYMENT_SOURCE_ACH_HOLDER_NAME,
		GIFT_PAYMENT_SOURCE_ACH_ROUTING_NUMBER,
		GIFT_CHECK_NUMBER,
		GIFT_AUTH_CODE,
		GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_1,
		GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_2,
		GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_3,
		GIFT_PAYMENT_ADDRESS_CITY,
		GIFT_PAYMENT_ADDRESS_STATE_PROVINCE,
		GIFT_PAYMENT_ADDRESS_POSTAL_CODE,
		GIFT_PAYMENT_ADDRESS_COUNTRY,
		GIFT_PAYMENT_PHONE_NUMBER,
		GIFT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS,
		GIFT_SEND_ACKNOWLEDGMENT,
		GIFT_ACKNOWLEDGMENT_DATE
	FROM VW_AUDITHISTORY
	LEFT JOIN VW_GIFTS ON VW_AUDITHISTORY.AUDIT_OBJECT_ID = VW_GIFTS.GIFT_GIFT_ID
	WHERE VW_AUDITHISTORY.AUDIT_ENTITY_TYPE = 'gift'
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Audit History');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Gift Audit History', 0, 'VW_AUDITHISTORY_GIFTS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();

-- ***********************************************************************
-- Audit History Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Audit History Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Audit History ID
CALL INSERTREPORTFIELD('AUDIT_AUDIT_ID', 'Audit History ID', b'1', 3, @REPORTFIELDGROUP_ID);

-- Date
CALL INSERTREPORTFIELD('AUDIT_DATE', 'Date', b'1', 4, @REPORTFIELDGROUP_ID);

-- User
CALL INSERTREPORTFIELD('AUDIT_USER', 'User', b'1', 1, @REPORTFIELDGROUP_ID);

-- Type
CALL INSERTREPORTFIELD('AUDIT_AUDIT_TYPE', 'Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Description
CALL INSERTREPORTFIELD('AUDIT_DESCRIPTION', 'Description', b'1', 1, @REPORTFIELDGROUP_ID);

-- Object Type
CALL INSERTREPORTFIELD('AUDIT_ENTITY_TYPE', 'Object Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Object ID
CALL INSERTREPORTFIELD('AUDIT_OBJECT_ID', 'Object ID', b'0', 3, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('AUDIT_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Gift Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Gift Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Gift Reference Number
CALL INSERTREPORTFIELD('GIFT_GIFT_ID', 'Gift Reference Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('GIFT_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GIFT_PERSON_ID)', 'Account Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Gift Amount
CALL INSERTREPORTFIELD('GIFT_AMOUNT', 'Gift Amount', b'1', 5, @REPORTFIELDGROUP_ID);

-- Currency Code
CALL INSERTREPORTFIELD('GIFT_CURRENCY_CODE', 'Currency Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Donation Date
CALL INSERTREPORTFIELD('GIFT_DONATION_DATE', 'Donation Date', b'1', 4, @REPORTFIELDGROUP_ID);

-- Postmark Date
CALL INSERTREPORTFIELD('GIFT_POSTMARK_DATE', 'Postmark Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Reference Account Number
CALL INSERTREPORTFIELD('GETGIFTCUSTOMFIELD(GIFT_GIFT_ID, ''reference'')', 'Reference Account Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Reference Account Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETGIFTCUSTOMFIELD(GIFT_GIFT_ID, ''reference''))', 'Reference Account Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Comments
CALL INSERTREPORTFIELD('GIFT_COMMENTS', 'Comments', b'0', 1, @REPORTFIELDGROUP_ID);

-- Transaction Date
CALL INSERTREPORTFIELD('GIFT_TRANSACTIONDATE', 'Transaction Date', b'0', 4, @REPORTFIELDGROUP_ID);


-- ***********************************************************************
-- Payment Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Payment Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Payment Profile Description
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_PAYMENT_PROFILE_DESCRIPTION', 'Payment Profile Description', b'0', 1, @REPORTFIELDGROUP_ID);

-- Payment Method
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_PAYMENT_TYPE', 'Payment Method', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Type
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_CREDIT_CARD_TYPE', 'Credit Card Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Holder Name
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_CREDIT_CARD_HOLDER_NAME', 'Credit Card Holder Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Expiration
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION', 'Credit Card Expiration', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Expiration (Date / Time)
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION_DATE', 'Credit Card Expiration (Date / Time)', b'0', 4, @REPORTFIELDGROUP_ID);

-- ACH Holder Name
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_ACH_HOLDER_NAME', 'ACH Holder Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ACH Routing Number
CALL INSERTREPORTFIELD('GIFT_PAYMENT_SOURCE_ACH_ROUTING_NUMBER', 'ACH Routing Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Check Number
CALL INSERTREPORTFIELD('GIFT_CHECK_NUMBER', 'Check Number', b'0', 2, @REPORTFIELDGROUP_ID);

-- Authorization Code
CALL INSERTREPORTFIELD('GIFT_AUTH_CODE', 'Authorization Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 1
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_1', 'Address Line 1', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 2
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_2', 'Address Line 2', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 3
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_ADDRESS_LINE_3', 'Address Line 2', b'0', 1, @REPORTFIELDGROUP_ID);

-- City
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_CITY', 'City', b'0', 1, @REPORTFIELDGROUP_ID);

-- State/Province
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_STATE_PROVINCE', 'State/Province', b'0', 1, @REPORTFIELDGROUP_ID);

-- Zip/Postal Code
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_POSTAL_CODE', 'Zip/Postal Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Country
CALL INSERTREPORTFIELD('GIFT_PAYMENT_ADDRESS_COUNTRY', 'Country', b'0', 1, @REPORTFIELDGROUP_ID);

-- Phone Number
CALL INSERTREPORTFIELD('GIFT_PAYMENT_PHONE_NUMBER', 'Phone Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Acknowledgment Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Acknowledgment Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Receipt Email
CALL INSERTREPORTFIELD('GIFT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS', 'Receipt Email', b'0', 1, @REPORTFIELDGROUP_ID);

-- Send Acknowledgment
CALL INSERTREPORTFIELD('GIFT_SEND_ACKNOWLEDGMENT', 'Send Acknowledgment', b'0', 6, @REPORTFIELDGROUP_ID);

-- Acknowledgment Date
CALL INSERTREPORTFIELD('GIFT_ACKNOWLEDGMENT_DATE', 'Acknowledgment Date', b'0', 4, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Payment Method Audit History View & Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_AUDITHISTORY_PAYMENTMETHODS;
CREATE VIEW VW_AUDITHISTORY_PAYMENTMETHODS
AS
	SELECT
		VW_AUDITHISTORY.AUDIT_AUDIT_ID,
		VW_AUDITHISTORY.AUDIT_DATE,
		VW_AUDITHISTORY.AUDIT_USER,
		VW_AUDITHISTORY.AUDIT_AUDIT_TYPE,
		VW_AUDITHISTORY.AUDIT_DESCRIPTION,
		VW_AUDITHISTORY.AUDIT_ENTITY_TYPE,
		VW_AUDITHISTORY.AUDIT_OBJECT_ID,
		VW_AUDITHISTORY.AUDIT_PERSON_ID,
		VW_AUDITHISTORY.AUDIT_SITE_NAME,

		PAYMENT_SOURCE_PAYMENT_SOURCE_ID,
		PAYMENT_SOURCE_PERSON_ID,
		PAYMENT_SOURCE_PAYMENT_PROFILE_DESCRIPTION,
		PAYMENT_SOURCE_PAYMENT_TYPE,
		PAYMENT_SOURCE_CREDIT_CARD_HOLDER_NAME,
		PAYMENT_SOURCE_CREDIT_CARD_TYPE,
		PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION,
		PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION_DATE,
		PAYMENT_SOURCE_ACH_HOLDER_NAME,
		PAYMENT_SOURCE_ACH_ROUTING_NUMBER,
		PAYMENT_SOURCE_ADDRESS_ADDRESS_LINE_1,
		PAYMENT_SOURCE_ADDRESS_ADDRESS_LINE_2,
		PAYMENT_SOURCE_ADDRESS_ADDRESS_LINE_3,
		PAYMENT_SOURCE_ADDRESS_CITY,
		PAYMENT_SOURCE_ADDRESS_STATE_PROVINCE,
		PAYMENT_SOURCE_ADDRESS_POSTAL_CODE,
		PAYMENT_SOURCE_ADDRESS_COUNTRY,
		PAYMENT_SOURCE_PHONE_NUMBER
	FROM VW_AUDITHISTORY
	LEFT JOIN VW_PAYMENTMETHODS ON VW_AUDITHISTORY.AUDIT_OBJECT_ID = VW_PAYMENTMETHODS.PAYMENT_SOURCE_PAYMENT_SOURCE_ID
	WHERE VW_AUDITHISTORY.AUDIT_ENTITY_TYPE = 'paymentsource'
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Audit History');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Payment Method Audit History', 0, 'VW_AUDITHISTORY_PAYMENTMETHODS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();

-- ***********************************************************************
-- Audit History Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Audit History Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Audit History ID
CALL INSERTREPORTFIELD('AUDIT_AUDIT_ID', 'Audit History ID', b'1', 3, @REPORTFIELDGROUP_ID);

-- Date
CALL INSERTREPORTFIELD('AUDIT_DATE', 'Date', b'1', 4, @REPORTFIELDGROUP_ID);

-- User
CALL INSERTREPORTFIELD('AUDIT_USER', 'User', b'1', 1, @REPORTFIELDGROUP_ID);

-- Type
CALL INSERTREPORTFIELD('AUDIT_AUDIT_TYPE', 'Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Description
CALL INSERTREPORTFIELD('AUDIT_DESCRIPTION', 'Description', b'1', 1, @REPORTFIELDGROUP_ID);

-- Object Type
CALL INSERTREPORTFIELD('AUDIT_ENTITY_TYPE', 'Object Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Object ID
CALL INSERTREPORTFIELD('AUDIT_OBJECT_ID', 'Object ID', b'0', 3, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('AUDIT_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Payment Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Payment Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Payment Method ID
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_PAYMENT_SOURCE_ID', 'Payment Method ID', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_PERSON_ID', 'Account Number', b'0', 3, @REPORTFIELDGROUP_ID);

-- Account Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(PAYMENT_SOURCE_PERSON_ID)', 'Account Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Payment Profile Description
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_PAYMENT_PROFILE_DESCRIPTION', 'Payment Profile Description', b'0', 1, @REPORTFIELDGROUP_ID);

-- Payment Method
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_PAYMENT_TYPE', 'Payment Method', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Holder Name
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_CREDIT_CARD_HOLDER_NAME', 'Credit Card Holder Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Type
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_CREDIT_CARD_TYPE', 'Credit Card Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Expiration
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION', 'Credit Card Expiration', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Expiration (Date / Time)
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION_DATE', 'Credit Card Expiration (Date / Time)', b'0', 4, @REPORTFIELDGROUP_ID);

-- ACH Holder Name
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_ACH_HOLDER_NAME', 'ACH Holder Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ACH Routing Number
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_ACH_ROUTING_NUMBER', 'ACH Routing Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Default Address/Phone Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Default Address/Phone Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Address Line 1
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_ADDRESS_ADDRESS_LINE_1', 'Address Line 1', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 2
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_ADDRESS_ADDRESS_LINE_2', 'Address Line 2', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 3
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_ADDRESS_ADDRESS_LINE_3', 'Address Line 3', b'0', 1, @REPORTFIELDGROUP_ID);

-- City
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_ADDRESS_CITY', 'City', b'0', 1, @REPORTFIELDGROUP_ID);

-- State/Province
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_ADDRESS_STATE_PROVINCE', 'State/Province', b'0', 1, @REPORTFIELDGROUP_ID);

-- Zip/Postal Code
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_ADDRESS_POSTAL_CODE', 'Zip/Postal Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Country
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_ADDRESS_COUNTRY', 'Country', b'0', 1, @REPORTFIELDGROUP_ID);

-- Phone Number
CALL INSERTREPORTFIELD('PAYMENT_SOURCE_PHONE_NUMBER', 'Phone Number', b'0', 1, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Phone Number Audit History View & Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_AUDITHISTORY_PHONENUMBERS;
CREATE VIEW VW_AUDITHISTORY_PHONENUMBERS
AS
	SELECT
		VW_AUDITHISTORY.AUDIT_AUDIT_ID,
		VW_AUDITHISTORY.AUDIT_DATE,
		VW_AUDITHISTORY.AUDIT_USER,
		VW_AUDITHISTORY.AUDIT_AUDIT_TYPE,
		VW_AUDITHISTORY.AUDIT_DESCRIPTION,
		VW_AUDITHISTORY.AUDIT_ENTITY_TYPE,
		VW_AUDITHISTORY.AUDIT_OBJECT_ID,
		VW_AUDITHISTORY.AUDIT_PERSON_ID,
		VW_AUDITHISTORY.AUDIT_SITE_NAME,

		-- Phone Number Information
		PHONE.PHONE_ID AS PHONE_PHONE_ID,
		PHONE.PERSON_ID AS PHONE_PERSON_ID,
		PHONE.PHONE_TYPE AS PHONE_PHONE_TYPE,
		PHONE.ACTIVATION_STATUS AS PHONE_ACTIVATION_STATUS,
		PHONE.EFFECTIVE_DATE AS PHONE_EFFECTIVE_DATE,
		PHONE.SEASONAL_START_DATE AS PHONE_SEASONAL_START_DATE,
		PHONE.SEASONAL_END_DATE AS PHONE_SEASONAL_END_DATE,
		PHONE.TEMPORARY_START_DATE AS PHONE_TEMPORARY_START_DATE,
		PHONE.TEMPORARY_END_DATE AS PHONE_TEMPORARY_END_DATE,
		PHONE.NUMBER AS PHONE_NUMBER,
		PHONE.PROVIDER AS PHONE_PROVIDER,
		PHONE.SMS AS PHONE_SMS,
		PHONE.RECEIVE_CORRESPONDENCE AS PHONE_RECEIVE_CORRESPONDENCE,
		PHONE.COMMENT AS PHONE_COMMENT,
		PHONE.CREATE_DATE AS PHONE_CREATE_DATE,
		PHONE.UPDATE_DATE AS PHONE_UPDATE_DATE,
		PHONE.INACTIVE AS PHONE_INACTIVE
	FROM VW_AUDITHISTORY
	LEFT JOIN PHONE ON VW_AUDITHISTORY.AUDIT_OBJECT_ID = PHONE.PHONE_ID
	WHERE VW_AUDITHISTORY.AUDIT_ENTITY_TYPE = 'phone'
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Audit History');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Phone Number Audit History', 0, 'VW_AUDITHISTORY_PHONENUMBERS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();

-- ***********************************************************************
-- Audit History Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Audit History Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Audit History ID
CALL INSERTREPORTFIELD('AUDIT_AUDIT_ID', 'Audit History ID', b'1', 3, @REPORTFIELDGROUP_ID);

-- Date
CALL INSERTREPORTFIELD('AUDIT_DATE', 'Date', b'1', 4, @REPORTFIELDGROUP_ID);

-- User
CALL INSERTREPORTFIELD('AUDIT_USER', 'User', b'1', 1, @REPORTFIELDGROUP_ID);

-- Type
CALL INSERTREPORTFIELD('AUDIT_AUDIT_TYPE', 'Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Description
CALL INSERTREPORTFIELD('AUDIT_DESCRIPTION', 'Description', b'1', 1, @REPORTFIELDGROUP_ID);

-- Object Type
CALL INSERTREPORTFIELD('AUDIT_ENTITY_TYPE', 'Object Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Object ID
CALL INSERTREPORTFIELD('AUDIT_OBJECT_ID', 'Object ID', b'0', 3, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('AUDIT_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Phone Number Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Phone Number Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Phone Number ID
CALL INSERTREPORTFIELD('PHONE_PHONE_ID', 'Phone Number ID', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('PHONE_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(PHONE_PERSON_ID)', 'Account Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Phone Type
CALL INSERTREPORTFIELD('PHONE_PHONE_TYPE', 'Phone Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Phone Status
CALL INSERTREPORTFIELD('PHONE_ACTIVATION_STATUS', 'Phone Status', b'0', 1, @REPORTFIELDGROUP_ID);

-- Effective Date
CALL INSERTREPORTFIELD('PHONE_EFFECTIVE_DATE', 'Effective Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Seasonal Start Date
CALL INSERTREPORTFIELD('PHONE_SEASONAL_START_DATE', 'Seasonal Start Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Seasonal End Date
CALL INSERTREPORTFIELD('PHONE_SEASONAL_END_DATE', 'Seasonal End Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Temporary Start Date
CALL INSERTREPORTFIELD('PHONE_TEMPORARY_START_DATE', 'Temporary Start Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Temporary End Date
CALL INSERTREPORTFIELD('PHONE_TEMPORARY_END_DATE', 'Temporary End Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Phone Number
CALL INSERTREPORTFIELD('PHONE_NUMBER', 'Phone Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Provider
CALL INSERTREPORTFIELD('PHONE_PROVIDER', 'Provider', b'0', 1, @REPORTFIELDGROUP_ID);

-- SMS
CALL INSERTREPORTFIELD('PHONE_SMS', 'SMS', b'0', 1, @REPORTFIELDGROUP_ID);

-- Receive Correspondence
CALL INSERTREPORTFIELD('PHONE_RECEIVE_CORRESPONDENCE', 'Receive Correspondence', b'0', 6, @REPORTFIELDGROUP_ID);

-- Phone Comments
CALL INSERTREPORTFIELD('PHONE_COMMENT', 'Phone Comments', b'0', 1, @REPORTFIELDGROUP_ID);

-- Phone Create Date
CALL INSERTREPORTFIELD('PHONE_CREATE_DATE', 'Phone Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Phone Update Date
CALL INSERTREPORTFIELD('PHONE_UPDATE_DATE', 'Phone Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Phone Inactive Status
CALL INSERTREPORTFIELD('PHONE_INACTIVE', 'Phone Inactive Status', b'0', 6, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Pledge Audit History View & Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_AUDITHISTORY_PLEDGES;
CREATE VIEW VW_AUDITHISTORY_PLEDGES
AS
	SELECT
		VW_AUDITHISTORY.AUDIT_AUDIT_ID,
		VW_AUDITHISTORY.AUDIT_DATE,
		VW_AUDITHISTORY.AUDIT_USER,
		VW_AUDITHISTORY.AUDIT_AUDIT_TYPE,
		VW_AUDITHISTORY.AUDIT_DESCRIPTION,
		VW_AUDITHISTORY.AUDIT_ENTITY_TYPE,
		VW_AUDITHISTORY.AUDIT_OBJECT_ID,
		VW_AUDITHISTORY.AUDIT_PERSON_ID,
		VW_AUDITHISTORY.AUDIT_SITE_NAME,

		-- Pledge Number Information
		COMMITMENT_PERSON_ID,
		COMMITMENT_COMMITMENT_ID,
		COMMITMENT_RECURRING,
		COMMITMENT_AMOUNT_PER_GIFT,
		COMMITMENT_AMOUNT_TOTAL,
		COMMITMENT_CURRENCY_CODE,
		COMMITMENT_STATUS,
		COMMITMENT_FREQUENCY,
		COMMITMENT_PLEDGE_DATE,
		COMMITMENT_PROJECTED_DATE,
		COMMITMENT_START_DATE,
		COMMITMENT_END_DATE,
		COMMITMENT_COMMENTS,
		COMMITMENT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS,
		COMMITMENT_SEND_ACKNOWLEDGMENT,
		COMMITMENT_ACKNOWLEDGMENT_DATE
	FROM VW_AUDITHISTORY
	LEFT JOIN VW_PLEDGES ON VW_AUDITHISTORY.AUDIT_OBJECT_ID = VW_PLEDGES.COMMITMENT_COMMITMENT_ID
	WHERE VW_AUDITHISTORY.AUDIT_ENTITY_TYPE = 'pledge'
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Audit History');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Pledge Audit History', 0, 'VW_AUDITHISTORY_PLEDGES', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();

-- ***********************************************************************
-- Audit History Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Audit History Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Audit History ID
CALL INSERTREPORTFIELD('AUDIT_AUDIT_ID', 'Audit History ID', b'1', 3, @REPORTFIELDGROUP_ID);

-- Date
CALL INSERTREPORTFIELD('AUDIT_DATE', 'Date', b'1', 4, @REPORTFIELDGROUP_ID);

-- User
CALL INSERTREPORTFIELD('AUDIT_USER', 'User', b'1', 1, @REPORTFIELDGROUP_ID);

-- Type
CALL INSERTREPORTFIELD('AUDIT_AUDIT_TYPE', 'Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Description
CALL INSERTREPORTFIELD('AUDIT_DESCRIPTION', 'Description', b'1', 1, @REPORTFIELDGROUP_ID);

-- Object Type
CALL INSERTREPORTFIELD('AUDIT_ENTITY_TYPE', 'Object Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Object ID
CALL INSERTREPORTFIELD('AUDIT_OBJECT_ID', 'Object ID', b'0', 3, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('AUDIT_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Pledge Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Pledge Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account
CALL INSERTREPORTFIELD('COMMITMENT_COMMITMENT_ID', 'Pledge ID', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('COMMITMENT_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(COMMITMENT_PERSON_ID)', 'Account Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Recurring
CALL INSERTREPORTFIELD('COMMITMENT_RECURRING', 'Recurring', b'0', 6, @REPORTFIELDGROUP_ID);

-- Amount Per Gift
CALL INSERTREPORTFIELD('COMMITMENT_AMOUNT_PER_GIFT', 'Amount Per Gift', b'0', 5, @REPORTFIELDGROUP_ID);

-- Amount Total
CALL INSERTREPORTFIELD('COMMITMENT_AMOUNT_TOTAL', 'Amount Total', b'0', 5, @REPORTFIELDGROUP_ID);

-- Currency Code
CALL INSERTREPORTFIELD('COMMITMENT_CURRENCY_CODE', 'Currency Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Status
CALL INSERTREPORTFIELD('COMMITMENT_STATUS', 'Status', b'0', 1, @REPORTFIELDGROUP_ID);

-- Frequency
CALL INSERTREPORTFIELD('COMMITMENT_FREQUENCY', 'Frequency', b'0', 1, @REPORTFIELDGROUP_ID);

-- Pledge Date
CALL INSERTREPORTFIELD('COMMITMENT_PLEDGE_DATE', 'Pledge Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Projected Date
CALL INSERTREPORTFIELD('COMMITMENT_PROJECTED_DATE', 'Projected Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Start Date
CALL INSERTREPORTFIELD('COMMITMENT_START_DATE', 'Start Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- End Date
CALL INSERTREPORTFIELD('COMMITMENT_END_DATE', 'End Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Comments
CALL INSERTREPORTFIELD('COMMITMENT_COMMENTS', 'Comments', b'0', 1, @REPORTFIELDGROUP_ID);

-- Receipt Email
CALL INSERTREPORTFIELD('COMMITMENT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS', 'Receipt Email', b'0', 1, @REPORTFIELDGROUP_ID);

-- Send Acknowledgment
CALL INSERTREPORTFIELD('COMMITMENT_SEND_ACKNOWLEDGMENT', 'Send Acknowledgment', b'0', 6, @REPORTFIELDGROUP_ID);

-- Acknowledgment Date
CALL INSERTREPORTFIELD('COMMITMENT_ACKNOWLEDGMENT_DATE', 'Acknowledgment Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Acknowledgment Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Acknowledgment Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Receipt Email
CALL INSERTREPORTFIELD('COMMITMENT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS', 'Receipt Email', b'0', 1, @REPORTFIELDGROUP_ID);

-- Send Acknowledgment
CALL INSERTREPORTFIELD('COMMITMENT_SEND_ACKNOWLEDGMENT', 'Send Acknowledgment', b'0', 6, @REPORTFIELDGROUP_ID);

-- Acknowledgment Date
CALL INSERTREPORTFIELD('COMMITMENT_ACKNOWLEDGMENT_DATE', 'Acknowledgment Date', b'0', 4, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Recurring Gift Audit History View & Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_AUDITHISTORY_RECURRINGGIFTS;
CREATE VIEW VW_AUDITHISTORY_RECURRINGGIFTS
AS
	SELECT
		VW_AUDITHISTORY.AUDIT_AUDIT_ID,
		VW_AUDITHISTORY.AUDIT_DATE,
		VW_AUDITHISTORY.AUDIT_USER,
		VW_AUDITHISTORY.AUDIT_AUDIT_TYPE,
		VW_AUDITHISTORY.AUDIT_DESCRIPTION,
		VW_AUDITHISTORY.AUDIT_ENTITY_TYPE,
		VW_AUDITHISTORY.AUDIT_OBJECT_ID,
		VW_AUDITHISTORY.AUDIT_PERSON_ID,
		VW_AUDITHISTORY.AUDIT_SITE_NAME,

		-- Recurring Gift Information
		COMMITMENT_COMMITMENT_ID,
		COMMITMENT_PERSON_ID,
		COMMITMENT_AUTO_PAY,
		COMMITMENT_AMOUNT_PER_GIFT,
		COMMITMENT_AMOUNT_TOTAL,
		COMMITMENT_CURRENCY_CODE,
		COMMITMENT_FREQUENCY,
		COMMITMENT_START_DATE,
		COMMITMENT_END_DATE,
		COMMITMENT_STATUS,
		COMMITMENT_COMMENTS,
		COMMITMENT_LAST_ENTRY_DATE,
		COMMITMENT_CREATE_DATE,
		COMMITMENT_UPDATE_DATE,
		COMMITMENT_PAYMENT_SOURCE_PAYMENT_PROFILE_DESCRIPTION,
		COMMITMENT_PAYMENT_SOURCE_PAYMENT_TYPE,
		COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_TYPE,
		COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_HOLDER_NAME,
		COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION,
		COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION_DATE,
		COMMITMENT_PAYMENT_SOURCE_ACH_HOLDER_NAME,
		COMMITMENT_PAYMENT_SOURCE_ACH_ROUTING_NUMBER,
		COMMITMENT_CHECK_NUMBER,
		COMMITMENT_PAYMENT_ADDRESS_ADDRESS_LINE_1,
		COMMITMENT_PAYMENT_ADDRESS_ADDRESS_LINE_2,
		COMMITMENT_PAYMENT_ADDRESS_ADDRESS_LINE_3,
		COMMITMENT_PAYMENT_ADDRESS_CITY,
		COMMITMENT_PAYMENT_ADDRESS_STATE_PROVINCE,
		COMMITMENT_PAYMENT_ADDRESS_POSTAL_CODE,
		COMMITMENT_PAYMENT_ADDRESS_COUNTRY,
		COMMITMENT_PAYMENT_PHONE_NUMBER,
		COMMITMENT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS,
		COMMITMENT_SEND_ACKNOWLEDGMENT,
		COMMITMENT_ACKNOWLEDGMENT_DATE
	FROM VW_AUDITHISTORY
	LEFT JOIN VW_RECURRINGGIFTS ON VW_AUDITHISTORY.AUDIT_OBJECT_ID = VW_RECURRINGGIFTS.COMMITMENT_COMMITMENT_ID
	WHERE VW_AUDITHISTORY.AUDIT_ENTITY_TYPE = 'recurring gift'
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Audit History');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Recurring Gift Audit History', 0, 'VW_AUDITHISTORY_RECURRINGGIFTS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();

-- ***********************************************************************
-- Audit History Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Audit History Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Audit History ID
CALL INSERTREPORTFIELD('AUDIT_AUDIT_ID', 'Audit History ID', b'1', 3, @REPORTFIELDGROUP_ID);

-- Date
CALL INSERTREPORTFIELD('AUDIT_DATE', 'Date', b'1', 4, @REPORTFIELDGROUP_ID);

-- User
CALL INSERTREPORTFIELD('AUDIT_USER', 'User', b'1', 1, @REPORTFIELDGROUP_ID);

-- Type
CALL INSERTREPORTFIELD('AUDIT_AUDIT_TYPE', 'Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Description
CALL INSERTREPORTFIELD('AUDIT_DESCRIPTION', 'Description', b'1', 1, @REPORTFIELDGROUP_ID);

-- Object Type
CALL INSERTREPORTFIELD('AUDIT_ENTITY_TYPE', 'Object Type', b'1', 1, @REPORTFIELDGROUP_ID);

-- Object ID
CALL INSERTREPORTFIELD('AUDIT_OBJECT_ID', 'Object ID', b'0', 3, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('AUDIT_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Recurring Gift Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Recurring Gift Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Recurring Gift ID
CALL INSERTREPORTFIELD('COMMITMENT_COMMITMENT_ID', 'Recurring Gift ID', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('COMMITMENT_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(COMMITMENT_PERSON_ID)', 'Account Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Auto Pay
CALL INSERTREPORTFIELD('COMMITMENT_AUTO_PAY', 'Auto Pay', b'0', 6, @REPORTFIELDGROUP_ID);

-- Amount Per Gift
CALL INSERTREPORTFIELD('COMMITMENT_AMOUNT_PER_GIFT', 'Amount Per Gift', b'1', 5, @REPORTFIELDGROUP_ID);

-- Amount Total
CALL INSERTREPORTFIELD('COMMITMENT_AMOUNT_TOTAL', 'Amount Total', b'1', 5, @REPORTFIELDGROUP_ID);

-- Currency Code
CALL INSERTREPORTFIELD('COMMITMENT_CURRENCY_CODE', 'Currency Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Frequency
CALL INSERTREPORTFIELD('COMMITMENT_FREQUENCY', 'Frequency', b'0', 1, @REPORTFIELDGROUP_ID);

-- Start Date
CALL INSERTREPORTFIELD('COMMITMENT_START_DATE', 'Start Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- End Date
CALL INSERTREPORTFIELD('COMMITMENT_END_DATE', 'End Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Status
CALL INSERTREPORTFIELD('COMMITMENT_STATUS', 'Status', b'0', 1, @REPORTFIELDGROUP_ID);

-- Reference Account Number
CALL INSERTREPORTFIELD('GETCOMMITMENTCUSTOMFIELD(COMMITMENT_COMMITMENT_ID, ''reference'')', 'Reference Account Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Reference Account Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETCOMMITMENTCUSTOMFIELD(COMMITMENT_COMMITMENT_ID, ''reference''))', 'Reference Account Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Comments
CALL INSERTREPORTFIELD('COMMITMENT_COMMENTS', 'Comments', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Entry Date
CALL INSERTREPORTFIELD('COMMITMENT_LAST_ENTRY_DATE', 'Last Entry Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Recurring Gift Create Date
CALL INSERTREPORTFIELD('COMMITMENT_CREATE_DATE', 'Recurring Gift Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Recurring Gift Update Date
CALL INSERTREPORTFIELD('COMMITMENT_UPDATE_DATE', 'Recurring Gift Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Payment Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Payment Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Payment Profile Description
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_PAYMENT_PROFILE_DESCRIPTION', 'Payment Profile Description', b'0', 1, @REPORTFIELDGROUP_ID);

-- Payment Method
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_PAYMENT_TYPE', 'Payment Method', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Type
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_TYPE', 'Credit Card Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Holder Name
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_HOLDER_NAME', 'Credit Card Holder Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Expiration
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION', 'Credit Card Expiration', b'0', 1, @REPORTFIELDGROUP_ID);

-- Credit Card Expiration (Date / Time)
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_CREDIT_CARD_EXPIRATION_DATE', 'Credit Card Expiration (Date / Time)', b'0', 4, @REPORTFIELDGROUP_ID);

-- ACH Holder Name
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_ACH_HOLDER_NAME', 'ACH Holder Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- ACH Routing Number
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_SOURCE_ACH_ROUTING_NUMBER', 'ACH Routing Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- Check Number
CALL INSERTREPORTFIELD('COMMITMENT_CHECK_NUMBER', 'Check Number', b'0', 2, @REPORTFIELDGROUP_ID);

-- Address Line 1
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_ADDRESS_LINE_1', 'Address Line 1', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 2
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_ADDRESS_LINE_2', 'Address Line 2', b'0', 1, @REPORTFIELDGROUP_ID);

-- Address Line 3
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_ADDRESS_LINE_3', 'Address Line 3', b'0', 1, @REPORTFIELDGROUP_ID);

-- City
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_CITY', 'City', b'0', 1, @REPORTFIELDGROUP_ID);

-- State/Province
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_STATE_PROVINCE', 'State/Province', b'0', 1, @REPORTFIELDGROUP_ID);

-- Zip/Postal Code
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_POSTAL_CODE', 'Zip/Postal Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Country
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_ADDRESS_COUNTRY', 'Country', b'0', 1, @REPORTFIELDGROUP_ID);

-- Phone Number
CALL INSERTREPORTFIELD('COMMITMENT_PAYMENT_PHONE_NUMBER', 'Phone Number', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Acknowledgment Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Acknowledgment Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Receipt Email
CALL INSERTREPORTFIELD('COMMITMENT_ACKNOWLEDGEMENT_EMAIL_EMAIL_ADDRESS', 'Receipt Email', b'0', 1, @REPORTFIELDGROUP_ID);

-- Send Acknowledgment
CALL INSERTREPORTFIELD('COMMITMENT_SEND_ACKNOWLEDGMENT', 'Send Acknowledgment', b'0', 6, @REPORTFIELDGROUP_ID);

-- Acknowledgment Date
CALL INSERTREPORTFIELD('COMMITMENT_ACKNOWLEDGMENT_DATE', 'Acknowledgment Date', b'0', 4, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Journals View & Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_JOURNALS;
CREATE VIEW VW_JOURNALS
AS
	SELECT
		COMMUNICATION_HISTORY.COMMUNICATION_HISTORY_ID AS COMMUNICATION_HISTORY_COMMUNICATION_HISTORY_ID,
		COMMUNICATION_HISTORY.COMMUNICATION_TYPE AS COMMUNICATION_HISTORY_COMMUNICATION_TYPE,
		COMMUNICATION_HISTORY.RECORD_DATE AS COMMUNICATION_HISTORY_RECORD_DATE,
		COMMUNICATION_HISTORY.COMMENTS AS COMMUNICATION_HISTORY_COMMENTS,
		COMMUNICATION_HISTORY.SYSTEM_GENERATED AS COMMUNICATION_HISTORY_SYSTEM_GENERATED,
		COMMUNICATION_HISTORY.CREATE_DATE AS COMMUNICATION_HISTORY_CREATE_DATE,
		COMMUNICATION_HISTORY.UPDATE_DATE AS COMMUNICATION_HISTORY_UPDATE_DATE,
		COMMUNICATION_HISTORY.PERSON_ID AS COMMUNICATION_HISTORY_PERSON_ID,
		COMMUNICATION_HISTORY.RECORDED_BY AS COMMUNICATION_HISTORY_RECORDED_BY
	FROM COMMUNICATION_HISTORY
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Journals');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Journals', 0, 'VW_JOURNALS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();


-- ***********************************************************************
-- Journal Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Journal Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Journal Reference Number
CALL INSERTREPORTFIELD('COMMUNICATION_HISTORY_COMMUNICATION_HISTORY_ID', 'Journal Reference Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Entry Type
CALL INSERTREPORTFIELD('COMMUNICATION_HISTORY_COMMUNICATION_TYPE', 'Entry Type', b'1', 2, @REPORTFIELDGROUP_ID);

-- Journal Entry Date
CALL INSERTREPORTFIELD('COMMUNICATION_HISTORY_RECORD_DATE', 'Journal Entry Date', b'1', 4, @REPORTFIELDGROUP_ID);

-- Comments
CALL INSERTREPORTFIELD('COMMUNICATION_HISTORY_COMMENTS', 'Comments', b'1', 1, @REPORTFIELDGROUP_ID);

-- System Generated
CALL INSERTREPORTFIELD('COMMUNICATION_HISTORY_SYSTEM_GENERATED', 'System Generated', b'0', 6, @REPORTFIELDGROUP_ID);

-- Create Date
CALL INSERTREPORTFIELD('COMMUNICATION_HISTORY_CREATE_DATE', 'Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Update Date
CALL INSERTREPORTFIELD('COMMUNICATION_HISTORY_UPDATE_DATE', 'Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('COMMUNICATION_PERSON_ID', 'Account Number', b'0', 3, @REPORTFIELDGROUP_ID);

-- Recorded By
CALL INSERTREPORTFIELD('COMMUNICATION_HISTORY_RECORDED_BY', 'Recorded By', b'0', 3, @REPORTFIELDGROUP_ID);



-- *********************************************************************************************************************
--
-- Journals & Constituents Field Definitions
--
-- *********************************************************************************************************************
DROP VIEW IF EXISTS VW_JOURNALS_CONSTITUENTS;
CREATE VIEW VW_JOURNALS_CONSTITUENTS
AS
	SELECT
		COMMUNICATION_HISTORY_COMMUNICATION_HISTORY_ID,
		COMMUNICATION_HISTORY_COMMUNICATION_TYPE,
		COMMUNICATION_HISTORY_RECORD_DATE,
		COMMUNICATION_HISTORY_COMMENTS,
		COMMUNICATION_HISTORY_SYSTEM_GENERATED,
		COMMUNICATION_HISTORY_CREATE_DATE,
		COMMUNICATION_HISTORY_UPDATE_DATE,
		COMMUNICATION_HISTORY_PERSON_ID,
		COMMUNICATION_HISTORY_RECORDED_BY,

		-- Constituent Information
		VW_CONSTITUENTS.PERSON_PERSON_ID,
		VW_CONSTITUENTS.PERSON_CONSTITUENT_ROLES,
		VW_CONSTITUENTS.PERSON_CONSTITUENT_ROLE,
		VW_CONSTITUENTS.PERSON_CONSTITUENT_TYPE,
		VW_CONSTITUENTS.PERSON_CREATE_DATE,
		VW_CONSTITUENTS.PERSON_FIRST_NAME,
		VW_CONSTITUENTS.PERSON_LAPSED_DONOR,
		VW_CONSTITUENTS.PERSON_LAST_NAME,
		VW_CONSTITUENTS.PERSON_LEGAL_NAME,
		VW_CONSTITUENTS.PERSON_LOGIN_ID,
		VW_CONSTITUENTS.PERSON_MAJOR_DONOR,
		VW_CONSTITUENTS.PERSON_MARITAL_STATUS,
		VW_CONSTITUENTS.PERSON_MIDDLE_NAME,
		VW_CONSTITUENTS.PERSON_NCAIS_CODE,
		VW_CONSTITUENTS.PERSON_ORGANIZATION_NAME,
		VW_CONSTITUENTS.PERSON_PREFERRED_PHONE_TYPE,
		VW_CONSTITUENTS.PERSON_RECOGNITION_NAME,
		VW_CONSTITUENTS.PERSON_SUFFIX,
		VW_CONSTITUENTS.PERSON_TITLE,
		VW_CONSTITUENTS.PERSON_UPDATE_DATE,
		VW_CONSTITUENTS.PERSON_SITE_NAME
	FROM VW_JOURNALS
	LEFT JOIN VW_CONSTITUENTS ON VW_JOURNALS.COMMUNICATION_HISTORY_PERSON_ID = VW_CONSTITUENTS.PERSON_PERSON_ID
;

SET @REPORTDATASOURCE_ID = (SELECT REPORTSOURCE_ID FROM REPORTDATASOURCE WHERE REPORT_NAME = 'Journals');

INSERT INTO REPORTDATASUBSOURCE
	(DISPLAY_NAME, DATABASE_TYPE, VIEW_NAME, reportDataSource_REPORTSOURCE_ID, REPORT_FORMAT_TYPE, JASPER_DATASOURCE_NAME)
VALUES
	('Journals & Constituents', 0, 'VW_JOURNALS_CONSTITUENTS', @REPORTDATASOURCE_ID, 0, '/datasources/ReportWizardJdbcDS');

SET @REPORTSUBSOURCE_ID = LAST_INSERT_ID();


-- ***********************************************************************
-- Journal Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Journal Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Journal Reference Number
CALL INSERTREPORTFIELD('COMMUNICATION_HISTORY_COMMUNICATION_HISTORY_ID', 'Journal Reference Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Entry Type
CALL INSERTREPORTFIELD('COMMUNICATION_HISTORY_COMMUNICATION_TYPE', 'Entry Type', b'1', 2, @REPORTFIELDGROUP_ID);

-- Journal Entry Date
CALL INSERTREPORTFIELD('COMMUNICATION_HISTORY_RECORD_DATE', 'Journal Entry Date', b'1', 4, @REPORTFIELDGROUP_ID);

-- Comments
CALL INSERTREPORTFIELD('COMMUNICATION_HISTORY_COMMENTS', 'Comments', b'1', 1, @REPORTFIELDGROUP_ID);

-- System Generated
CALL INSERTREPORTFIELD('COMMUNICATION_HISTORY_SYSTEM_GENERATED', 'System Generated', b'0', 6, @REPORTFIELDGROUP_ID);

-- Create Date
CALL INSERTREPORTFIELD('COMMUNICATION_HISTORY_CREATE_DATE', 'Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Update Date
CALL INSERTREPORTFIELD('COMMUNICATION_HISTORY_UPDATE_DATE', 'Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('COMMUNICATION_HISTORY_PERSON_ID', 'Account Number', b'0', 3, @REPORTFIELDGROUP_ID);

-- Recorded By
CALL INSERTREPORTFIELD('COMMUNICATION_HISTORY_RECORDED_BY', 'Recorded By', b'0', 3, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Contact Details Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Contact Details', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Account Number
CALL INSERTREPORTFIELD('PERSON_PERSON_ID', 'Account Number', b'1', 3, @REPORTFIELDGROUP_ID);

-- Account Manager Name
CALL INSERTREPORTFIELD('GETCONSTITUENTDISPLAYNAME(GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager''))', 'Account Manager Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Account Manager Account Number
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''accountManager'')', 'Account Manager Account Number', b'0', 3, @REPORTFIELDGROUP_ID);

-- Constituent Type
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_TYPE', 'Constituent Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLES', 'Profile Types', b'0', 1, @REPORTFIELDGROUP_ID);

-- Profile Types
CALL INSERTREPORTFIELD('PERSON_CONSTITUENT_ROLE', 'Profile Type', b'0', 1, @REPORTFIELDGROUP_ID);

-- Title
CALL INSERTREPORTFIELD('PERSON_TITLE', 'Title', b'0', 1, @REPORTFIELDGROUP_ID);

-- First Name
CALL INSERTREPORTFIELD('PERSON_FIRST_NAME', 'First Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Middle Name
CALL INSERTREPORTFIELD('PERSON_MIDDLE_NAME', 'Middle Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Last Name
CALL INSERTREPORTFIELD('PERSON_LAST_NAME', 'Last Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Suffix
CALL INSERTREPORTFIELD('PERSON_SUFFIX', 'Suffix', b'0', 1, @REPORTFIELDGROUP_ID);

-- Recognition Name
CALL INSERTREPORTFIELD('PERSON_RECOGNITION_NAME', 'Recognition Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Organization Name
CALL INSERTREPORTFIELD('PERSON_ORGANIZATION_NAME', 'Organization Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Legal Name
CALL INSERTREPORTFIELD('PERSON_LEGAL_NAME', 'Legal Name', b'0', 1, @REPORTFIELDGROUP_ID);

-- Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.matching'')', 'Matching', b'0', 1, @REPORTFIELDGROUP_ID);

-- Percent Matching
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.percentMatch'')', 'Percent Matching', b'0', 3, @REPORTFIELDGROUP_ID);

-- Maximum Match
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.maximumMatch'')', 'Maximum Match', b'0', 5, @REPORTFIELDGROUP_ID);

-- Website
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.website'')', 'Website', b'0', 1, @REPORTFIELDGROUP_ID);

-- Tax ID
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''organization.taxid'')', 'Tax ID', b'0', 1, @REPORTFIELDGROUP_ID);

-- NCAIS Code
CALL INSERTREPORTFIELD('PERSON_NCAIS_CODE', 'NCAIS Code', b'0', 1, @REPORTFIELDGROUP_ID);

-- Communication Preferences
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''communicationPreferences'')', 'Communication Preferences', b'0', 1, @REPORTFIELDGROUP_ID);

-- Email Format
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''emailFormat'')', 'Email Format', b'0', 1, @REPORTFIELDGROUP_ID);

-- Create Date
CALL INSERTREPORTFIELD('PERSON_CREATE_DATE', 'Create Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Update Date
CALL INSERTREPORTFIELD('PERSON_UPDATE_DATE', 'Update Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Demographic Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Demographic Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Marital Status
CALL INSERTREPORTFIELD('PERSON_MARITAL_STATUS', 'Marital Status', b'0', 3, @REPORTFIELDGROUP_ID);

-- Birth Date
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.birthDate'')', 'Birth Date', b'0', 4, @REPORTFIELDGROUP_ID);

-- Deceased
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.deceased'')', 'Deceased', b'0', 6, @REPORTFIELDGROUP_ID);

-- Gender
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.gender'')', 'Gender', b'0', 1, @REPORTFIELDGROUP_ID);

-- Race
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.race'')', 'Race', b'0', 1, @REPORTFIELDGROUP_ID);

-- Military
CALL INSERTREPORTFIELD('GETPERSONCUSTOMFIELD(PERSON_PERSON_ID, ''individual.military'')', 'Military', b'0', 1, @REPORTFIELDGROUP_ID);

-- ***********************************************************************
-- Miscellaneous Information Field Group
-- ***********************************************************************
CALL INSERTREPORTFIELDGROUP('Miscellaneous Information', @REPORTSUBSOURCE_ID, @REPORTFIELDGROUP_ID);

-- Major Donor
CALL INSERTREPORTFIELD('PERSON_MAJOR_DONOR', 'Major Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Lapsed Donor
CALL INSERTREPORTFIELD('PERSON_LAPSED_DONOR', 'Lapsed Donor', b'0', 6, @REPORTFIELDGROUP_ID);

-- Site Name
CALL INSERTREPORTFIELD('PERSON_SITE_NAME', 'Site Name', b'0', 1, @REPORTFIELDGROUP_ID);



-- Custom Filters

-- Major Donor - tied to ADDRESS_PERSON_ID
INSERT INTO REPORTCUSTOMFILTERDEFINITION (REPORTCUSTOMFILTERDEFINITION_ID, DISPLAY_TEXT, SQL_TEXT, DISPLAY_HTML)
SELECT 300000, 'Account - Account is marked as a major donor',  
'((SELECT MAJOR_DONOR FROM PERSON PERSONLOOKUP WHERE PERSONLOOKUP.PERSON_ID = [VIEWNAME].ADDRESS_PERSON_ID) = true)',
'Account - Account is marked as a major donor';

-- Major Donor - tied to AUDIT_PERSON_ID
INSERT INTO REPORTCUSTOMFILTERDEFINITION (REPORTCUSTOMFILTERDEFINITION_ID, DISPLAY_TEXT, SQL_TEXT, DISPLAY_HTML)
SELECT 310000, 'Account - Account is marked as a major donor',  
'((SELECT MAJOR_DONOR FROM PERSON PERSONLOOKUP WHERE PERSONLOOKUP.PERSON_ID = [VIEWNAME].AUDIT_PERSON_ID) = true)',
'Account - Account is marked as a major donor';

-- Major Donor - tied to COMMITMENT_PERSON_ID
INSERT INTO REPORTCUSTOMFILTERDEFINITION (REPORTCUSTOMFILTERDEFINITION_ID, DISPLAY_TEXT, SQL_TEXT, DISPLAY_HTML)
SELECT 320000, 'Account - Account is marked as a major donor',  
'((SELECT MAJOR_DONOR FROM PERSON PERSONLOOKUP WHERE PERSONLOOKUP.PERSON_ID = [VIEWNAME].COMMITMENT_PERSON_ID) = true)',
'Account - Account is marked as a major donor';

-- Major Donor - tied to COMMUNICATION_HISTORY_PERSON_ID
INSERT INTO REPORTCUSTOMFILTERDEFINITION (REPORTCUSTOMFILTERDEFINITION_ID, DISPLAY_TEXT, SQL_TEXT, DISPLAY_HTML)
SELECT 330000, 'Account - Account is marked as a major donor',  
'((SELECT MAJOR_DONOR FROM PERSON PERSONLOOKUP WHERE PERSONLOOKUP.PERSON_ID = [VIEWNAME].COMMUNICATION_HISTORY_PERSON_ID) = true)',
'Account - Account is marked as a major donor';

-- Major Donor - tied to EMAIL_PERSON_ID
INSERT INTO REPORTCUSTOMFILTERDEFINITION (REPORTCUSTOMFILTERDEFINITION_ID, DISPLAY_TEXT, SQL_TEXT, DISPLAY_HTML)
SELECT 340000, 'Account - Account is marked as a major donor',  
'((SELECT MAJOR_DONOR FROM PERSON PERSONLOOKUP WHERE PERSONLOOKUP.PERSON_ID = [VIEWNAME].EMAIL_PERSON_ID) = true)',
'Account - Account is marked as a major donor';

-- Major Donor - tied to GIFT_PERSON_ID
INSERT INTO REPORTCUSTOMFILTERDEFINITION (REPORTCUSTOMFILTERDEFINITION_ID, DISPLAY_TEXT, SQL_TEXT, DISPLAY_HTML)
SELECT 350000, 'Account - Account is marked as a major donor',  
'((SELECT MAJOR_DONOR FROM PERSON PERSONLOOKUP WHERE PERSONLOOKUP.PERSON_ID = [VIEWNAME].GIFT_PERSON_ID) = true)',
'Account - Account is marked as a major donor';

-- Major Donor - tied to PAYMENT_HISTORY_PERSON_ID
INSERT INTO REPORTCUSTOMFILTERDEFINITION (REPORTCUSTOMFILTERDEFINITION_ID, DISPLAY_TEXT, SQL_TEXT, DISPLAY_HTML)
SELECT 360000, 'Account - Account is marked as a major donor',  
'((SELECT MAJOR_DONOR FROM PERSON PERSONLOOKUP WHERE PERSONLOOKUP.PERSON_ID = [VIEWNAME].PAYMENT_HISTORY_PERSON_ID) = true)',
'Account - Account is marked as a major donor';

-- Major Donor - tied to PAYMENT_SOURCE_PERSON_ID
INSERT INTO REPORTCUSTOMFILTERDEFINITION (REPORTCUSTOMFILTERDEFINITION_ID, DISPLAY_TEXT, SQL_TEXT, DISPLAY_HTML)
SELECT 370000, 'Account - Account is marked as a major donor',  
'((SELECT MAJOR_DONOR FROM PERSON PERSONLOOKUP WHERE PERSONLOOKUP.PERSON_ID = [VIEWNAME].PAYMENT_SOURCE_PERSON_ID) = true)',
'Account - Account is marked as a major donor';

-- Major Donor - tied to PERSON_PERSON_ID
INSERT INTO REPORTCUSTOMFILTERDEFINITION (REPORTCUSTOMFILTERDEFINITION_ID, DISPLAY_TEXT, SQL_TEXT, DISPLAY_HTML)
SELECT 380000, 'Account - Account is marked as a major donor',  
'((SELECT MAJOR_DONOR FROM PERSON PERSONLOOKUP WHERE PERSONLOOKUP.PERSON_ID = [VIEWNAME].PERSON_PERSON_ID) = true)',
'Account - Account is marked as a major donor';

-- Major Donor - tied to PHONE_PERSON_ID
INSERT INTO REPORTCUSTOMFILTERDEFINITION (REPORTCUSTOMFILTERDEFINITION_ID, DISPLAY_TEXT, SQL_TEXT, DISPLAY_HTML)
SELECT 390000, 'Account - Account is marked as a major donor',  
'((SELECT MAJOR_DONOR FROM PERSON PERSONLOOKUP WHERE PERSONLOOKUP.PERSON_ID = [VIEWNAME].PHONE_PERSON_ID) = true)',
'Account - Account is marked as a major donor';


-- Account Gift Total - tied to ADDRESS_PERSON_ID
INSERT INTO REPORTCUSTOMFILTERDEFINITION (REPORTCUSTOMFILTERDEFINITION_ID, DISPLAY_TEXT, SQL_TEXT, DISPLAY_HTML)
SELECT 400000, 'Gift Totals - Account has given at least $[GIFTAMOUNT] in year [GIFTYEAR]',  
'((SELECT SUM(AMOUNT) FROM GIFT GIFTLOOKUP WHERE GIFTLOOKUP.PERSON_ID = [VIEWNAME].ADDRESS_PERSON_ID AND YEAR(TRANSACTION_DATE) = {1}) >= {0})',
'Gift Totals - Account has given at least $<input class="customCriteria" objectname="reportFilters[INDEXREPLACEMENT].reportCustomFilter.reportCustomFilterCriteria[0]" value="{0}"/> in year <input class="customCriteria" objectname="reportFilters[INDEXREPLACEMENT].reportCustomFilter.reportCustomFilterCriteria[1]" value="{1}"/>';

-- Account Gift Total - tied to AUDIT_PERSON_ID
INSERT INTO REPORTCUSTOMFILTERDEFINITION (REPORTCUSTOMFILTERDEFINITION_ID, DISPLAY_TEXT, SQL_TEXT, DISPLAY_HTML)
SELECT 410000, 'Gift Totals - Account has given at least $[GIFTAMOUNT] in year [GIFTYEAR]',  
'((SELECT SUM(AMOUNT) FROM GIFT GIFTLOOKUP WHERE GIFTLOOKUP.PERSON_ID = [VIEWNAME].AUDIT_PERSON_ID AND YEAR(TRANSACTION_DATE) = {1}) >= {0})',
'Gift Totals - Account has given at least $<input class="customCriteria" objectname="reportFilters[INDEXREPLACEMENT].reportCustomFilter.reportCustomFilterCriteria[0]" value="{0}"/> in year <input class="customCriteria" objectname="reportFilters[INDEXREPLACEMENT].reportCustomFilter.reportCustomFilterCriteria[1]" value="{1}"/>';

-- Account Gift Total - tied to COMMITMENT_PERSON_ID
INSERT INTO REPORTCUSTOMFILTERDEFINITION (REPORTCUSTOMFILTERDEFINITION_ID, DISPLAY_TEXT, SQL_TEXT, DISPLAY_HTML)
SELECT 420000, 'Gift Totals - Account has given at least $[GIFTAMOUNT] in year [GIFTYEAR]',  
'((SELECT SUM(AMOUNT) FROM GIFT GIFTLOOKUP WHERE GIFTLOOKUP.PERSON_ID = [VIEWNAME].COMMITMENT_PERSON_ID AND YEAR(TRANSACTION_DATE) = {1}) >= {0})',
'Gift Totals - Account has given at least $<input class="customCriteria" objectname="reportFilters[INDEXREPLACEMENT].reportCustomFilter.reportCustomFilterCriteria[0]" value="{0}"/> in year <input class="customCriteria" objectname="reportFilters[INDEXREPLACEMENT].reportCustomFilter.reportCustomFilterCriteria[1]" value="{1}"/>';

-- Account Gift Total - tied to COMMUNICATION_HISTORY_PERSON_ID
INSERT INTO REPORTCUSTOMFILTERDEFINITION (REPORTCUSTOMFILTERDEFINITION_ID, DISPLAY_TEXT, SQL_TEXT, DISPLAY_HTML)
SELECT 430000, 'Gift Totals - Account has given at least $[GIFTAMOUNT] in year [GIFTYEAR]',  
'((SELECT SUM(AMOUNT) FROM GIFT GIFTLOOKUP WHERE GIFTLOOKUP.PERSON_ID = [VIEWNAME].COMMUNICATION_HISTORY_PERSON_ID AND YEAR(TRANSACTION_DATE) = {1}) >= {0})',
'Gift Totals - Account has given at least $<input class="customCriteria" objectname="reportFilters[INDEXREPLACEMENT].reportCustomFilter.reportCustomFilterCriteria[0]" value="{0}"/> in year <input class="customCriteria" objectname="reportFilters[INDEXREPLACEMENT].reportCustomFilter.reportCustomFilterCriteria[1]" value="{1}"/>';

-- Account Gift Total - tied to EMAIL_PERSON_ID
INSERT INTO REPORTCUSTOMFILTERDEFINITION (REPORTCUSTOMFILTERDEFINITION_ID, DISPLAY_TEXT, SQL_TEXT, DISPLAY_HTML)
SELECT 440000, 'Gift Totals - Account has given at least $[GIFTAMOUNT] in year [GIFTYEAR]',  
'((SELECT SUM(AMOUNT) FROM GIFT GIFTLOOKUP WHERE GIFTLOOKUP.PERSON_ID = [VIEWNAME].EMAIL_PERSON_ID AND YEAR(TRANSACTION_DATE) = {1}) >= {0})',
'Gift Totals - Account has given at least $<input class="customCriteria" objectname="reportFilters[INDEXREPLACEMENT].reportCustomFilter.reportCustomFilterCriteria[0]" value="{0}"/> in year <input class="customCriteria" objectname="reportFilters[INDEXREPLACEMENT].reportCustomFilter.reportCustomFilterCriteria[1]" value="{1}"/>';

-- Account Gift Total - tied to GIFT_PERSON_ID
INSERT INTO REPORTCUSTOMFILTERDEFINITION (REPORTCUSTOMFILTERDEFINITION_ID, DISPLAY_TEXT, SQL_TEXT, DISPLAY_HTML)
SELECT 450000, 'Gift Totals - Account has given at least $[GIFTAMOUNT] in year [GIFTYEAR]',  
'((SELECT SUM(AMOUNT) FROM GIFT GIFTLOOKUP WHERE GIFTLOOKUP.PERSON_ID = [VIEWNAME].GIFT_PERSON_ID AND YEAR(TRANSACTION_DATE) = {1}) >= {0})',
'Gift Totals - Account has given at least $<input class="customCriteria" objectname="reportFilters[INDEXREPLACEMENT].reportCustomFilter.reportCustomFilterCriteria[0]" value="{0}"/> in year <input class="customCriteria" objectname="reportFilters[INDEXREPLACEMENT].reportCustomFilter.reportCustomFilterCriteria[1]" value="{1}"/>';

-- Account Gift Total - tied to PAYMENT_HISTORY_PERSON_ID
INSERT INTO REPORTCUSTOMFILTERDEFINITION (REPORTCUSTOMFILTERDEFINITION_ID, DISPLAY_TEXT, SQL_TEXT, DISPLAY_HTML)
SELECT 460000, 'Gift Totals - Account has given at least $[GIFTAMOUNT] in year [GIFTYEAR]',  
'((SELECT SUM(AMOUNT) FROM GIFT GIFTLOOKUP WHERE GIFTLOOKUP.PERSON_ID = [VIEWNAME].PAYMENT_HISTORY_PERSON_ID AND YEAR(TRANSACTION_DATE) = {1}) >= {0})',
'Gift Totals - Account has given at least $<input class="customCriteria" objectname="reportFilters[INDEXREPLACEMENT].reportCustomFilter.reportCustomFilterCriteria[0]" value="{0}"/> in year <input class="customCriteria" objectname="reportFilters[INDEXREPLACEMENT].reportCustomFilter.reportCustomFilterCriteria[1]" value="{1}"/>';

-- Account Gift Total - tied to PAYMENT_SOURCE_PERSON_ID
INSERT INTO REPORTCUSTOMFILTERDEFINITION (REPORTCUSTOMFILTERDEFINITION_ID, DISPLAY_TEXT, SQL_TEXT, DISPLAY_HTML)
SELECT 470000, 'Gift Totals - Account has given at least $[GIFTAMOUNT] in year [GIFTYEAR]',  
'((SELECT SUM(AMOUNT) FROM GIFT GIFTLOOKUP WHERE GIFTLOOKUP.PERSON_ID = [VIEWNAME].PAYMENT_SOURCE_PERSON_ID AND YEAR(TRANSACTION_DATE) = {1}) >= {0})',
'Gift Totals - Account has given at least $<input class="customCriteria" objectname="reportFilters[INDEXREPLACEMENT].reportCustomFilter.reportCustomFilterCriteria[0]" value="{0}"/> in year <input class="customCriteria" objectname="reportFilters[INDEXREPLACEMENT].reportCustomFilter.reportCustomFilterCriteria[1]" value="{1}"/>';

-- Account Gift Total - tied to PERSON_PERSON_ID
INSERT INTO REPORTCUSTOMFILTERDEFINITION (REPORTCUSTOMFILTERDEFINITION_ID, DISPLAY_TEXT, SQL_TEXT, DISPLAY_HTML)
SELECT 480000, 'Gift Totals - Account has given at least $[GIFTAMOUNT] in year [GIFTYEAR]',  
'((SELECT SUM(AMOUNT) FROM GIFT GIFTLOOKUP WHERE GIFTLOOKUP.PERSON_ID = [VIEWNAME].PERSON_PERSON_ID AND YEAR(TRANSACTION_DATE) = {1}) >= {0})',
'Gift Totals - Account has given at least $<input class="customCriteria" objectname="reportFilters[INDEXREPLACEMENT].reportCustomFilter.reportCustomFilterCriteria[0]" value="{0}"/> in year <input class="customCriteria" objectname="reportFilters[INDEXREPLACEMENT].reportCustomFilter.reportCustomFilterCriteria[1]" value="{1}"/>';

-- Account Gift Total - tied to PHONE_PERSON_ID
INSERT INTO REPORTCUSTOMFILTERDEFINITION (REPORTCUSTOMFILTERDEFINITION_ID, DISPLAY_TEXT, SQL_TEXT, DISPLAY_HTML)
SELECT 490000, 'Gift Totals - Account has given at least $[GIFTAMOUNT] in year [GIFTYEAR]',  
'((SELECT SUM(AMOUNT) FROM GIFT GIFTLOOKUP WHERE GIFTLOOKUP.PERSON_ID = [VIEWNAME].PHONE_PERSON_ID AND YEAR(TRANSACTION_DATE) = {1}) >= {0})',
'Gift Totals - Account has given at least $<input class="customCriteria" objectname="reportFilters[INDEXREPLACEMENT].reportCustomFilter.reportCustomFilterCriteria[0]" value="{0}"/> in year <input class="customCriteria" objectname="reportFilters[INDEXREPLACEMENT].reportCustomFilter.reportCustomFilterCriteria[1]" value="{1}"/>';



-- ID for table, subsource ID, another subsource ID, and filter ID
CALL ASSOCIATECUSTOMFILTERSWITHDATASUBSOURCES;